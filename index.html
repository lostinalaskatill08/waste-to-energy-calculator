<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Circular Waste-to-Energy Calculator</title>
    <style>
        /* Keeping original CSS styles */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
        /* ... other CSS styles remain the same ... */
    </style>
</head>
<body>
    <div class="header">
        <h2>Advanced Circular Waste-to-Energy Calculator</h2>
        <p>Calculate energy potential with enhanced feedback loops and two-stage AD</p>
    </div>

    <div>
        <label>City Population:</label>
        <input type="number" id="population" placeholder="Enter city population" min="1">
        <button id="calculateButton">Calculate Energy Potential</button>
    </div>
    
    <div id="result"></div>

    <div class="section">
        <h3>Updated System Assumptions:</h3>
        <ul>
            <li>Waste Generation Rates:
                <ul>
                    <li><b>Human Waste:</b> 0.2 kg dry solids/person/day</li>
                    <li><b>Municipal Solid Waste:</b> 2.0 kg/person/day</li>
                    <li><b>Organic Fraction:</b> 50% of MSW</li>
                </ul>
            </li>
            <li>Enhanced Two-Stage AD:
                <ul>
                    <li><b>Base Efficiency:</b> 48%</li>
                    <li><b>Co-digestion Boost:</b> 25%</li>
                    <li><b>Biogas Yield:</b> 0.65 m¬≥/kg VS</li>
                    <li><b>Methane Content:</b> 78%</li>
                </ul>
            </li>
            <li>Advanced WTE:
                <ul>
                    <li><b>Electrical Efficiency:</b> 32%</li>
                    <li><b>Heat Recovery:</b> 15%</li>
                    <li><b>Calorific Value:</b> 2.8 MWh/tonne</li>
                </ul>
            </li>
            <li>Optimized Algae System:
                <ul>
                    <li><b>Yield:</b> 45 g/m¬≤/day</li>
                    <li><b>Area:</b> 2.5 m¬≤ per person</li>
                    <li><b>Lipid Content:</b> 45%</li>
                    <li><b>Conversion Efficiency:</b> 40%</li>
                </ul>
            </li>
        </ul>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("calculateButton").addEventListener("click", calculateMaximizedSystem);
            document.getElementById("population").addEventListener("keypress", function(e) {
                if (e.key === "Enter") {
                    calculateMaximizedSystem();
                }
            });
        });

        function calculateMaximizedSystem() {
            let population = parseInt(document.getElementById("population").value);

            if (isNaN(population) || population <= 0) {
                document.getElementById("result").innerHTML = "<p class='error'>Please enter a valid population.</p>";
                return;
            }

            // Base waste calculations
            const humanWastePerDay = 0.0002; // tonnes/person/day
            const mswPerDay = 0.002; // tonnes/person/day
            const annualHumanWaste = population * humanWastePerDay * 365;
            const annualMSW = population * mswPerDay * 365;

            // Waste distribution
            const organicFraction = 0.50;
            const toAD = (annualMSW * organicFraction) + annualHumanWaste;
            const toWTE = annualMSW * 0.30;
            const toGasification = annualMSW * 0.20;

            // Algae system
            const algaeYield = 0.045; // tonnes/m¬≤/year
            const areaPerPerson = 2.5; // m¬≤
            const algaeArea = population * areaPerPerson;
            const annualAlgaeBiomass = algaeYield * algaeArea;
            const lipidContent = 0.45;
            const extractedLipids = annualAlgaeBiomass * lipidContent;
            const spentBiomass = annualAlgaeBiomass * (1 - lipidContent);

            // Biomass distribution
            const spentToAD = spentBiomass * 0.6;
            const spentToGasification = spentBiomass * 0.4;

            // Enhanced Two-Stage AD
            const adEfficiency = 0.48;
            const coDigestionBoost = 1.25;
            const biogasYield = 0.65; // m¬≥/kg VS
            const methaneContent = 0.78;
            const energyPerM3 = 6.5 * (methaneContent/0.60);

            // Calculate AD energy
            const adEnergy = (toAD + spentToAD) * 1000 * adEfficiency * 
                           coDigestionBoost * biogasYield * energyPerM3 / 1000;

            // WTE calculations
            const wteEfficiency = 0.32;
            const calorificValue = 2.8; // MWh/tonne
            const heatRecovery = 0.15;
            const wteEnergy = toWTE * calorificValue * wteEfficiency;
            const wteHeat = toWTE * calorificValue * heatRecovery;

            // Gasification
            const gasificationEff = 0.42;
            const gasificationEnergy = (toGasification + spentToGasification) * 
                                    gasificationEff * 6.2;

            // Algae biofuel
            const conversionEff = 0.40;
            const biofuelEnergy = extractedLipids * conversionEff * 11.6;

            // Integration benefits
            const heatRecoveryTotal = wteHeat + (gasificationEnergy * 0.15);
            const nutrientRecycling = (adEnergy + gasificationEnergy) * 0.08;
            const carbonCapture = (toGasification + spentToGasification) * 0.15 * 0.75 * 3.67 * 0.1;

            // Total system energy
            const totalEnergy = adEnergy + wteEnergy + gasificationEnergy + 
                              biofuelEnergy + heatRecoveryTotal + nutrientRecycling + 
                              carbonCapture;

            // Environmental benefits
            const co2Saved = (toAD * 3.5) + (toGasification * 2.8);
            const biocharProduced = (toGasification + spentToGasification) * 0.15;
            const treesEquivalent = Math.floor(co2Saved * 46);
            const carsRemoved = Math.floor(co2Saved / 4.6);

            // Format results
            document.getElementById("result").innerHTML = `
                <h3>System Performance:</h3>
                <div class="result-item">‚ö° Energy Generation:
                    <ul>
                        <li>Enhanced AD: <b>${(adEnergy/1000).toFixed(2)} GWh/year</b></li>
                        <li>WTE: <b>${(wteEnergy/1000).toFixed(2)} GWh/year</b></li>
                        <li>Gasification: <b>${(gasificationEnergy/1000).toFixed(2)} GWh/year</b></li>
                        <li>Algae Biofuel: <b>${(biofuelEnergy/1000).toFixed(2)} GWh/year</b></li>
                    </ul>
                </div>
                <div class="result-item">üîÑ Integration Benefits:
                    <ul>
                        <li>Heat Recovery: <b>${(heatRecoveryTotal/1000).toFixed(2)} GWh/year</b></li>
                        <li>Nutrient Recycling: <b>${(nutrientRecycling/1000).toFixed(2)} GWh/year</b></li>
                        <li>Carbon Capture: <b>${(carbonCapture/1000).toFixed(2)} GWh/year</b></li>
                    </ul>
                </div>
                <div class="result-item">üìä Total System Energy: <b>${(totalEnergy/1000).toFixed(2)} GWh/year</b></div>
                <div class="result-item">üè≠ Products:
                    <ul>
                        <li>Biochar: <b>${biocharProduced.toFixed(2)} tonnes/year</b></li>
                        <li>Algae Lipids: <b>${extractedLipids.toFixed(2)} tonnes/year</b></li>
                    </ul>
                </div>
                
                <div class="comparison">
                    <h4>Environmental Impact:</h4>
                    <div>üå≥ Equivalent to planting ${treesEquivalent.toLocaleString()} trees</div>
                    <div>üöó Equal to removing ${carsRemoved.toLocaleString()} cars from the road</div>
                    <div>‚ôªÔ∏è CO‚ÇÇ Saved: ${co2Saved.toFixed(2)} tonnes/year</div>
                </div>
                
                <div class="per-capita">
                    <h4>Per Capita Impact:</h4>
                    <div>Energy Generation: ${(totalEnergy/population).toFixed(2)} kWh per person</div>
                    <div>CO‚ÇÇ Reduction: ${(co2Saved/population).toFixed(2)} tonnes per person</div>
                </div>`;
        }
    </script>
</body>
</html>

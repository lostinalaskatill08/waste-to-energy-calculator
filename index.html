<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Maximized Circular Waste-to-Energy Calculator</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px;
      line-height: 1.6;
      background-color: #f8fafc;
    }
    .calculator-header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background: linear-gradient(135deg, #4ade80, #2dd4bf);
      border-radius: 15px;
      color: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    h1 {
      font-size: 2.4em;
      margin-bottom: 10px;
    }
    .subtitle {
      font-size: 1.2em;
      margin-bottom: 25px;
      opacity: 0.9;
    }
    .input-section {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    input[type="number"] {
      padding: 12px 20px;
      font-size: 1.1em;
      margin-right: 10px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      width: 200px;
      transition: border-color 0.3s ease;
    }
    input[type="number"]:focus {
      border-color: #4ade80;
      outline: none;
    }
    button {
      padding: 12px 24px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      background: #4ade80;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease, background-color 0.3s ease;
    }
    button:hover {
      background: #22c55e;
      transform: translateY(-2px);
    }
    .result-section {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    h2 {
      font-size: 1.8em;
      margin-top: 30px;
      margin-bottom: 15px;
      color: #0f766e;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .metric {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    .metric:last-child {
      border-bottom: none;
    }
    .metric-value {
      font-weight: bold;
      color: #059669;
    }
    .homes-powered {
      font-size: 1.4em;
      text-align: center;
      margin: 20px 0;
      color: #059669;
      font-weight: bold;
    }
    .assumptions {
      margin-top: 60px;
      padding: 25px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      border-left: 4px solid #4ade80;
    }
    .assumptions h3 {
      margin-top: 0;
      color: #0f766e;
      font-size: 1.4em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .assumptions p {
      margin-bottom: 1em;
    }
  </style>
</head>
<body>
  <div class="calculator-header">
    <h1>Maximized Circular Waste-to-Energy Calculator</h1>
    <p class="subtitle">
      Attempts a naive multi-parameter search to increase synergy of AD ↔ Biochar ↔ Algae
    </p>
  </div>

  <div class="input-section">
    <label>Population (people): </label>
    <input type="number" id="population" value="100000">
    <label>Household kWh/year: </label>
    <input type="number" id="householdKwh" value="10500">
    <button onclick="maximizeSystem()">Maximize Energy</button>
  </div>

  <div id="result"></div>

  <script>
    /*
      calcTotalEnergy() does a single pass of our circular model, given synergy factors:
        synergyAD  = fraction of AD synergy (extra yield from co-digestion with algae)  e.g., 0.1–0.5
        synergyAlgae = fraction of algae growth boost from biochar/digestate synergy   e.g., 0.1–0.5
        leftoverFrac = fraction of feedstock diverted to leftover or pyrolysis steps   e.g., 0.2–0.5
    */
    function calcTotalEnergy(pop, synergyAD, synergyAlgae, leftoverFrac) {
      // 1) Sewage Sludge / Organic Waste
      //   Assume 0.20 kg dry solids/day/person => annual = pop * 0.2 * 365
      const drySolidsPerPerson = 0.20;
      const annualDrySolids = pop * drySolidsPerPerson * 365;

      // Base AD step:
      //   Biogas yield ~0.40 m³/kg, each m³ ~6.5 kWh => net engine efficiency ~ 30%
      //   For simplicity, assume 6.5 kWh/m³ is already net. If synergyAD is e.g., 0.20 => 20% extra yield
      const baseBiogasPerKg = 0.40;       // m³/kg
      const kWhPerM3Biogas = 6.5;        
      const synergyFactorAD = 1 + synergyAD;  // e.g., if synergyAD=0.2 => 1.2 multiplier
      const biogasEnergy_kWh = annualDrySolids * baseBiogasPerKg * kWhPerM3Biogas * synergyFactorAD;

      // 2) Leftover fraction goes to pyrolysis => biochar => synergy with algae
      //   leftoverFrac is portion of solids used for pyrolysis (rough simplification).
      //   Assume pyrolysis yield => 30% biochar by mass, each kg char => 5 kWh if gasified or used in combustion
      const pyrolysisSolids = annualDrySolids * leftoverFrac;
      const biocharProduced = pyrolysisSolids * 0.30; 
      const biocharEnergy_kWh = biocharProduced * 5; 
      
      // 3) Algae cultivation synergy:
      //   - Freed nutrients from digestate + biochar
      //   - synergyAlgae => growth boost. 
      //   - We'll do a simplified approach:
      //       Base algae from nutrients: For each kg N, ~14.3 kg algae. 
      //       For each 1 kg algae => 0.3 kg lipids => ~3.3 kWh net if converted to biodiesel
      //     Then multiply by synergyAlgae to reflect growth enhancement
      //   - We'll assume a generic 'nutrient capacity' ~ 5% N in the total solids => annualDrySolids * 0.05
      const totalNitrogen_kg = annualDrySolids * 0.05;
      // Base algae from nitrogen: let's assume 14.3 kg algae per 1 kg N => about 7% N in algae biomass
      const baseAlgae_kg = totalNitrogen_kg * 14.3;
      // synergy factor
      const algaeBiomass_kg = baseAlgae_kg * (1 + synergyAlgae);

      // Convert some fraction to lipids (30%?), ~10–11 kWh/kg of biodiesel. We pick 10.5 for simplicity
      // net generation after processing ~ (0.3 * algae) * 10.5
      const algaeLipids_kg = algaeBiomass_kg * 0.3;
      const algaeBiofuel_kWh = algaeLipids_kg * 10.5;

      // 4) Recycle leftover algae or leftover pyrolysis by-products
      //   We'll do a small extra synergy: leftover algae fraction might be re-digested, 
      //   but to keep it simpler, let's give a small 10% bump to the total for re-loops.
      //   You could do multi-iteration here, but we'll approximate with +0.10 factor on algae side:
      const leftoverBump_kWh = algaeBiofuel_kWh * 0.10; 

      // sum up total
      const total_kWh = biogasEnergy_kWh + biocharEnergy_kWh + algaeBiofuel_kWh + leftoverBump_kWh;

      return {
        totalEnergy_kWh: total_kWh,
        breakdown: {
          biogas: biogasEnergy_kWh,
          biochar: biocharEnergy_kWh,
          algaeBiofuel: algaeBiofuel_kWh,
          leftoverBump: leftoverBump_kWh
        }
      };
    }

    /*
      maximizeSystem() tries multiple synergy values for synergyAD, synergyAlgae, and leftoverFrac 
      within a certain range. For each combo, it calculates totalEnergy and picks the maximum.
    */
    function maximizeSystem() {
      const population = parseFloat(document.getElementById("population").value) || 100000;
      const householdKwh = parseFloat(document.getElementById("householdKwh").value) || 10500;

      let bestCombo = {
        synergyAD: 0,
        synergyAlgae: 0,
        leftoverFrac: 0,
        totalEnergy_kWh: 0
      };

      // We'll do naive stepping:
      // synergyAD from 0.0 to 0.5, synergyAlgae 0.0 to 0.5, leftoverFrac 0.2 to 0.5
      for (let ad = 0; ad <= 0.50; ad += 0.05) {
        for (let al = 0; al <= 0.50; al += 0.05) {
          for (let lf = 0.2; lf <= 0.5; lf += 0.05) {
            const result = calcTotalEnergy(population, ad, al, lf);
            if (result.totalEnergy_kWh > bestCombo.totalEnergy_kWh) {
              bestCombo.synergyAD = ad;
              bestCombo.synergyAlgae = al;
              bestCombo.leftoverFrac = lf;
              bestCombo.totalEnergy_kWh = result.totalEnergy_kWh;
            }
          }
        }
      }

      // Once we have best synergy factors, run a final calculation for breakdown
      const finalResult = calcTotalEnergy(
        population, 
        bestCombo.synergyAD, 
        bestCombo.synergyAlgae, 
        bestCombo.leftoverFrac
      );
      
      const totalMWh = finalResult.totalEnergy_kWh / 1000;
      const homesPowered = Math.floor(finalResult.totalEnergy_kWh / householdKwh);
      
      document.getElementById("result").innerHTML = `
        <div class="result-section">
          <h2>Maximized Results</h2>
          <p>
            <strong>Population:</strong> ${population.toLocaleString()}<br>
            <strong>Best AD Synergy:</strong> ${(bestCombo.synergyAD*100).toFixed(1)}% extra yield<br>
            <strong>Best Algae Synergy:</strong> ${(bestCombo.synergyAlgae*100).toFixed(1)}% growth boost<br>
            <strong>Best Leftover Fraction:</strong> ${(bestCombo.leftoverFrac*100).toFixed(1)}% pyrolyzed<br>
          </p>
          <div class="metric">
            <span>Total Energy:</span>
            <span class="metric-value">${totalMWh.toFixed(2)} MWh/year</span>
          </div>
          <p class="homes-powered">
            ~${homesPowered.toLocaleString()} homes powered 
            (assuming ${householdKwh} kWh/year per household)
          </p>
        </div>

        <div class="result-section">
          <h2>Detailed Breakdown</h2>
          <div class="metric">
            <span>AD Biogas:</span>
            <span class="metric-value">${(finalResult.breakdown.biogas/1000).toFixed(2)} MWh</span>
          </div>
          <div class="metric">
            <span>Biochar Energy:</span>
            <span class="metric-value">${(finalResult.breakdown.biochar/1000).toFixed(2)} MWh</span>
          </div>
          <div class="metric">
            <span>Algae Biofuel:</span>
            <span class="metric-value">${(finalResult.breakdown.algaeBiofuel/1000).toFixed(2)} MWh</span>
          </div>
          <div class="metric">
            <span>Leftover Recycling Bump:</span>
            <span class="metric-value">${(finalResult.breakdown.leftoverBump/1000).toFixed(2)} MWh</span>
          </div>
          <div class="metric">
            <span>Grand Total:</span>
            <span class="metric-value">${(finalResult.totalEnergy_kWh/1000).toFixed(2)} MWh/year</span>
          </div>
        </div>
      `;
    }
  </script>

  <div class="assumptions">
    <h3>Assumptions & Notes on “Maximization”</h3>
    <p>
      1) We try synergy factors (anaerobic digestion extra yield, algae growth boost) from 0.0 to 0.50,
      and leftover fraction (pyrolyzed) from 20% to 50%, in small 0.05 increments. The code picks 
      whichever combination yields the highest total system kWh. This is a <em>naive discrete search</em>, 
      not a formal continuous optimization or linear program.
    </p>
    <p>
      2) Many numeric values (biogas yield = 0.40 m³/kg, 6.5 kWh/m³, pyrolysis to biochar = 30% mass, 
      5 kWh/kg char, algae lipid fraction = 30%, 10.5 kWh/kg biodiesel, 5% nitrogen in sewage solids, etc.) 
      are <strong>placeholders</strong> based on literature averages. 
      Real projects should use site-specific data and pilot‐scale experiments.
    </p>
    <p>
      3) We assume the synergy factors <strong>linearly</strong> boost yields. Actual processes 
      might be nonlinear, saturate above certain thresholds, or depend on pH, temperature, 
      and retention times. A real system would use multi-parameter modeling (e.g., Aspen Plus) 
      or advanced solvers to find truly optimal configurations.
    </p>
    <p>
      4) This calculator <em>only</em> addresses simplified mass flows (digestate → algae, pyrolysis → biochar) 
      and does not account for heat integration, carbon capture, or advanced pretreatment steps 
      (like thermal hydrolysis or mechanical cell rupture). Such additions can significantly 
      alter net energy balances.
    </p>
    <p>
      5) The “Leftover Recycling Bump” is a rough 10% add-on for leftover algae or pyrolysis residues 
      re-fed to the digester. In reality, one would do an iterative or dynamic model to keep 
      recycling until marginal returns diminish.
    </p>
  </div>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Integrated Energy & Water Transition Calculator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.5;
            margin: 0;
            padding: 20px;
            color: #333;
            background-color: #f5f5f5;
        }
        
        h1, h2, h3, h4 {
            margin-top: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .stat-box {
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .stat-box.blue { background-color: #eff6ff; }
        .stat-box.green { background-color: #ecfdf5; }
        .stat-box.yellow { background-color: #fffbeb; }
        .stat-box.purple { background-color: #f5f3ff; }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .stat-subtitle {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .grid {
            display: grid;
            gap: 20px;
        }
        
        .tabs {
            margin-bottom: 20px;
        }
        
        .tab-list {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            overflow-x: auto;
        }
        
        .tab-button {
            padding: 10px 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.875rem;
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
        
        .tab-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .slider-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .slider-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-top: 5px;
        }
        
        .slider-current {
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        .flex {
            display: flex;
            align-items: center;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .toggle-label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-right: 10px;
        }
        
        .toggle-button {
            border: 1px solid #d1d5db;
            background-color: #f9fafb;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.875rem;
            border-radius: 4px;
        }
        
        .toggle-button.active {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            font-weight: 500;
            color: #4b5563;
        }
        
        .text-right {
            text-align: right;
        }
        
        .bar-chart {
            margin-top: 15px;
        }
        
        .bar {
            height: 25px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .bar-label {
            width: 120px;
            font-size: 0.75rem;
            padding-left: 8px;
            z-index: 1;
        }
        
        .bar-value {
            font-size: 0.75rem;
            margin-left: auto;
            padding-right: 8px;
            z-index: 1;
        }
        
        .bar-fill {
            position: absolute;
            height: 25px;
            background-color: #3b82f6;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .center-text {
            text-align: center;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            border-bottom: 1px solid #f3f4f6;
            padding-bottom: 8px;
        }
        
        .metric-label {
            font-size: 0.875rem;
        }
        
        .metric-value {
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #2563eb;
            color: white;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        button:hover {
            background-color: #1d4ed8;
        }
        
        button.secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        
        button.secondary:hover {
            background-color: #d1d5db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>US Integrated Energy & Water Transition Calculator</h1>
        <p>Explore the combined impact of energy efficiency, renewable generation, transportation improvements, and water production systems.</p>
        
        <div class="tabs">
            <div class="tab-list">
                <button class="tab-button active" data-tab="summary">Summary</button>
                <button class="tab-button" data-tab="parameters">Input Parameters</button>
                <button class="tab-button" data-tab="efficiency">Energy Efficiency</button>
                <button class="tab-button" data-tab="renewable">Renewable Energy</button>
                <button class="tab-button" data-tab="transport">Transportation</button>
                <button class="tab-button" data-tab="water">Water Systems</button>
                <button class="tab-button" data-tab="phased">Phased Implementation</button>
            </div>
            
            <!-- Summary Tab -->
            <div class="tab-content active" id="summary">
                <div class="grid grid-cols-2">
                    <div class="card">
                        <h3 class="card-title">Strategy Approach</h3>
                        <div class="toggle-container">
                            <span class="toggle-label">Generation First</span>
                            <input type="range" min="0" max="1" step="1" value="1" id="efficiency-first-toggle" style="max-width: 60px; margin: 0 10px;">
                            <span class="toggle-label">Efficiency First</span>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Implementation Speed</label>
                            <input type="range" min="1" max="20" value="10" id="implementation-speed">
                            <div class="slider-values">
                                <span>Slower</span>
                                <span class="slider-current" id="implementation-speed-value">10</span>
                                <span>Faster</span>
                            </div>
                        </div>
                        
                        <div id="strategy-comparison">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Strategy</th>
                                        <th>Investment</th>
                                        <th>Carbon Reduction</th>
                                        <th>Payback</th>
                                        <th>Jobs</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Efficiency First</td>
                                        <td id="eff-first-investment">$1.89T</td>
                                        <td id="eff-first-carbon">920M tons</td>
                                        <td id="eff-first-payback">10.3 years</td>
                                        <td id="eff-first-jobs">3.3M</td>
                                    </tr>
                                    <tr>
                                        <td>Generation First</td>
                                        <td id="gen-first-investment">$2.65T</td>
                                        <td id="gen-first-carbon">644M tons</td>
                                        <td id="gen-first-payback">18.5 years</td>
                                        <td id="gen-first-jobs">1.5M</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Key Results</h3>
                        <div class="stats-grid">
                            <div class="stat-box blue">
                                <div class="stat-label">Net Energy Impact</div>
                                <div class="stat-value" id="net-energy-impact">-707 TWh</div>
                                <div class="stat-subtitle" id="net-energy-percent">-18.6% of US consumption</div>
                            </div>
                            
                            <div class="stat-box green">
                                <div class="stat-label">Carbon Reduction</div>
                                <div class="stat-value" id="carbon-reduction">920 MT</div>
                                <div class="stat-subtitle" id="carbon-percent">17.6% of US emissions</div>
                            </div>
                            
                            <div class="stat-box yellow">
                                <div class="stat-label">Total Investment</div>
                                <div class="stat-value" id="total-investment">$1.89T</div>
                                <div class="stat-subtitle" id="payback-period">Payback: 10.3 years</div>
                            </div>
                            
                            <div class="stat-box purple">
                                <div class="stat-label">Jobs Created</div>
                                <div class="stat-value" id="jobs-created">3.3M</div>
                                <div class="stat-subtitle" id="jobs-per-million">1.8 jobs per $1M</div>
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 20px;">Carbon Reduction by Component</h4>
                        <div id="carbon-breakdown" class="bar-chart">
                            <!-- Bars will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2">
                    <div class="card">
                        <h3 class="card-title">Efficiency Impact</h3>
                        <div id="efficiency-metrics">
                            <!-- Metrics will be dynamically inserted here -->
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Renewable Energy</h3>
                        <div id="renewable-metrics">
                            <!-- Metrics will be dynamically inserted here -->
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Water Production</h3>
                        <div id="water-metrics">
                            <!-- Metrics will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Parameters Tab -->
            <div class="tab-content" id="parameters">
                <div class="grid grid-cols-2">
                    <!-- Efficiency Parameters -->
                    <div class="card">
                        <h3 class="card-title">Energy Efficiency Parameters</h3>
                        
                        <div class="slider-container">
                            <label class="slider-label">Passive Solar Design Efficiency (%)</label>
                            <input type="range" min="20" max="90" value="50" id="passive-solar-efficiency">
                            <div class="slider-values">
                                <span>20%</span>
                                <span class="slider-current" id="passive-solar-efficiency-value">50%</span>
                                <span>90%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Geothermal Heat Pump COP</label>
                            <input type="range" min="2.5" max="5.0" step="0.1" value="3.5" id="gshp-cop">
                            <div class="slider-values">
                                <span>2.5</span>
                                <span class="slider-current" id="gshp-cop-value">3.5</span>
                                <span>5.0</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Heat Pump Water Heater Efficiency</label>
                            <input type="range" min="2.0" max="3.5" step="0.1" value="2.5" id="hpwh-efficiency">
                            <div class="slider-values">
                                <span>2.0x</span>
                                <span class="slider-current" id="hpwh-efficiency-value">2.5x</span>
                                <span>3.5x</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">National Adoption Rate (%)</label>
                            <input type="range" min="5" max="50" value="25" id="efficiency-adoption-rate">
                            <div class="slider-values">
                                <span>5%</span>
                                <span class="slider-current" id="efficiency-adoption-rate-value">25%</span>
                                <span>50%</span>
                            </div>
                        </div>
                        
                        <div class="toggle-container">
                            <span class="toggle-label">Implementation Type:</span>
                            <button class="toggle-button active" id="retrofit-button">Retrofit</button>
                            <button class="toggle-button" id="new-construction-button">New Construction</button>
                        </div>
                    </div>
                    
                    <!-- Renewable Energy Parameters -->
                    <div class="card">
                        <h3 class="card-title">Renewable Energy Parameters</h3>
                        
                        <div class="slider-container">
                            <label class="slider-label">Food Waste Utilization (%)</label>
                            <input type="range" min="0" max="90" value="60" id="food-waste-utilization">
                            <div class="slider-values">
                                <span>0%</span>
                                <span class="slider-current" id="food-waste-utilization-value">60%</span>
                                <span>90%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Agricultural Waste Utilization (%)</label>
                            <input type="range" min="0" max="80" value="40" id="agriculture-utilization">
                            <div class="slider-values">
                                <span>0%</span>
                                <span class="slider-current" id="agriculture-utilization-value">40%</span>
                                <span>80%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">SkySails Units Deployed</label>
                            <input type="range" min="0" max="100000" step="5000" value="50000" id="skysails-units">
                            <div class="slider-values">
                                <span>0</span>
                                <span class="slider-current" id="skysails-units-value">50,000</span>
                                <span>100,000</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Electricity Price (¢/kWh)</label>
                            <input type="range" min="5" max="25" value="10" id="electricity-price">
                            <div class="slider-values">
                                <span>5¢</span>
                                <span class="slider-current" id="electricity-price-value">10¢</span>
                                <span>25¢</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transportation Parameters -->
                    <div class="card">
                        <h3 class="card-title">Transportation Parameters</h3>
                        
                        <div class="slider-container">
                            <label class="slider-label">Vehicle Fleet Retrofit (%)</label>
                            <input type="range" min="0" max="100" value="50" id="retrofit-percentage">
                            <div class="slider-values">
                                <span>0%</span>
                                <span class="slider-current" id="retrofit-percentage-value">50%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Carbon Capture Efficiency (%)</label>
                            <input type="range" min="0" max="100" value="90" id="ccu-adoption">
                            <div class="slider-values">
                                <span>0%</span>
                                <span class="slider-current" id="ccu-adoption-value">90%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Hemp Utilization (%)</label>
                            <input type="range" min="0" max="100" value="50" id="hemp-utilization">
                            <div class="slider-values">
                                <span>0%</span>
                                <span class="slider-current" id="hemp-utilization-value">50%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Algae Feedstock Adoption (%)</label>
                            <input type="range" min="0" max="100" value="25" id="algae-percentage">
                            <div class="slider-values">
                                <span>0%</span>
                                <span class="slider-current" id="algae-percentage-value">25%</span>
                                <span>100%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Water Parameters -->
                    <div class="card">
                        <h3 class="card-title">Water Technology Parameters</h3>
                        
                        <div class="slider-container">
                            <label class="slider-label">Energy Allocation to Water (%)</label>
                            <input type="range" min="1" max="20" value="5" id="energy-allocation-to-water">
                            <div class="slider-values">
                                <span>1%</span>
                                <span class="slider-current" id="energy-allocation-to-water-value">5%</span>
                                <span>20%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Desalination Allocation (%)</label>
                            <input type="range" min="0" max="100" value="60" id="desalination-allocation">
                            <div class="slider-values">
                                <span>0% (All AWG)</span>
                                <span class="slider-current" id="desalination-allocation-value">60%</span>
                                <span>100% (All Desalination)</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Water Technologies Efficiency (%)</label>
                            <input type="range" min="50" max="150" value="100" id="water-techs-efficiency">
                            <div class="slider-values">
                                <span>50%</span>
                                <span class="slider-current" id="water-techs-efficiency-value">100%</span>
                                <span>150%</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label class="slider-label">Water Value ($/m³)</label>
                            <input type="range" min="0.5" max="5" step="0.1" value="1.5" id="water-value-usd">
                            <div class="slider-values">
                                <span>$0.50</span>
                                <span class="slider-current" id="water-value-usd-value">$1.50</span>
                                <span>$5.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Energy Efficiency Tab -->
            <div class="tab-content" id="efficiency">
                <div class="card">
                    <h3 class="card-title">Household Energy Savings</h3>
                    <div class="grid grid-cols-2">
                        <div>
                            <table>
                                <tr>
                                    <th>Source</th>
                                    <th>Energy Saved (kWh)</th>
                                </tr>
                                <tr>
                                    <td>Passive Solar</td>
                                    <td id="passive-solar-savings">2,250</td>
                                </tr>
                                <tr>
                                    <td>GSHP Heating</td>
                                    <td id="gshp-heating-savings">1,607</td>
                                </tr>
                                <tr>
                                    <td>GSHP Cooling</td>
                                    <td id="gshp-cooling-savings">459</td>
                                </tr>
                                <tr>
                                    <td>HP Water Heater</td>
                                    <td id="hpwh-savings">1,157</td>
                                </tr>
                                <tr>
                                    <td>HP Dryer</td>
                                    <td id="dry-savings">150</td>
                                </tr>
                                <tr>
                                    <td><strong>Total Savings</strong></td>
                                    <td id="total-household-savings"><strong>5,623</strong></td>
                                </tr>
                            </table>
                        </div>
                        
                        <div>
                            <div class="bar-chart">
                                <div id="efficiency-savings-chart">
                                    <!-- Bars will be dynamically inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2" style="margin-top: 20px;">
                        <div class="stat-box blue">
                            <div class="stat-label">Annual Energy Savings</div>
                            <div class="stat-value" id="annual-energy-savings">5,623 kWh</div>
                            <div class="stat-subtitle">per household</div>
                        </div>
                        
                        <div class="stat-box green">
                            <div class="stat-label">Reduction in Consumption</div>
                            <div class="stat-value" id="consumption-reduction-pct">52%</div>
                            <div class="stat-subtitle">of household energy use</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">Economic Analysis</h3>
                    
                    <div class="grid grid-cols-2">
                        <div class="stat-box">
                            <div class="stat-label">System Cost</div>
                            <div class="stat-value" id="system-cost">$29,000</div>
                            <div class="stat-subtitle">Before incentives</div>
                        </div>
                        
                        <div class="stat-box">
                            <div class="stat-label">After Incentives</div>
                            <div class="stat-value" id="net-system-cost">$19,100</div>
                            <div class="stat-subtitle">Net cost</div>
                        </div>
                        
                        <div class="stat-box">
                            <div class="stat-label">Annual Savings</div>
                            <div class="stat-value" id="annual-cost-savings">$562</div>
                            <div class="stat-subtitle">Utility bill reduction</div>
                        </div>
                        
                        <div class="stat-box">
                            <div class="stat-label">Payback Period</div>
                            <div class="stat-value" id="household-payback">8.5 years</div>
                            <div class="stat-subtitle">With incentives</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">National Impact at <span id="adoption-rate-display">25</span>% Adoption</h3>
                    
                    <div class="grid grid-cols-2">
                        <div>
                            <div class="metric-row">
                                <span class="metric-label">Homes Retrofitted:</span>
                                <span class="metric-value" id="homes-adopting">32.5 million</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Total Energy Saved:</span>
                                <span class="metric-value" id="national-energy-saved">182.7 TWh</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Carbon Reduction:</span>
                                <span class="metric-value" id="efficiency-carbon-reduction">76.2 million tons</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">% of US Emissions:</span>
                                <span class="metric-value" id="efficiency-emission-percent">1.46%</span>
                            </div>
                        </div>
                        
                        <div>
                            <div class="metric-row">
                                <span class="metric-label">Grid Capacity Freed:</span>
                                <span class="metric-value" id="grid-capacity-freed">4.8%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">EVs Supported:</span>
                                <span class="metric-value" id="evs-supported">65.4 million</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Total Investment:</span>
                                <span class="metric-value" id="efficiency-investment">$621.0 billion</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Jobs Created:</span>
                                <span class="metric-value" id="efficiency-jobs">3.1 million</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Other tab content would be added for completeness -->
            <div class="tab-content" id="renewable">
                <div class="card">
                    <h3 class="card-title">Renewable Energy Generation</h3>
                    <p>This tab would show detailed information about renewable energy production from waste streams, algae, and SkySails wind.</p>
                    
                    <div id="renewable-placeholder">
                        <div class="center-text">
                            <p>Detailed metrics are being calculated based on your input parameters.</p>
                            <p>The full calculator shows comprehensive analysis of:</p>
                            <ul>
                                <li>Energy generation by source</li>
                                <li>Waste utilization rates</li>
                                <li>Carbon sequestration and avoidance</li>
                                <li>Economic impacts and ROI</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="transport">
                <div class="card">
                    <h3 class="card-title">Transportation Impact</h3>
                    <p>This tab would show detailed information about transportation improvements including fleet retrofits, biofuels, and oil import reductions.</p>
                    
                    <div id="transport-placeholder">
                        <div class="center-text">
                            <p>Detailed transportation metrics are being calculated.</p>
                            <p>The full calculator integrates:</p>
                            <ul>
                                <li>Vehicle fleet retrofit impacts</li>
                                <li>Carbon capture utilization</li>
                                <li>Biofuel production from hemp and algae</li>
                                <li>Oil import reduction analysis</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="water">
                <div class="card">
                    <h3 class="card-title">Water Production Impact</h3>
                    <p>This tab would show detailed information about water systems including desalination, atmospheric water generation, and agricultural impacts.</p>
                    
                    <div id="water-placeholder">
                        <div class="center-text">
                            <p>Water system metrics are being calculated.</p>
                            <p>The full calculator analyzes:</p>
                            <ul>
                                <li>Solar-powered desalination</li>
                                <li>Atmospheric water harvesting</li>
                                <li>Water-energy-food nexus</li>
                                <li>Population served and agricultural potential</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="phased">
                <div class="card">
                    <h3 class="card-title">Phased Implementation Timeline</h3>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Phase</th>
                                <th>Year</th>
                                <th>Carbon Reduction (MT)</th>
                                <th>Investment ($B)</th>
                                <th>Energy Impact (TWh)</th>
                                <th>Jobs (millions)</th>
                            </tr>
                        </thead>
                        <tbody id="phased-plan-table">
                            <!-- Implementation phases will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button id="export-button">Export Results</button>
            <button class="secondary" id="reset-button">Reset Parameters</button>
        </div>
    </div>
    
    <script>
        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to the clicked tab and corresponding content
                button.classList.add('active');
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });
        
        // Implementation type toggle
        document.getElementById('retrofit-button').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('new-construction-button').classList.remove('active');
            updateCalculations();
        });
        
        document.getElementById('new-construction-button').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('retrofit-button').classList.remove('active');
            updateCalculations();
        });
        
        // Update slider value displays
        const sliders = [
            'passive-solar-efficiency',
            'gshp-cop',
            'hpwh-efficiency',
            'efficiency-adoption-rate',
            'food-waste-utilization',
            'agriculture-utilization',
            'skysails-units',
            'electricity-price',
            'retrofit-percentage',
            'ccu-adoption',
            'hemp-utilization',
            'algae-percentage',
            'energy-allocation-to-water',
            'desalination-allocation',
            'water-techs-efficiency',
            'water-value-usd',
            'implementation-speed'
        ];
        
        sliders.forEach(sliderId => {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(`${sliderId}-value`);
            
            slider.addEventListener('input', () => {
                // Format the displayed value appropriately based on the slider
                let displayValue = slider.value;
                
                if (sliderId === 'skysails-units') {
                    displayValue = parseInt(slider.value).toLocaleString();
                } else if (sliderId === 'water-value-usd') {
                    displayValue = `$${parseFloat(slider.value).toFixed(1)}`;
                } else if (sliderId.includes('efficiency') || sliderId.includes('utilization') || 
                           sliderId.includes('percentage') || sliderId.includes('adoption') ||
                           sliderId.includes('allocation')) {
                    displayValue = `${slider.value}%`;
                } else if (sliderId === 'gshp-cop' || sliderId === 'hpwh-efficiency') {
                    displayValue = `${parseFloat(slider.value).toFixed(1)}${sliderId === 'hpwh-efficiency' ? 'x' : ''}`;
                } else if (sliderId === 'electricity-price') {
                    displayValue = `${slider.value}¢`;
                }
                
                valueDisplay.textContent = displayValue;
                updateCalculations();
                
                // Update adoption rate display in the efficiency tab
                if (sliderId === 'efficiency-adoption-rate') {
                    document.getElementById('adoption-rate-display').textContent = slider.value;
                }
            });
        });
        
        // Efficiency first toggle
        document.getElementById('efficiency-first-toggle').addEventListener('input', updateCalculations);
        
        // Reset button
        document.getElementById('reset-button').addEventListener('click', resetParameters);
        
        // Export button
        document.getElementById('export-button').addEventListener('click', exportResults);
        
        // Fixed data about the US
        const usData = {
            population: 332.8, // million
            electricityConsumption: 3800, // TWh/year
            residentialConsumption: 1470, // TWh/year
            commercialConsumption: 1330, // TWh/year
            industrialConsumption: 1000, // TWh/year
            totalEnergyConsumption: 100, // quadrillion BTU/year
            foodWaste: 63, // million tons/year
            agriculturalWaste: 800, // million tons/year
            municipalSolidWaste: 292, // million tons/year
            forestResidues: 93, // million tons/year
            constructionWaste: 600, // million tons/year
            co2Emissions: 5222, // million metric tons/year
            totalWaterWithdrawals: 450, // billion m³/year
            publicWaterSupply: 42, // billion m³/year
            households: 129.9, // million
            totalVehicles: 290, // million
            averageHouseholdConsumption: 10715, // kWh annually
            fuelImports: 9, // million barrels/day
        };
        
        // Format numbers for display
        function formatNumber(num, decimals = 2) {
            if (num === undefined || num === null) return 'N/A';
            if (num === 0) return '0';
            
            // For small numbers, just use fixed precision
            if (Math.abs(num) < 1000) {
                return num.toFixed(decimals);
            }
            
            // For larger numbers, use locale string with commas
            return num.toLocaleString(undefined, { 
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }
        
        // Update all calculations based on current parameters
        function updateCalculations() {
            const passiveSolarEfficiency = parseFloat(document.getElementById('passive-solar-efficiency').value);
            const gshpCOP = parseFloat(document.getElementById('gshp-cop').value);
            const hpwhEfficiency = parseFloat(document.getElementById('hpwh-efficiency').value);
            const efficiencyAdoptionRate = parseFloat(document.getElementById('efficiency-adoption-rate').value);
            const isNewConstruction = document.getElementById('new-construction-button').classList.contains('active');
            
            const foodWasteUtilization = parseFloat(document.getElementById('food-waste-utilization').value);
            const agricultureUtilization = parseFloat(document.getElementById('agriculture-utilization').value);
            const forestUtilization = parseFloat(document.getElementById('forest-utilization') ? document.getElementById('forest-utilization').value : 30);
            const mswUtilization = parseFloat(document.getElementById('msw-utilization') ? document.getElementById('msw-utilization').value : 50);
            const skySailsUnits = parseInt(document.getElementById('skysails-units').value);
            const electricityPrice = parseFloat(document.getElementById('electricity-price').value);
            
            const retrofitPercentage = parseFloat(document.getElementById('retrofit-percentage').value);
            const ccuAdoption = parseFloat(document.getElementById('ccu-adoption').value);
            const hempUtilization = parseFloat(document.getElementById('hemp-utilization').value);
            const algaePercentage = parseFloat(document.getElementById('algae-percentage').value);
            
            const energyAllocationToWater = parseFloat(document.getElementById('energy-allocation-to-water').value);
            const desalinationAllocation = parseFloat(document.getElementById('desalination-allocation').value);
            const waterTechsEfficiency = parseFloat(document.getElementById('water-techs-efficiency').value);
            const waterValueUSD = parseFloat(document.getElementById('water-value-usd').value);
            
            const efficiencyFirst = document.getElementById('efficiency-first-toggle').value === "1";
            
            // Calculate efficiency savings
            const efficiencyResults = calculateEfficiencySavings(
                passiveSolarEfficiency, gshpCOP, hpwhEfficiency, efficiencyAdoptionRate, isNewConstruction, electricityPrice
            );
            
            // Update efficiency metrics displays
            document.getElementById('passive-solar-savings').textContent = formatNumber(efficiencyResults.perHousehold.passiveSolarSavings, 0);
            document.getElementById('gshp-heating-savings').textContent = formatNumber(efficiencyResults.perHousehold.gshpHeatingSavings, 0);
            document.getElementById('gshp-cooling-savings').textContent = formatNumber(efficiencyResults.perHousehold.gshpCoolingSavings, 0);
            document.getElementById('hpwh-savings').textContent = formatNumber(efficiencyResults.perHousehold.hpwhSavings, 0);
            document.getElementById('dry-savings').textContent = formatNumber(efficiencyResults.perHousehold.drySavings, 0);
            document.getElementById('total-household-savings').textContent = formatNumber(efficiencyResults.perHousehold.totalSavings, 0);
            
            document.getElementById('annual-energy-savings').textContent = `${formatNumber(efficiencyResults.perHousehold.totalSavings, 0)} kWh`;
            document.getElementById('consumption-reduction-pct').textContent = `${formatNumber(efficiencyResults.perHousehold.percentageReduction, 0)}%`;
            
            document.getElementById('system-cost').textContent = `$${formatNumber(efficiencyResults.perHousehold.systemCost, 0)}`;
            document.getElementById('net-system-cost').textContent = `$${formatNumber(efficiencyResults.perHousehold.netSystemCost, 0)}`;
            document.getElementById('annual-cost-savings').textContent = `$${formatNumber(efficiencyResults.perHousehold.annualCostSavings, 0)}`;
            document.getElementById('household-payback').textContent = `${formatNumber(efficiencyResults.perHousehold.paybackPeriod, 1)} years`;
            
            document.getElementById('homes-adopting').textContent = `${formatNumber(efficiencyResults.national.homesAdopting / 1000000, 1)} million`;
            document.getElementById('national-energy-saved').textContent = `${formatNumber(efficiencyResults.national.totalEnergySaved, 1)} TWh`;
            document.getElementById('efficiency-carbon-reduction').textContent = `${formatNumber(efficiencyResults.national.totalCarbonReduction, 1)} million tons`;
            document.getElementById('efficiency-emission-percent').textContent = `${formatNumber(efficiencyResults.national.percentOfUSEmissions, 2)}%`;
            
            document.getElementById('grid-capacity-freed').textContent = `${formatNumber(efficiencyResults.national.gridCapacityFreed, 1)}%`;
            document.getElementById('evs-supported').textContent = `${formatNumber(efficiencyResults.national.totalEvsSupported / 1000000, 1)} million`;
            document.getElementById('efficiency-investment').textContent = `$${formatNumber(efficiencyResults.national.totalInvestment, 1)} billion`;
            document.getElementById('efficiency-jobs').textContent = `${formatNumber(efficiencyResults.national.jobsCreated / 1000000, 1)} million`;
            
            // Calculate renewable energy generation
            const renewableResults = calculateEnergyGeneration(
                foodWasteUtilization, agricultureUtilization, forestUtilization, mswUtilization,
                skySailsUnits, electricityPrice, hempUtilization, algaePercentage
            );
            
            // Calculate water production
            const waterResults = calculateWaterProduction(
                renewableResults, energyAllocationToWater, desalinationAllocation, 
                waterTechsEfficiency, waterValueUSD
            );
            
            // Calculate transportation impact
            const transportationResults = calculateTransportationImpact(
                retrofitPercentage, ccuAdoption, hempUtilization, algaePercentage,
                electricityPrice
            );
            
            // Update summary stats
            updateSummaryStats(
                efficiencyResults, renewableResults, transportationResults, waterResults,
                efficiencyFirst
            );
            
            // Generate phased implementation plan
            const phasedPlan = generatePhasedPlan(
                efficiencyResults, renewableResults, transportationResults, waterResults,
                efficiencyFirst
            );
            
            // Update phased plan table
            updatePhasedPlanTable(phasedPlan);
            
            // Update efficiency savings chart
            updateEfficiencySavingsChart(efficiencyResults);
            
            // Update efficiency metrics
            updateEfficiencyMetrics(efficiencyResults);
            
            // Update renewable metrics
            updateRenewableMetrics(renewableResults);
            
            // Update water metrics
            updateWaterMetrics(waterResults);
        }
        
        // Calculate efficiency savings
        function calculateEfficiencySavings(
            passiveSolarEfficiency, gshpCOP, hpwhEfficiency, efficiencyAdoptionRate, 
            isNewConstruction, electricityPrice
        ) {
            // Per building calculations
            const originalSpaceHeating = 4500; // kWh annually
            const originalCooling = 643; // kWh annually
            const originalWaterHeating = 1928; // kWh annually
            const originalDryer = 536; // kWh annually
            
            // Passive solar impact
            const passiveSolarSavings = originalSpaceHeating * (passiveSolarEfficiency / 100);
            const remainingHeatingLoad = originalSpaceHeating - passiveSolarSavings;
            
            // GSHP impact
            const gshpHeatingElectricity = remainingHeatingLoad / gshpCOP;
            const gshpHeatingSavings = remainingHeatingLoad - gshpHeatingElectricity;
            
            const gshpCoolingElectricity = originalCooling / gshpCOP;
            const gshpCoolingSavings = originalCooling - gshpCoolingElectricity;
            
            // HPWH impact
            const hpwhConsumption = originalWaterHeating / hpwhEfficiency;
            const hpwhSavings = originalWaterHeating - hpwhConsumption;
            
            // Heat pump dryer impact
            const drySavings = originalDryer * 0.28; // 28% savings
            
            // Total savings per household
            const totalHeatingDSavings = passiveSolarSavings + gshpHeatingSavings;
            const totalSavings = totalHeatingDSavings + gshpCoolingSavings + hpwhSavings + drySavings;
            const percentageReduction = (totalSavings / usData.averageHouseholdConsumption) * 100;
            const remainingConsumption = usData.averageHouseholdConsumption - totalSavings;
            
            // Installation costs
            const passiveSolarCost = isNewConstruction ? 8000 : 18000; // USD
            const geothermalInstallCost = 18000; // USD
            const hpwhCost = 1800; // USD
            const heatPumpDryerCost = 1200; // USD
            const totalSystemCost = passiveSolarCost + geothermalInstallCost + hpwhCost + heatPumpDryerCost;
            
            // Incentives
            const federalTaxCredit = (passiveSolarCost + geothermalInstallCost) * 0.30;
            const stateRebate = 3000;
            const utilityRebate = 2000;
            const totalIncentives = federalTaxCredit + stateRebate + utilityRebate;
            const netSystemCost = totalSystemCost - totalIncentives;
            
            // Annual savings
            const annualCostSavings = totalSavings * (electricityPrice / 100);
            
            // Payback periods
            const simplePayback = totalSystemCost / annualCostSavings;
            const netPayback = netSystemCost / annualCostSavings;
            
            // National impact at current adoption rate
            const homesAdopting = usData.households * (efficiencyAdoptionRate / 100);
            const totalEnergySaved = homesAdopting * totalSavings / 1000000000; // TWh
            const totalEnergySavedQuads = totalEnergySaved * 0.003412; // Quad BTUs
            
            // Carbon reduction (0.417 kg CO2/kWh)
            const carbonReductionPerHousehold = totalSavings * 0.417 / 1000; // tons CO2/year
            const totalCarbonReduction = homesAdopting * carbonReductionPerHousehold / 1000000; // million tons CO2
            const percentOfUSEmissions = totalCarbonReduction / usData.co2Emissions * 100;
            
            // EV support
            const evAnnualUsage = 2800; // kWh per year per EV
            const evsPerHousehold = totalSavings / evAnnualUsage;
            const totalEvsSupported = homesAdopting * evsPerHousehold;
            const percentOfVehicleFleet = (totalEvsSupported / usData.totalVehicles) * 100;
            
            // Grid impact
            const gridCapacityFreed = totalEnergySaved / usData.electricityConsumption * 100; // % of grid
            
            // National investment
            const totalNationalInvestment = homesAdopting * netSystemCost / 1000000000; // billion USD
            
            // Jobs created (5 jobs per $1M invested)
            const jobsCreated = Math.round((homesAdopting * netSystemCost / 1000000) * 5);
            
            return {
                perHousehold: {
                    passiveSolarSavings,
                    gshpHeatingSavings,
                    gshpCoolingSavings,
                    hpwhSavings,
                    drySavings,
                    totalSavings,
                    percentageReduction,
                    remainingConsumption,
                    systemCost: totalSystemCost,
                    netSystemCost,
                    annualCostSavings,
                    paybackPeriod: netPayback,
                    carbonReduction: carbonReductionPerHousehold,
                    evsSupported: evsPerHousehold
                },
                national: {
                    homesAdopting,
                    totalEnergySaved,
                    totalEnergySavedQuads,
                    totalCarbonReduction,
                    percentOfUSEmissions,
                    totalEvsSupported,
                    percentOfVehicleFleet,
                    gridCapacityFreed,
                    totalInvestment: totalNationalInvestment,
                    jobsCreated,
                    annualSavings: homesAdopting * annualCostSavings / 1000000000 // billion USD
                }
            };
        }
        
        // Calculate renewable energy generation
        function calculateEnergyGeneration(
            foodWasteUtilization, agricultureUtilization, forestUtilization, mswUtilization,
            skySailsUnits, electricityPrice, hempUtilization, algaePercentage
        ) {
            // Usable waste quantities
            const usableFoodWaste = usData.foodWaste * (foodWasteUtilization / 100);
            const usableAgWaste = usData.agriculturalWaste * (agricultureUtilization / 100);
            const usableForestWaste = usData.forestResidues * (forestUtilization / 100);
            const usableMSW = usData.municipalSolidWaste * (mswUtilization / 100);
            
            // Energy conversion factors
            const foodWasteToEnergy = 1.5; // MWh per ton
            const agriculturalWasteToEnergy = 1.2; // MWh per ton
            const forestResiduesToEnergy = 2.0; // MWh per ton
            const mswToEnergy = 0.6; // MWh per ton
            const foodWasteToMethane = 100; // m³ per ton
            const agricultureToMethane = 60; // m³ per ton
            
            // Energy production calculations
            const energyFromFoodWaste = (usableFoodWaste * foodWasteToEnergy) / 1000000; // TWh
            const energyFromAgWaste = (usableAgWaste * agriculturalWasteToEnergy) / 1000000; // TWh
            const energyFromForestWaste = (usableForestWaste * forestResiduesToEnergy) / 1000000; // TWh
            const energyFromMSW = (usableMSW * mswToEnergy) / 1000000; // TWh
            
            // Biogas & energy from AD
            const biogasFromFoodWaste = usableFoodWaste * foodWasteToMethane; // million m³
            const biogasFromAgWaste = usableAgWaste * agricultureToMethane; // million m³
            const totalBiogas = biogasFromFoodWaste + biogasFromAgWaste; // million m³
            const energyFromBiogas = (totalBiogas * 10) / 1000000; // TWh (10 kWh/m³)
            
            // Biochar & carbon sequestration
            const biocharYieldFactor = 0.3; // 30% yield
            const biocharFeedstock = usableAgWaste + usableForestWaste;
            const biocharProduction = biocharFeedstock * biocharYieldFactor;
            const carbonSequestration = biocharProduction * 0.5; // 0.5 tons CO₂ per ton biochar
            
            // Algae production
            const nutrientRecovery = 0.8; // 80% recovery
            const nutrientsFromAD = (usableFoodWaste + usableAgWaste) * nutrientRecovery;
            const algaeProductionPerTonNutrient = 10; // tons algae per ton nutrient
            const algaeProduction = nutrientsFromAD * algaeProductionPerTonNutrient;
            const algaeLipidContent = 0.25; // 25% lipid content
            const algaeLipids = algaeProduction * algaeLipidContent;
            const biodieselProduction = algaeLipids;
            const biodieselEnergyContent = 11.6; // MWh per ton
            const energyFromAlgae = (biodieselProduction * biodieselEnergyContent) / 1000000; // TWh
            
            // Hemp-based biofuels (from environmental calculator)
            const hempBaseEnergy = 3.3; // TWh (at 50% utilization)
            const energyFromHemp = (hempBaseEnergy * hempUtilization) / 50; // TWh, scaled to user input
            
            // SkySails wind energy
            const skySailsPerUnit = 0.001; // 1 GWh/year per unit
            const energyFromSkySails = skySailsUnits * skySailsPerUnit;
            
            // Total energy generation
            const wasteToEnergyTotal = energyFromFoodWaste + energyFromAgWaste + energyFromForestWaste + 
                                      energyFromMSW + energyFromBiogas;
            const biofuelsTotal = energyFromAlgae + energyFromHemp;
            const totalEnergyGeneration = wasteToEnergyTotal + biofuelsTotal + energyFromSkySails;
            
            // Carbon avoidance from energy generation
            const carbonAvoidance = totalEnergyGeneration * 0.417; // 0.417 tons CO₂/MWh
            const totalCarbonImpact = carbonSequestration + carbonAvoidance;
            
            // Economic calculations
            const wasteToEnergyCost = ((usableFoodWaste + usableAgWaste + usableForestWaste + usableMSW) / 500000) * 50; // $50M per 500k tons
            const skySailsCost = (skySailsUnits * 500000) / 1000000000; // $500k per unit
            const batteryStorageHours = 4; // Default value
            const batteryStorageNeeded = totalEnergyGeneration * batteryStorageHours * 1000; // GWh
            const batteryUnitCost = 500; // $ per kWh
            const batteryCapacity = 2.5; // kWh per unit
            const batteryUnits = (batteryStorageNeeded * 1000000) / batteryCapacity;
            const batteryCost = (batteryUnits * batteryUnitCost) / 1000000000;
            const algaeFacilitiesCost = (nutrientsFromAD / 1000000) * 50; // $50M per million tons
            
            const totalInvestment = wasteToEnergyCost + skySailsCost + batteryCost + algaeFacilitiesCost;
            
            // Annual revenue
            const electricityRevenueRate = electricityPrice / 100; // Convert cents to dollars per kWh
            const electricityRevenue = totalEnergyGeneration * 1000 * electricityRevenueRate; // billion $
            const wasteProcessingRevenue = (usableFoodWaste + usableAgWaste + usableForestWaste + usableMSW) * 50 / 1000; // $50/ton
            const carbonCreditPrice = 30; // $ per ton CO2
            const carbonCreditValue = totalCarbonImpact * carbonCreditPrice / 1000; // billion $
            const totalRevenue = electricityRevenue + wasteProcessingRevenue + carbonCreditValue;
            
            // Operating costs & ROI
            const operatingCost = totalInvestment * 0.05; // 5% of capital cost annually
            const netAnnualRevenue = totalRevenue - operatingCost;
            const paybackPeriod = netAnnualRevenue > 0 ? totalInvestment / netAnnualRevenue : 0;
            
            // Jobs created (3 jobs per $1M in capex for renewable energy)
            const jobsCreated = Math.round(totalInvestment * 1000 * 3); // 3 jobs per million
            
            return {
                wasteUtilization: {
                    foodWaste: usableFoodWaste,
                    agriculturalWaste: usableAgWaste,
                    forestWaste: usableForestWaste,
                    msw: usableMSW,
                    total: usableFoodWaste + usableAgWaste + usableForestWaste + usableMSW
                },
                energyGeneration: {
                    fromFoodWaste: energyFromFoodWaste,
                    fromAgWaste: energyFromAgWaste,
                    fromForestWaste: energyFromForestWaste,
                    fromMSW: energyFromMSW,
                    fromBiogas: energyFromBiogas,
                    wasteToEnergyTotal,
                    fromAlgae: energyFromAlgae,
                    fromHemp: energyFromHemp,
                    fromSkySails: energyFromSkySails,
                    biofuelsTotal,
                    total: totalEnergyGeneration
                },
                production: {
                    biogas: totalBiogas,
                    biochar: biocharProduction,
                    algae: algaeProduction,
                    biodiesel: biodieselProduction
                },
                carbonImpact: {
                    sequestration: carbonSequestration,
                    avoidance: carbonAvoidance,
                    total: totalCarbonImpact,
                    percentOfUSEmissions: (totalCarbonImpact / usData.co2Emissions) * 100
                },
                economics: {
                    wasteToEnergyCost,
                    skySailsCost,
                    batteryCost,
                    algaeFacilitiesCost,
                    totalInvestment,
                    annualRevenue: totalRevenue,
                    operatingCost,
                    netAnnualRevenue,
                    paybackPeriod,
                    jobsCreated
                },
                percentOfDemand: (totalEnergyGeneration / usData.electricityConsumption) * 100
            };
        }
        
        // Calculate transportation impact
        function calculateTransportationImpact(
            retrofitPercentage, ccuAdoption, hempUtilization, algaePercentage, electricityPrice
        ) {
            // Vehicle fleet retrofit
            const fleetBaseReduction = 366.85; // million tons CO2 at 50% retrofit
            const fleetCarbonReduction = (retrofitPercentage / 50) * fleetBaseReduction;
            
            // CCU carbon reduction
            const ccuBaseReduction = 40.5; // million tons CO2 at 90% adoption
            const ccuCarbonReduction = (ccuAdoption / 90) * ccuBaseReduction;
            
            // Hemp carbon reduction
            const hempBaseReduction = 3.78; // million tons CO2 at 50% utilization
            const hempCarbonReduction = (hempUtilization / 50) * hempBaseReduction * 2;
            
            // Algae carbon reduction
            const algaeBaseReduction = 67; // million tons CO2 at 25% adoption
            const algaeCarbonReduction = (algaePercentage / 25) * algaeBaseReduction * 4;
            
            // Energy production from transportation fuels
            const hempEnergyBase = 3.3; // TWh at 50% utilization
            const hempEnergy = (hempUtilization / 50) * hempEnergyBase * 2;
            
            const algaeEnergyBase = 28; // TWh at 25% adoption
            const algaeEnergy = (algaePercentage / 25) * algaeEnergyBase * 4;
            
            const ccuEnergyBase = 25.52; // TWh at 90% adoption
            const ccuEnergy = (ccuAdoption / 90) * ccuEnergyBase;
            
            const totalTransportationEnergy = hempEnergy + algaeEnergy + ccuEnergy;
            
            // Calculate oil import reduction
            const oilImportReduction = (retrofitPercentage / 50) * 3.6; // million barrels/day
            const oilImportPercent = (oilImportReduction / usData.fuelImports) * 100;
            
            // Calculate implementation cost
            const retrofitCost = (retrofitPercentage / 50) * 145; // billion USD
            const ccuCost = (ccuAdoption / 90) * 2.43; // billion USD
            const totalTransportationCost = retrofitCost + ccuCost;
            
            // Calculate economic benefits
            const algaeRevenue = (algaePercentage / 25) * 5 * 4; // billion USD
            const hempRevenue = (hempUtilization / 50) * 0.09 * 2; // billion USD
            const carbonCreditPrice = 30; // $ per ton CO2
            const carbonCredit = (fleetCarbonReduction + ccuCarbonReduction + hempCarbonReduction + algaeCarbonReduction) * carbonCreditPrice / 1000;
            const oilSavings = oilImportReduction * 365 * 70 / 1000; // billion USD ($70/barrel)
            const totalTransportationRevenue = algaeRevenue + hempRevenue + carbonCredit + oilSavings;
            
            // Jobs created
            const algaeJobs = (algaePercentage / 25) * 60000 * 4;
            const hempJobs = (hempUtilization / 50) * 895 * 2;
            const retrofitJobs = (retrofitPercentage / 50) * 50000;
            const totalTransportationJobs = algaeJobs + hempJobs + retrofitJobs;
            
            return {
                carbonReduction: {
                    fleet: fleetCarbonReduction,
                    ccu: ccuCarbonReduction,
                    hemp: hempCarbonReduction,
                    algae: algaeCarbonReduction,
                    total: fleetCarbonReduction + ccuCarbonReduction + hempCarbonReduction + algaeCarbonReduction,
                    percentOfUSEmissions: ((fleetCarbonReduction + ccuCarbonReduction + hempCarbonReduction + algaeCarbonReduction) / usData.co2Emissions) * 100
                },
                energy: {
                    hemp: hempEnergy,
                    algae: algaeEnergy,
                    ccu: ccuEnergy,
                    total: totalTransportationEnergy
                },
                oilImpact: {
                    reduction: oilImportReduction,
                    percent: oilImportPercent
                },
                economics: {
                    cost: totalTransportationCost,
                    revenue: totalTransportationRevenue,
                    netBenefit: totalTransportationRevenue - totalTransportationCost,
                    paybackPeriod: totalTransportationCost / totalTransportationRevenue
                },
                jobs: totalTransportationJobs
            };
        }
        
        // Calculate water production
        function calculateWaterProduction(
            energyData, energyAllocationToWater, desalinationAllocation, 
            waterTechsEfficiency, waterValueUSD
        ) {
            // Energy allocated to water technologies
            const energyForWater = energyData.energyGeneration.total * (energyAllocationToWater / 100);
            
            // Split energy between technologies
            const energyForDesalination = energyForWater * (desalinationAllocation / 100);
            const energyForAWG = energyForWater * (1 - (desalinationAllocation / 100));
            
            // Apply efficiency factor
            const efficiencyFactor = waterTechsEfficiency / 100;
            
            // Water technology parameters
            const desalinationEnergyIntensity = 3.0; // kWh/m³
            const awgEnergyIntensity = 1.5; // kWh/m³
            
            // Calculate water production potential
            const desalinationProduction = (energyForDesalination * 1000000000 * efficiencyFactor) / 
                                         desalinationEnergyIntensity; // m³/year
            const awgProduction = (energyForAWG * 1000000000 * efficiencyFactor) / 
                                awgEnergyIntensity; // m³/year
            const totalWaterProduction = desalinationProduction + awgProduction;
            
            // Calculate population that could be served (100 liters per person per day)
            const populationServed = totalWaterProduction / 365 / 100;
            
            // Calculate percentage of US water withdrawals
            const percentOfTotalWithdrawals = (totalWaterProduction / 1000000000) / usData.totalWaterWithdrawals * 100;
            const percentOfPublicSupply = (totalWaterProduction / 1000000000) / usData.publicWaterSupply * 100;
            
            // Calculate investment required
            const desalinationCapitalCost = 15000; // USD per m³/day capacity
            const awgCapitalCost = 1000; // USD per m³/day capacity
            
            const desalinationInvestment = (desalinationProduction / 365 / 1000) * 
                                         desalinationCapitalCost / 1000; // billion USD
            const awgInvestment = (awgProduction / 365 / 1000) * 
                                awgCapitalCost / 1000; // billion USD
            const totalInvestment = desalinationInvestment + awgInvestment;
            
            // Calculate annual value and payback
            const waterValue = (totalWaterProduction / 1000000) * waterValueUSD; // billion USD
            const desalinationOperatingCost = 0.5; // USD/m³
            const awgOperatingCost = 0.3; // USD/m³
            
            const operatingCost = ((desalinationProduction / 1000000) * desalinationOperatingCost +
                                 (awgProduction / 1000000) * awgOperatingCost); // billion USD
            
            const netAnnualValue = waterValue - operatingCost;
            const paybackPeriod = totalInvestment / netAnnualValue;
            
            // Calculate carbon impact (0.5 kg CO₂ per m³ compared to conventional water)
            const carbonReduction = (totalWaterProduction / 1000000) * 0.5; // million tons CO₂/year
            
            // Agricultural potential
            const agricultureAllocation = 30; // Default value
            const waterForAgriculture = totalWaterProduction * (agricultureAllocation / 100);
            const irrigatedLand = (waterForAgriculture / 1000000) * 0.7 / 0.5; // million hectares (0.5m water per hectare, 70% efficiency)
            const foodProduction = irrigatedLand * 5; // million tons (average 5 tons/hectare)
            
            // Jobs created (2 jobs per $1M in water infrastructure)
            const jobsCreated = Math.round(totalInvestment * 1000 * 2);
            
            return {
                energy: {
                    allocated: energyForWater,
                    forDesalination: energyForDesalination,
                    forAWG: energyForAWG
                },
                production: {
                    desalination: desalinationProduction / 1000000, // million m³/year
                    awg: awgProduction / 1000000, // million m³/year
                    total: totalWaterProduction / 1000000, // million m³/year
                },
                impact: {
                    populationServed: populationServed / 1000000, // million people
                    percentOfTotalWithdrawals,
                    percentOfPublicSupply,
                    irrigatedLand,
                    foodProduction
                },
                economics: {
                    desalinationInvestment,
                    awgInvestment,
                    totalInvestment,
                    waterValue,
                    operatingCost,
                    netAnnualValue,
                    paybackPeriod,
                    jobsCreated
                },
                carbon: {
                    reduction: carbonReduction,
                    percentOfUSEmissions: (carbonReduction / usData.co2Emissions) * 100
                }
            };
        }
        
        // Update summary stats
        function updateSummaryStats(
            efficiencyResults, renewableResults, transportationResults, waterResults,
            efficiencyFirst
        ) {
            // Calculate total metrics
            const netEnergyImpact = renewableResults.energyGeneration.total - efficiencyResults.national.totalEnergySaved;
            
            const totalCarbonReduction = 
                efficiencyResults.national.totalCarbonReduction + 
                renewableResults.carbonImpact.total + 
                transportationResults.carbonReduction.total + 
                waterResults.carbon.reduction;
            
            const totalInvestment = 
                efficiencyResults.national.totalInvestment + 
                renewableResults.economics.totalInvestment + 
                transportationResults.economics.cost + 
                waterResults.economics.totalInvestment;
            
            const totalJobs = 
                efficiencyResults.national.jobsCreated + 
                renewableResults.economics.jobsCreated + 
                transportationResults.jobs + 
                waterResults.economics.jobsCreated;
            
            const annualBenefits = 
                efficiencyResults.national.annualSavings + 
                renewableResults.economics.netAnnualRevenue + 
                transportationResults.economics.netBenefit + 
                waterResults.economics.netAnnualValue;
            
            const paybackPeriod = totalInvestment / annualBenefits;
            
            const percentEmissionsReduced = (totalCarbonReduction / usData.co2Emissions) * 100;
            
            // Update key stats in summary
            document.getElementById('net-energy-impact').textContent = `${formatNumber(netEnergyImpact)} TWh`;
            document.getElementById('net-energy-percent').textContent = `${formatNumber(netEnergyImpact / usData.electricityConsumption * 100)}% of US consumption`;
            
            document.getElementById('carbon-reduction').textContent = `${formatNumber(totalCarbonReduction)} MT`;
            document.getElementById('carbon-percent').textContent = `${formatNumber(percentEmissionsReduced)}% of US emissions`;
            
            document.getElementById('total-investment').textContent = `$${formatNumber(totalInvestment / 1000)}T`;
            document.getElementById('payback-period').textContent = `Payback: ${formatNumber(paybackPeriod, 1)} years`;
            
            document.getElementById('jobs-created').textContent = `${formatNumber(totalJobs / 1000000, 1)}M`;
            document.getElementById('jobs-per-million').textContent = `${formatNumber(totalJobs / (totalInvestment * 1000), 1)} jobs per $1M`;
            
            // Update strategy comparison table
            if (efficiencyFirst) {
                // Current values are for efficiency first
                document.getElementById('eff-first-investment').textContent = `$${formatNumber(totalInvestment / 1000, 2)}T`;
                document.getElementById('eff-first-carbon').textContent = `${formatNumber(totalCarbonReduction)}M tons`;
                document.getElementById('eff-first-payback').textContent = `${formatNumber(paybackPeriod, 1)} years`;
                document.getElementById('eff-first-jobs').textContent = `${formatNumber(totalJobs / 1000000, 1)}M`;
                
                // Generation first scenario (estimated differences)
                document.getElementById('gen-first-investment').textContent = `$${formatNumber(totalInvestment * 1.4 / 1000, 2)}T`;
                document.getElementById('gen-first-carbon').textContent = `${formatNumber(totalCarbonReduction * 0.7)}M tons`;
                document.getElementById('gen-first-payback').textContent = `${formatNumber(paybackPeriod * 1.8, 1)} years`;
                document.getElementById('gen-first-jobs').textContent = `${formatNumber(totalJobs * 0.45 / 1000000, 1)}M`;
            } else {
                // Current values are for generation first
                document.getElementById('gen-first-investment').textContent = `$${formatNumber(totalInvestment / 1000, 2)}T`;
                document.getElementById('gen-first-carbon').textContent = `${formatNumber(totalCarbonReduction)}M tons`;
                document.getElementById('gen-first-payback').textContent = `${formatNumber(paybackPeriod, 1)} years`;
                document.getElementById('gen-first-jobs').textContent = `${formatNumber(totalJobs / 1000000, 1)}M`;
                
                // Efficiency first scenario (estimated differences)
                document.getElementById('eff-first-investment').textContent = `$${formatNumber(totalInvestment * 0.7 / 1000, 2)}T`;
                document.getElementById('eff-first-carbon').textContent = `${formatNumber(totalCarbonReduction * 1.4)}M tons`;
                document.getElementById('eff-first-payback').textContent = `${formatNumber(paybackPeriod * 0.55, 1)} years`;
                document.getElementById('eff-first-jobs').textContent = `${formatNumber(totalJobs * 2.2 / 1000000, 1)}M`;
            }
            
            // Update carbon breakdown chart
            const carbonData = [
                { name: 'Efficiency', value: efficiencyResults.national.totalCarbonReduction },
                { name: 'Renewable Energy', value: renewableResults.carbonImpact.total },
                { name: 'Transportation', value: transportationResults.carbonReduction.total },
                { name: 'Water Systems', value: waterResults.carbon.reduction }
            ];
            
            const carbonChart = document.getElementById('carbon-breakdown');
            carbonChart.innerHTML = '';
            
            const totalCarbon = carbonData.reduce((sum, item) => sum + item.value, 0);
            const colors = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];
            
            carbonData.forEach((item, index) => {
                const barContainer = document.createElement('div');
                barContainer.className = 'bar';
                barContainer.style.position = 'relative';
                
                const barFill = document.createElement('div');
                barFill.className = 'bar-fill';
                barFill.style.width = `${(item.value / totalCarbon) * 100}%`;
                barFill.style.backgroundColor = colors[index];
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = item.name;
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = `${formatNumber(item.value)} MT (${formatNumber((item.value / totalCarbon) * 100)}%)`;
                
                barContainer.appendChild(barFill);
                barContainer.appendChild(barLabel);
                barContainer.appendChild(barValue);
                
                carbonChart.appendChild(barContainer);
            });
        }
        
        // Update phased plan table
        function generatePhasedPlan(
            efficiencyResults, renewableResults, transportationResults, waterResults,
            efficiencyFirst
        ) {
            // Define the key metrics for each phase
            const efficiencyPhases = [0.05, 0.1, 0.2, 0.4, 0.7, 1.0];
            const generationPhases = [0.0, 0.05, 0.2, 0.5, 0.8, 1.0];
            
            // Adjust phase timing based on implementation speed
            const implementationSpeed = parseFloat(document.getElementById('implementation-speed').value);
            const speedFactor = implementationSpeed / 10; // 10 is the default speed
            const baseYearIncrement = 3 / speedFactor;
            
            // Generate different phasing based on efficiency-first vs generation-first approach
            const phases = efficiencyFirst 
              ? efficiencyPhases.map((effPhase, index) => {
                  const year = 2025 + Math.floor(index * baseYearIncrement);
                  const genPhase = generationPhases[Math.max(0, index-1)]; // Generation lags by 1 phase
                  
                  return {
                    year,
                    phase: index + 1,
                    efficiencyFactor: effPhase,
                    generationFactor: genPhase,
                    transportationFactor: genPhase,
                    waterFactor: index >= 3 ? generationPhases[index-2] : 0 // Water starts at phase 3
                  };
                })
              : generationPhases.map((genPhase, index) => {
                  const year = 2025 + Math.floor(index * baseYearIncrement);
                  const effPhase = efficiencyPhases[Math.max(0, index-2)]; // Efficiency lags by 2 phases
                  
                  return {
                    year,
                    phase: index + 1,
                    efficiencyFactor: effPhase,
                    generationFactor: genPhase,
                    transportationFactor: genPhase,
                    waterFactor: index >= 2 ? generationPhases[index-1] : 0 // Water starts at phase 2
                  };
                });
            
            return phases.map(phase => {
              // Scale metrics by phase factors
              const efficiencySavings = efficiencyResults.national.totalEnergySaved * phase.efficiencyFactor;
              const efficiencyCarbonReduction = efficiencyResults.national.totalCarbonReduction * phase.efficiencyFactor;
              const efficiencyInvestment = efficiencyResults.national.totalInvestment * phase.efficiencyFactor;
              const efficiencyJobs = efficiencyResults.national.jobsCreated * phase.efficiencyFactor;
              
              const energyGeneration = renewableResults.energyGeneration.total * phase.generationFactor;
              const energyCarbonReduction = renewableResults.carbonImpact.total * phase.generationFactor;
              const energyInvestment = renewableResults.economics.totalInvestment * phase.generationFactor;
              const energyJobs = renewableResults.economics.jobsCreated * phase.generationFactor;
              
              const transportationCarbonReduction = transportationResults.carbonReduction.total * phase.transportationFactor;
              const transportationInvestment = transportationResults.economics.cost * phase.transportationFactor;
              const transportationJobs = transportationResults.jobs * phase.transportationFactor;
              
              const waterProduction = waterResults.production.total * phase.waterFactor;
              const waterCarbonReduction = waterResults.carbon.reduction * phase.waterFactor;
              const waterInvestment = waterResults.economics.totalInvestment * phase.waterFactor;
              const waterJobs = waterResults.economics.jobsCreated * phase.waterFactor;
              
              // Totals across all components
              const totalInvestment = efficiencyInvestment + energyInvestment + transportationInvestment + waterInvestment;
              const totalCarbonReduction = efficiencyCarbonReduction + energyCarbonReduction + transportationCarbonReduction + waterCarbonReduction;
              const totalJobs = efficiencyJobs + energyJobs + transportationJobs + waterJobs;
              
              // Calculate net energy impact (negative = reduction, positive = generation)
              const netEnergyImpact = energyGeneration - efficiencySavings;
              
              return {
                year: phase.year,
                phase: phase.phase,
                efficiency: {
                  savings: efficiencySavings,
                  carbonReduction: efficiencyCarbonReduction,
                  investment: efficiencyInvestment,
                  jobs: efficiencyJobs
                },
                energy: {
                  generation: energyGeneration,
                  carbonReduction: energyCarbonReduction,
                  investment: energyInvestment,
                  jobs: energyJobs
                },
                transportation: {
                  carbonReduction: transportationCarbonReduction,
                  investment: transportationInvestment,
                  jobs: transportationJobs
                },
                water: {
                  production: waterProduction,
                  carbonReduction: waterCarbonReduction,
                  investment: waterInvestment,
                  jobs: waterJobs
                },
                totals: {
                  investment: totalInvestment,
                  carbonReduction: totalCarbonReduction,
                  jobs: totalJobs,
                  netEnergyImpact,
                  percentOfUSEmissions: (totalCarbonReduction / usData.co2Emissions) * 100
                }
              };
            });
        }
        
        // Update phased plan table
        function updatePhasedPlanTable(phasedPlan) {
            const tableBody = document.getElementById('phased-plan-table');
            tableBody.innerHTML = '';
            
            phasedPlan.forEach(phase => {
                const row = document.createElement('tr');
                
                const phaseCell = document.createElement('td');
                phaseCell.textContent = phase.phase;
                row.appendChild(phaseCell);
                
                const yearCell = document.createElement('td');
                yearCell.textContent = phase.year;
                row.appendChild(yearCell);
                
                const carbonCell = document.createElement('td');
                carbonCell.textContent = formatNumber(phase.totals.carbonReduction);
                row.appendChild(carbonCell);
                
                const investmentCell = document.createElement('td');
                investmentCell.textContent = formatNumber(phase.totals.investment);
                row.appendChild(investmentCell);
                
                const energyCell = document.createElement('td');
                energyCell.textContent = formatNumber(phase.totals.netEnergyImpact);
                row.appendChild(energyCell);
                
                const jobsCell = document.createElement('td');
                jobsCell.textContent = formatNumber(phase.totals.jobs / 1000000, 2);
                row.appendChild(jobsCell);
                
                tableBody.appendChild(row);
            });
        }
        
        // Update efficiency savings chart
        function updateEfficiencySavingsChart(efficiencyResults) {
            const savingsChart = document.getElementById('efficiency-savings-chart');
            savingsChart.innerHTML = '';
            
            const savingsData = [
                { name: 'Passive Solar', value: efficiencyResults.perHousehold.passiveSolarSavings },
                { name: 'GSHP Heating', value: efficiencyResults.perHousehold.gshpHeatingSavings },
                { name: 'GSHP Cooling', value: efficiencyResults.perHousehold.gshpCoolingSavings },
                { name: 'HP Water Heater', value: efficiencyResults.perHousehold.hpwhSavings },
                { name: 'HP Dryer', value: efficiencyResults.perHousehold.drySavings }
            ];
            
            const totalSavings = efficiencyResults.perHousehold.totalSavings;
            const colors = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];
            
            savingsData.forEach((item, index) => {
                const barContainer = document.createElement('div');
                barContainer.className = 'bar';
                barContainer.style.position = 'relative';
                
                const barFill = document.createElement('div');
                barFill.className = 'bar-fill';
                barFill.style.width = `${(item.value / totalSavings) * 100}%`;
                barFill.style.backgroundColor = colors[index];
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = item.name;
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = `${formatNumber(item.value, 0)} kWh (${formatNumber((item.value / totalSavings) * 100, 0)}%)`;
                
                barContainer.appendChild(barFill);
                barContainer.appendChild(barLabel);
                barContainer.appendChild(barValue);
                
                savingsChart.appendChild(barContainer);
            });
        }
        
        // Update efficiency metrics
        function updateEfficiencyMetrics(efficiencyResults) {
            const container = document.getElementById('efficiency-metrics');
            
            // Format the metrics
            const htmlContent = `
                <div class="metric-row">
                    <span class="metric-label">Energy Saved:</span>
                    <span class="metric-value">${formatNumber(efficiencyResults.national.totalEnergySaved)} TWh</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Homes Retrofitted:</span>
                    <span class="metric-value">${formatNumber(efficiencyResults.national.homesAdopting / 1000000)}M</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Cost per Household:</span>
                    <span class="metric-value">$${formatNumber(efficiencyResults.perHousehold.netSystemCost, 0)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Annual Savings:</span>
                    <span class="metric-value">$${formatNumber(efficiencyResults.perHousehold.annualCostSavings, 0)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">EVs Supported:</span>
                    <span class="metric-value">${formatNumber(efficiencyResults.national.totalEvsSupported / 1000000)}M</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Grid Capacity Freed:</span>
                    <span class="metric-value">${formatNumber(efficiencyResults.national.gridCapacityFreed)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label"><strong>Carbon Reduction:</strong></span>
                    <span class="metric-value"><strong>${formatNumber(efficiencyResults.national.totalCarbonReduction)} MT</strong></span>
                </div>
            `;
            
            container.innerHTML = htmlContent;
        }
        
        // Update renewable metrics
        function updateRenewableMetrics(renewableResults) {
            const container = document.getElementById('renewable-metrics');
            
            // Format the metrics
            const htmlContent = `
                <div class="metric-row">
                    <span class="metric-label">Total Generation:</span>
                    <span class="metric-value">${formatNumber(renewableResults.energyGeneration.total)} TWh</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Waste Processed:</span>
                    <span class="metric-value">${formatNumber(renewableResults.wasteUtilization.total)}M tons</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Biochar Produced:</span>
                    <span class="metric-value">${formatNumber(renewableResults.production.biochar)}M tons</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Annual Revenue:</span>
                    <span class="metric-value">$${formatNumber(renewableResults.economics.annualRevenue)}B</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Payback Period:</span>
                    <span class="metric-value">${formatNumber(renew

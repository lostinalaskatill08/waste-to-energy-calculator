<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Energy & Water Transition Calculator</title>
    
    <!-- Basic styles -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.5;
            margin: 0;
            padding: 20px;
            color: #333;
            background-color: #f5f5f5;
        }
        
        h1, h2, h3, h4 {
            margin-top: 0;
        }
        
        .max-w-7xl {
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .p-4 {
            padding: 1rem;
        }
        
        .mb-2 {
            margin-bottom: 0.5rem;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        
        .text-3xl {
            font-size: 1.875rem;
        }
        
        .text-xl {
            font-size: 1.25rem;
        }
        
        .text-sm {
            font-size: 0.875rem;
        }
        
        .text-xs {
            font-size: 0.75rem;
        }
        
        .font-bold {
            font-weight: 700;
        }
        
        .font-medium {
            font-weight: 500;
        }
        
        .text-gray-500 {
            color: #6b7280;
        }
        
        .text-gray-600 {
            color: #4b5563;
        }
        
        .grid {
            display: grid;
        }
        
        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        
        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        
        .gap-4 {
            gap: 1rem;
        }
        
        .gap-6 {
            gap: 1.5rem;
        }
        
        .p-3 {
            padding: 0.75rem;
        }
        
        .rounded-lg {
            border-radius: 0.5rem;
        }
        
        .bg-blue-50 {
            background-color: #eff6ff;
        }
        
        .bg-green-50 {
            background-color: #ecfdf5;
        }
        
        .bg-yellow-50 {
            background-color: #fffbeb;
        }
        
        .bg-purple-50 {
            background-color: #f5f3ff;
        }
        
        .bg-gray-100 {
            background-color: #f3f4f6;
        }
        
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .card-description {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .w-full {
            width: 100%;
        }
        
        .mr-2 {
            margin-right: 0.5rem;
        }
        
        .ml-2 {
            margin-left: 0.5rem;
        }
        
        .mx-2 {
            margin-left: 0.5rem;
            margin-right: 0.5rem;
        }
        
        .flex-grow {
            flex-grow: 1;
        }
        
        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }
        
        .space-y-4 > * + * {
            margin-top: 1rem;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-green-600 {
            color: #059669;
        }
        
        .h-48 {
            height: 12rem;
        }
        
        .h-64 {
            height: 16rem;
        }
        
        .h-80 {
            height: 20rem;
        }
        
        /* Tabs */
        .tabs {
            margin-bottom: 1.5rem;
        }
        
        .tab-list {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1rem;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .tab-list::-webkit-scrollbar {
            display: none;
        }
        
        .tab-trigger {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .tab-trigger.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.5rem;
            text-align: left;
        }
        
        th {
            font-weight: 600;
            background-color: #f9fafb;
        }
        
        td {
            border-top: 1px solid #e5e7eb;
        }
        
        .overflow-x-auto {
            overflow-x: auto;
        }
        
        /* Chart container */
        .chart-container {
            width: 100%;
            height: 300px;
            position: relative;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #2563eb;
            animation: spin 1s linear infinite;
            margin-bottom: 0.5rem;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            .md\:grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
            
            .md\:grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
            
            .md\:grid-cols-4 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="p-4 max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-4">US Integrated Energy & Water Transition Calculator</h1>
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading calculator...</p>
            </div>
        </div>
    </div>
    
    <!-- Load React first -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Load d3 and Recharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.min.js"></script>
    
    <!-- Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Main script - this runs after all dependencies are loaded -->
    <script type="text/babel">
        // Wait for all libraries to load
        window.onload = function() {
            // Check if Recharts is available
            if (typeof Recharts === 'undefined') {
                document.getElementById('app').innerHTML = `
                    <div class="p-4 max-w-7xl mx-auto">
                        <h1 class="text-3xl font-bold mb-4">US Integrated Energy & Water Transition Calculator</h1>
                        <div class="card">
                            <div class="card-content">
                                <p>Error: Required libraries could not be loaded.</p>
                                <p>Please check your internet connection and try again.</p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Destructure components from React
            const { useState, useEffect } = React;
            
            // Destructure components from Recharts
            const {
                LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid,
                Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell,
                AreaChart, Area, ComposedChart, Scatter
            } = Recharts;
            
            // Create a Card component to simulate @/components/ui/card
            const Card = ({ children, className = "" }) => (
                <div className={`card ${className}`}>
                    {children}
                </div>
            );
            
            const CardHeader = ({ children }) => (
                <div className="card-header">
                    {children}
                </div>
            );
            
            const CardTitle = ({ children }) => (
                <h3 className="card-title">
                    {children}
                </h3>
            );
            
            const CardContent = ({ children }) => (
                <div className="card-content">
                    {children}
                </div>
            );
            
            const CardDescription = ({ children }) => (
                <div className="card-description">
                    {children}
                </div>
            );
            
            // Create Tabs components
            const Tabs = ({ children, defaultValue }) => {
                const [activeTab, setActiveTab] = useState(defaultValue);
                
                return (
                    <div className="tabs">
                        {React.Children.map(children, child => {
                            if (child.type === TabsList || child.type === TabsContent) {
                                return React.cloneElement(child, { activeTab, setActiveTab });
                            }
                            return child;
                        })}
                    </div>
                );
            };
            
            const TabsList = ({ children, activeTab, setActiveTab }) => (
                <div className="tab-list">
                    {React.Children.map(children, child => {
                        if (child.type === TabsTrigger) {
                            return React.cloneElement(child, { activeTab, setActiveTab });
                        }
                        return child;
                    })}
                </div>
            );
            
            const TabsTrigger = ({ children, value, activeTab, setActiveTab }) => (
                <div 
                    className={`tab-trigger ${activeTab === value ? 'active' : ''}`}
                    onClick={() => setActiveTab(value)}
                >
                    {children}
                </div>
            );
            
            const TabsContent = ({ children, value, activeTab }) => (
                <div className={`tab-content ${activeTab === value ? 'active' : ''}`}>
                    {children}
                </div>
            );
            
            // Simple chart component placeholders (for tabs where we don't implement full charts)
            const SimplePieChart = ({ data, title }) => (
                <div className="chart-container">
                    <div className="text-center">
                        <h4 className="mb-2">{title}</h4>
                        <p className="text-sm text-gray-600">Simple pie chart visualization would appear here</p>
                        <table className="mt-4">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                {data.map((item, index) => (
                                    <tr key={index}>
                                        <td>{item.name}</td>
                                        <td>{item.value.toFixed(2)}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
            
            const SimpleBarChart = ({ data, title }) => (
                <div className="chart-container">
                    <div className="text-center">
                        <h4 className="mb-2">{title}</h4>
                        <p className="text-sm text-gray-600">Simple bar chart visualization would appear here</p>
                        <table className="mt-4">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                {data.map((item, index) => (
                                    <tr key={index}>
                                        <td>{item.name}</td>
                                        <td>{typeof item.value === 'number' ? item.value.toFixed(2) : item.value}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
            
            // Main Calculator Component
            const IntegratedEnergyWaterCalculator = () => {
                // ---- EFFICIENCY SECTION USER INPUTS ----
                const [passiveSolarEfficiency, setPassiveSolarEfficiency] = useState(50);
                const [gshpCOP, setGshpCOP] = useState(3.5);
                const [hpwhEfficiency, setHpwhEfficiency] = useState(2.5);
                const [efficiencyAdoptionRate, setEfficiencyAdoptionRate] = useState(25);
                const [isNewConstruction, setIsNewConstruction] = useState(false);
                
                // ---- ENERGY GENERATION SECTION USER INPUTS ----
                const [foodWasteUtilization, setFoodWasteUtilization] = useState(60);
                const [agricultureUtilization, setAgricultureUtilization] = useState(40);
                const [forestUtilization, setForestUtilization] = useState(30);
                const [mswUtilization, setMswUtilization] = useState(50);
                const [skySailsUnits, setSkySailsUnits] = useState(50000);
                const [electricityPrice, setElectricityPrice] = useState(10);
                const [carbonCreditPrice, setCarbonCreditPrice] = useState(30);
                const [batteryStorageHours, setBatteryStorageHours] = useState(4);
                
                // ---- TRANSPORTATION SECTION USER INPUTS ----
                const [retrofitPercentage, setRetrofitPercentage] = useState(50);
                const [ccuAdoption, setCcuAdoption] = useState(90);
                const [hempUtilization, setHempUtilization] = useState(50);
                const [algaePercentage, setAlgaePercentage] = useState(25);
                
                // ---- WATER SECTION USER INPUTS ----
                const [energyAllocationToWater, setEnergyAllocationToWater] = useState(5);
                const [desalinationAllocation, setDesalinationAllocation] = useState(60);
                const [waterTechsEfficiency, setWaterTechsEfficiency] = useState(100);
                const [waterValueUSD, setWaterValueUSD] = useState(1.5);
                const [agricultureAllocation, setAgricultureAllocation] = useState(30);
                
                // ---- PHASE ORDERING SECTION ----
                const [efficiencyFirst, setEfficiencyFirst] = useState(true);
                const [implementationSpeed, setImplementationSpeed] = useState(10);
                
                // Fixed parameters
                const usData = {
                    population: 332.8, // million
                    electricityConsumption: 3800, // TWh/year
                    residentialConsumption: 1470, // TWh/year
                    commercialConsumption: 1330, // TWh/year
                    industrialConsumption: 1000, // TWh/year
                    totalEnergyConsumption: 100, // quadrillion BTU/year
                    foodWaste: 63, // million tons/year
                    agriculturalWaste: 800, // million tons/year
                    municipalSolidWaste: 292, // million tons/year
                    forestResidues: 93, // million tons/year
                    constructionWaste: 600, // million tons/year
                    co2Emissions: 5222, // million metric tons/year
                    totalWaterWithdrawals: 450, // billion m³/year
                    publicWaterSupply: 42, // billion m³/year
                    households: 129.9, // million
                    totalVehicles: 290, // million
                    averageHouseholdConsumption: 10715, // kWh annually
                    fuelImports: 9, // million barrels/day
                };
                
                // ---- CALCULATION FUNCTIONS ----
                
                // 1. Calculate efficiency savings
                const calculateEfficiencySavings = () => {
                    // Per building calculations
                    const originalSpaceHeating = 4500; // kWh annually
                    const originalCooling = 643; // kWh annually
                    const originalWaterHeating = 1928; // kWh annually
                    const originalDryer = 536; // kWh annually
                    
                    // Passive solar impact
                    const passiveSolarSavings = originalSpaceHeating * (passiveSolarEfficiency / 100);
                    const remainingHeatingLoad = originalSpaceHeating - passiveSolarSavings;
                    
                    // GSHP impact
                    const gshpHeatingElectricity = remainingHeatingLoad / gshpCOP;
                    const gshpHeatingSavings = remainingHeatingLoad - gshpHeatingElectricity;
                    
                    const gshpCoolingElectricity = originalCooling / gshpCOP;
                    const gshpCoolingSavings = originalCooling - gshpCoolingElectricity;
                    
                    // HPWH impact
                    const hpwhConsumption = originalWaterHeating / hpwhEfficiency;
                    const hpwhSavings = originalWaterHeating - hpwhConsumption;
                    
                    // Heat pump dryer impact
                    const drySavings = originalDryer * 0.28; // 28% savings
                    
                    // Total savings per household
                    const totalHeatingDSavings = passiveSolarSavings + gshpHeatingSavings;
                    const totalSavings = totalHeatingDSavings + gshpCoolingSavings + hpwhSavings + drySavings;
                    const percentageReduction = (totalSavings / usData.averageHouseholdConsumption) * 100;
                    const remainingConsumption = usData.averageHouseholdConsumption - totalSavings;
                    
                    // Installation costs
                    const passiveSolarCost = isNewConstruction ? 8000 : 18000; // USD
                    const geothermalInstallCost = 18000; // USD
                    const hpwhCost = 1800; // USD
                    const heatPumpDryerCost = 1200; // USD
                    const totalSystemCost = passiveSolarCost + geothermalInstallCost + hpwhCost + heatPumpDryerCost;
                    
                    // Incentives
                    const federalTaxCredit = (passiveSolarCost + geothermalInstallCost) * 0.30;
                    const stateRebate = 3000;
                    const utilityRebate = 2000;
                    const totalIncentives = federalTaxCredit + stateRebate + utilityRebate;
                    const netSystemCost = totalSystemCost - totalIncentives;
                    
                    // Annual savings
                    const annualCostSavings = totalSavings * (electricityPrice / 100);
                    
                    // Payback periods
                    const simplePayback = totalSystemCost / annualCostSavings;
                    const netPayback = netSystemCost / annualCostSavings;
                    
                    // National impact at current adoption rate
                    const homesAdopting = usData.households * (efficiencyAdoptionRate / 100);
                    const totalEnergySaved = homesAdopting * totalSavings / 1000000000; // TWh
                    const totalEnergySavedQuads = totalEnergySaved * 0.003412; // Quad BTUs
                    
                    // Carbon reduction (0.417 kg CO2/kWh)
                    const carbonReductionPerHousehold = totalSavings * 0.417 / 1000; // tons CO2/year
                    const totalCarbonReduction = homesAdopting * carbonReductionPerHousehold / 1000000; // million tons CO2
                    const percentOfUSEmissions = totalCarbonReduction / usData.co2Emissions * 100;
                    
                    // EV support
                    const evAnnualUsage = 2800; // kWh per year per EV
                    const evsPerHousehold = totalSavings / evAnnualUsage;
                    const totalEvsSupported = homesAdopting * evsPerHousehold;
                    const percentOfVehicleFleet = (totalEvsSupported / usData.totalVehicles) * 100;
                    
                    // Grid impact
                    const gridCapacityFreed = totalEnergySaved / usData.electricityConsumption * 100; // % of grid
                    
                    // National investment
                    const totalNationalInvestment = homesAdopting * netSystemCost / 1000000000; // billion USD
                    
                    // Jobs created (5 jobs per $1M invested)
                    const jobsCreated = Math.round((homesAdopting * netSystemCost / 1000000) * 5);
                    
                    return {
                        perHousehold: {
                            passiveSolarSavings,
                            gshpHeatingSavings,
                            gshpCoolingSavings,
                            hpwhSavings,
                            drySavings,
                            totalSavings,
                            percentageReduction,
                            remainingConsumption,
                            systemCost: totalSystemCost,
                            netSystemCost,
                            annualCostSavings,
                            paybackPeriod: netPayback,
                            carbonReduction: carbonReductionPerHousehold,
                            evsSupported: evsPerHousehold
                        },
                        national: {
                            homesAdopting,
                            totalEnergySaved,
                            totalEnergySavedQuads,
                            totalCarbonReduction,
                            percentOfUSEmissions,
                            totalEvsSupported,
                            percentOfVehicleFleet,
                            gridCapacityFreed,
                            totalInvestment: totalNationalInvestment,
                            jobsCreated,
                            annualSavings: homesAdopting * annualCostSavings / 1000000000 // billion USD
                        }
                    };
                };
                
                // 2. Calculate renewable energy generation
                const calculateEnergyGeneration = () => {
                    // Usable waste quantities
                    const usableFoodWaste = usData.foodWaste * (foodWasteUtilization / 100);
                    const usableAgWaste = usData.agriculturalWaste * (agricultureUtilization / 100);
                    const usableForestWaste = usData.forestResidues * (forestUtilization / 100);
                    const usableMSW = usData.municipalSolidWaste * (mswUtilization / 100);
                    
                    // Energy conversion factors
                    const foodWasteToEnergy = 1.5; // MWh per ton
                    const agriculturalWasteToEnergy = 1.2; // MWh per ton
                    const forestResiduesToEnergy = 2.0; // MWh per ton
                    const mswToEnergy = 0.6; // MWh per ton
                    const foodWasteToMethane = 100; // m³ per ton
                    const agricultureToMethane = 60; // m³ per ton
                    
                    // Energy production calculations
                    const energyFromFoodWaste = (usableFoodWaste * foodWasteToEnergy) / 1000000; // TWh
                    const energyFromAgWaste = (usableAgWaste * agriculturalWasteToEnergy) / 1000000; // TWh
                    const energyFromForestWaste = (usableForestWaste * forestResiduesToEnergy) / 1000000; // TWh
                    const energyFromMSW = (usableMSW * mswToEnergy) / 1000000; // TWh
                    
                    // Biogas & energy from AD
                    const biogasFromFoodWaste = usableFoodWaste * foodWasteToMethane; // million m³
                    const biogasFromAgWaste = usableAgWaste * agricultureToMethane; // million m³
                    const totalBiogas = biogasFromFoodWaste + biogasFromAgWaste; // million m³
                    const energyFromBiogas = (totalBiogas * 10) / 1000000; // TWh (10 kWh/m³)
                    
                    // Biochar & carbon sequestration
                    const biocharYieldFactor = 0.3; // 30% yield
                    const biocharFeedstock = usableAgWaste + usableForestWaste;
                    const biocharProduction = biocharFeedstock * biocharYieldFactor;
                    const carbonSequestration = biocharProduction * 0.5; // 0.5 tons CO₂ per ton biochar
                    
                    // Algae production
                    const nutrientRecovery = 0.8; // 80% recovery
                    const nutrientsFromAD = (usableFoodWaste + usableAgWaste) * nutrientRecovery;
                    const algaeProductionPerTonNutrient = 10; // tons algae per ton nutrient
                    const algaeProduction = nutrientsFromAD * algaeProductionPerTonNutrient;
                    const algaeLipidContent = 0.25; // 25% lipid content
                    const algaeLipids = algaeProduction * algaeLipidContent;
                    const biodieselProduction = algaeLipids;
                    const biodieselEnergyContent = 11.6; // MWh per ton
                    const energyFromAlgae = (biodieselProduction * biodieselEnergyContent) / 1000000; // TWh
                    
                    // Hemp-based biofuels (from environmental calculator)
                    const hempBaseEnergy = 3.3; // TWh (at 50% utilization)
                    const energyFromHemp = (hempBaseEnergy * hempUtilization) / 50; // TWh, scaled to user input
                    
                    // SkySails wind energy
                    const skySailsPerUnit = 0.001; // 1 GWh/year per unit
                    const energyFromSkySails = skySailsUnits * skySailsPerUnit;
                    
                    // Total energy generation
                    const wasteToEnergyTotal = energyFromFoodWaste + energyFromAgWaste + energyFromForestWaste + 
                                              energyFromMSW + energyFromBiogas;
                    const biofuelsTotal = energyFromAlgae + energyFromHemp;
                    const totalEnergyGeneration = wasteToEnergyTotal + biofuelsTotal + energyFromSkySails;
                    
                    // Carbon avoidance from energy generation
                    const carbonAvoidance = totalEnergyGeneration * 0.417; // 0.417 tons CO₂/MWh
                    const totalCarbonImpact = carbonSequestration + carbonAvoidance;
                    
                    // Economic calculations
                    const wasteToEnergyCost = ((usableFoodWaste + usableAgWaste + usableForestWaste + usableMSW) / 500000) * 50; // $50M per 500k tons
                    const skySailsCost = (skySailsUnits * 500000) / 1000000000; // $500k per unit
                    const batteryStorageNeeded = totalEnergyGeneration * batteryStorageHours * 1000; // GWh
                    const batteryUnitCost = 500; // $ per kWh
                    const batteryCapacity = 2.5; // kWh per unit
                    const batteryUnits = (batteryStorageNeeded * 1000000) / batteryCapacity;
                    const batteryCost = (batteryUnits * batteryUnitCost) / 1000000000;
                    const algaeFacilitiesCost = (nutrientsFromAD / 1000000) * 50; // $50M per million tons
                    
                    const totalInvestment = wasteToEnergyCost + skySailsCost + batteryCost + algaeFacilitiesCost;
                    
                    // Annual revenue
                    const electricityRevenue = totalEnergyGeneration * 1000 * (electricityPrice / 100); // billion $ (price in cents/kWh)
                    const wasteProcessingRevenue = (usableFoodWaste + usableAgWaste + usableForestWaste + usableMSW) * 50 / 1000; // $50/ton
                    const carbonCreditValue = totalCarbonImpact * carbonCreditPrice / 1000; // billion $
                    const totalRevenue = electricityRevenue + wasteProcessingRevenue + carbonCreditValue;
                    
                    // Operating costs & ROI
                    const operatingCost = totalInvestment * 0.05; // 5% of capital cost annually
                    const netAnnualRevenue = totalRevenue - operatingCost;
                    const paybackPeriod = netAnnualRevenue > 0 ? totalInvestment / netAnnualRevenue : 0;
                    
                    // Jobs created (3 jobs per $1M in capex for renewable energy)
                    const jobsCreated = Math.round(totalInvestment * 1000 * 3); // 3 jobs per million
                    
                    return {
                        wasteUtilization: {
                            foodWaste: usableFoodWaste,
                            agriculturalWaste: usableAgWaste,
                            forestWaste: usableForestWaste,
                            msw: usableMSW,
                            total: usableFoodWaste + usableAgWaste + usableForestWaste + usableMSW
                        },
                        energyGeneration: {
                            fromFoodWaste: energyFromFoodWaste,
                            fromAgWaste: energyFromAgWaste,
                            fromForestWaste: energyFromForestWaste,
                            fromMSW: energyFromMSW,
                            fromBiogas: energyFromBiogas,
                            wasteToEnergyTotal,
                            fromAlgae: energyFromAlgae,
                            fromHemp: energyFromHemp,
                            fromSkySails: energyFromSkySails,
                            biofuelsTotal,
                            total: totalEnergyGeneration
                        },
                        production: {
                            biogas: totalBiogas,
                            biochar: biocharProduction,
                            algae: algaeProduction,
                            biodiesel: biodieselProduction
                        },
                        carbonImpact: {
                            sequestration: carbonSequestration,
                            avoidance: carbonAvoidance,
                            total: totalCarbonImpact,
                            percentOfUSEmissions: (totalCarbonImpact / usData.co2Emissions) * 100
                        },
                        economics: {
                            wasteToEnergyCost,
                            skySailsCost,
                            batteryCost,
                            algaeFacilitiesCost,
                            totalInvestment,
                            annualRevenue: totalRevenue,
                            operatingCost,
                            netAnnualRevenue,
                            paybackPeriod,
                            jobsCreated
                        },
                        percentOfDemand: (totalEnergyGeneration / usData.electricityConsumption) * 100
                    };
                };
                
                // 3. Calculate transportation impact
                const calculateTransportationImpact = () => {
                    // Vehicle fleet retrofit
                    const fleetBaseReduction = 366.85; // million tons CO2 at 50% retrofit
                    const fleetCarbonReduction = (retrofitPercentage / 50) * fleetBaseReduction;
                    
                    // CCU carbon reduction
                    const ccuBaseReduction = 40.5; // million tons CO2 at 90% adoption
                    const ccuCarbonReduction = (ccuAdoption / 90) * ccuBaseReduction;
                    
                    // Hemp carbon reduction
                    const hempBaseReduction = 3.78; // million tons CO2 at 50% utilization
                    const hempCarbonReduction = (hempUtilization / 50) * hempBaseReduction * 2;
                    
                    // Algae carbon reduction
                    const algaeBaseReduction = 67; // million tons CO2 at 25% adoption
                    const algaeCarbonReduction = (algaePercentage / 25) * algaeBaseReduction * 4;
                    
                    // Energy production from transportation fuels
                    const hempEnergyBase = 3.3; // TWh at 50% utilization
                    const hempEnergy = (hempUtilization / 50) * hempEnergyBase * 2;
                    
                    const algaeEnergyBase = 28; // TWh at 25% adoption
                    const algaeEnergy = (algaePercentage / 25) * algaeEnergyBase * 4;
                    
                    const ccuEnergyBase = 25.52; // TWh at 90% adoption
                    const ccuEnergy = (ccuAdoption / 90) * ccuEnergyBase;
                    
                    const totalTransportationEnergy = hempEnergy + algaeEnergy + ccuEnergy;
                    
                    // Calculate oil import reduction
                    const oilImportReduction = (retrofitPercentage / 50) * 3.6; // million barrels/day
                    const oilImportPercent = (oilImportReduction / usData.fuelImports) * 100;
                    
                    // Calculate implementation cost
                    const retrofitCost = (retrofitPercentage / 50) * 145; // billion USD
                    const ccuCost = (ccuAdoption / 90) * 2.43; // billion USD
                    const totalTransportationCost = retrofitCost + ccuCost;
                    
                    // Calculate economic benefits
                    const algaeRevenue = (algaePercentage / 25) * 5 * 4; // billion USD
                    const hempRevenue = (hempUtilization / 50) * 0.09 * 2; // billion USD
                    const carbonCredit = (fleetCarbonReduction + ccuCarbonReduction + hempCarbonReduction + algaeCarbonReduction) * carbonCreditPrice / 1000; // $30/ton
                    const oilSavings = oilImportReduction * 365 * 70 / 1000; // billion USD ($70/barrel)
                    const totalTransportationRevenue = algaeRevenue + hempRevenue + carbonCredit + oilSavings;
                    
                    // Jobs created
                    const algaeJobs = (algaePercentage / 25) * 60000 * 4;
                    const hempJobs = (hempUtilization / 50) * 895 * 2;
                    const retrofitJobs = (retrofitPercentage / 50) * 50000;
                    const totalTransportationJobs = algaeJobs + hempJobs + retrofitJobs;
                    
                    return {
                        carbonReduction: {
                            fleet: fleetCarbonReduction,
                            ccu: ccuCarbonReduction,
                            hemp: hempCarbonReduction,
                            algae: algaeCarbonReduction,
                            total: fleetCarbonReduction + ccuCarbonReduction + hempCarbonReduction + algaeCarbonReduction,
                            percentOfUSEmissions: ((fleetCarbonReduction + ccuCarbonReduction + hempCarbonReduction + algaeCarbonReduction) / usData.co2Emissions) * 100
                        },
                        energy: {
                            hemp: hempEnergy,
                            algae: algaeEnergy,
                            ccu: ccuEnergy,
                            total: totalTransportationEnergy
                        },
                        oilImpact: {
                            reduction: oilImportReduction,
                            percent: oilImportPercent
                        },
                        economics: {
                            cost: totalTransportationCost,
                            revenue: totalTransportationRevenue,
                            netBenefit: totalTransportationRevenue - totalTransportationCost,
                            paybackPeriod: totalTransportationCost / totalTransportationRevenue
                        },
                        jobs: totalTransportationJobs
                    };
                };
                
                // 4. Calculate water production
                const calculateWaterProduction = (energyData) => {
                    // Energy allocated to water technologies
                    const energyForWater = energyData.energyGeneration.total * (energyAllocationToWater / 100);
                    
                    // Split energy between technologies
                    const energyForDesalination = energyForWater * (desalinationAllocation / 100);
                    const energyForAWG = energyForWater * (1 - (desalinationAllocation / 100));
                    
                    // Apply efficiency factor
                    const efficiencyFactor = waterTechsEfficiency / 100;
                    
                    // Water technology parameters
                    const desalinationEnergyIntensity = 3.0; // kWh/m³
                    const awgEnergyIntensity = 1.5; // kWh/m³
                    
                    // Calculate water production potential
                    const desalinationProduction = (energyForDesalination * 1000000000 * efficiencyFactor) / 
                                                 desalinationEnergyIntensity; // m³/year
                    const awgProduction = (energyForAWG * 1000000000 * efficiencyFactor) / 
                                        awgEnergyIntensity; // m³/year
                    const totalWaterProduction = desalinationProduction + awgProduction;
                    
                    // Calculate population that could be served (100 liters per person per day)
                    const populationServed = totalWaterProduction / 365 / 100;
                    
                    // Calculate percentage of US water withdrawals
                    const percentOfTotalWithdrawals = (totalWaterProduction / 1000000000) / usData.totalWaterWithdrawals * 100;
                    const percentOfPublicSupply = (totalWaterProduction / 1000000000) / usData.publicWaterSupply * 100;
                    
                    // Calculate investment required
                    const desalinationCapitalCost = 15000; // USD per m³/day capacity
                    const awgCapitalCost = 1000; // USD per m³/day capacity
                    
                    const desalinationInvestment = (desalinationProduction / 365 / 1000) * 
                                                 desalinationCapitalCost / 1000; // billion USD
                    const awgInvestment = (awgProduction / 365 / 1000) * 
                                        awgCapitalCost / 1000; // billion USD
                    const totalInvestment = desalinationInvestment + awgInvestment;
                    
                    // Calculate annual value and payback
                    const waterValue = (totalWaterProduction / 1000000) * waterValueUSD; // billion USD
                    const desalinationOperatingCost = 0.5; // USD/m³
                    const awgOperatingCost = 0.3; // USD/m³
                    
                    const operatingCost = ((desalinationProduction / 1000000) * desalinationOperatingCost +
                                         (awgProduction / 1000000) * awgOperatingCost); // billion USD
                    
                    const netAnnualValue = waterValue - operatingCost;
                    const paybackPeriod = totalInvestment / netAnnualValue;
                    
                    // Calculate carbon impact (0.5 kg CO₂ per m³ compared to conventional water)
                    const carbonReduction = (totalWaterProduction / 1000000) * 0.5; // million tons CO₂/year
                    
                    // Agricultural potential
                    const waterForAgriculture = totalWaterProduction * (agricultureAllocation / 100);
                    const irrigatedLand = (waterForAgriculture / 1000000) * 0.7 / 0.5; // million hectares (0.5m water per hectare, 70% efficiency)
                    const foodProduction = irrigatedLand * 5; // million tons (average 5 tons/hectare)
                    
                    // Jobs created (2 jobs per $1M in water infrastructure)
                    const jobsCreated = Math.round(totalInvestment * 1000 * 2);
                    
                    return {
                        energy: {
                            allocated: energyForWater,
                            forDesalination: energyForDesalination,
                            forAWG: energyForAWG
                        },
                        production: {
                            desalination: desalinationProduction / 1000000, // million m³/year
                            awg: awgProduction / 1000000, // million m³/year
                            total: totalWaterProduction / 1000000, // million m³/year
                        },
                        impact: {
                            populationServed: populationServed / 1000000, // million people
                            percentOfTotalWithdrawals,
                            percentOfPublicSupply,
                            irrigatedLand,
                            foodProduction
                        },
                        economics: {
                            desalinationInvestment,
                            awgInvestment,
                            totalInvestment,
                            waterValue,
                            operatingCost,
                            netAnnualValue,
                            paybackPeriod,
                            jobsCreated
                        },
                        carbon: {
                            reduction: carbonReduction,
                            percentOfUSEmissions: (carbonReduction / usData.co2Emissions) * 100
                        }
                    };
                };
                
                // 5. Generate phased implementation plan
                const generatePhasedPlan = (efficiencyData, renewableData, transportationData, waterData) => {
                    // Define the key metrics for each phase
                    const efficiencyPhases = [0.05, 0.1, 0.2, 0.4, 0.7, 1.0];
                    const generationPhases = [0.0, 0.05, 0.2, 0.5, 0.8, 1.0];
                    
                    // Adjust phase timing based on implementation speed (1-20 scale)
                    const speedFactor = implementationSpeed / 10; // 10 is the default speed
                    const baseYearIncrement = 3 / speedFactor;
                    
                    // Generate different phasing based on efficiency-first vs generation-first approach
                    const phases = efficiencyFirst 
                      ? efficiencyPhases.map((effPhase, index) => {
                          const year = 2025 + Math.floor(index * baseYearIncrement);
                          const genPhase = generationPhases[Math.max(0, index-1)]; // Generation lags by 1 phase
                          
                          return {
                            year,
                            phase: index + 1,
                            efficiencyFactor: effPhase,
                            generationFactor: genPhase,
                            transportationFactor: genPhase,
                            waterFactor: index >= 3 ? generationPhases[index-2] : 0 // Water starts at phase 3
                          };
                        })
                      : generationPhases.map((genPhase, index) => {
                          const year = 2025 + Math.floor(index * baseYearIncrement);
                          const effPhase = efficiencyPhases[Math.max(0, index-2)]; // Efficiency lags by 2 phases
                          
                          return {
                            year,
                            phase: index + 1,
                            efficiencyFactor: effPhase,
                            generationFactor: genPhase,
                            transportationFactor: genPhase,
                            waterFactor: index >= 2 ? generationPhases[index-1] : 0 // Water starts at phase 2
                          };
                        });
                    
                    return phases.map(phase => {
                      // Scale metrics by phase factors
                      const efficiencySavings = efficiencyData.national.totalEnergySaved * phase.efficiencyFactor;
                      const efficiencyCarbonReduction = efficiencyData.national.totalCarbonReduction * phase.efficiencyFactor;
                      const efficiencyInvestment = efficiencyData.national.totalInvestment * phase.efficiencyFactor;
                      const efficiencyJobs = efficiencyData.national.jobsCreated * phase.efficiencyFactor;
                      
                      const energyGeneration = renewableData.energyGeneration.total * phase.generationFactor;
                      const energyCarbonReduction = renewableData.carbonImpact.total * phase.generationFactor;
                      const energyInvestment = renewableData.economics.totalInvestment * phase.generationFactor;
                      const energyJobs = renewableData.economics.jobsCreated * phase.generationFactor;
                      
                      const transportationCarbonReduction = transportationData.carbonReduction.total * phase.transportationFactor;
                      const transportationInvestment = transportationData.economics.cost * phase.transportationFactor;
                      const transportationJobs = transportationData.jobs * phase.transportationFactor;
                      
                      const waterProduction = waterData.production.total * phase.waterFactor;
                      const waterCarbonReduction = waterData.carbon.reduction * phase.waterFactor;
                      const waterInvestment = waterData.economics.totalInvestment * phase.waterFactor;
                      const waterJobs = waterData.economics.jobsCreated * phase.waterFactor;
                      
                      // Totals across all components
                      const totalInvestment = efficiencyInvestment + energyInvestment + transportationInvestment + waterInvestment;
                      const totalCarbonReduction = efficiencyCarbonReduction + energyCarbonReduction + transportationCarbonReduction + waterCarbonReduction;
                      const totalJobs = efficiencyJobs + energyJobs + transportationJobs + waterJobs;
                      
                      // Calculate net energy impact (negative = reduction, positive = generation)
                      const netEnergyImpact = energyGeneration - efficiencySavings;
                      
                      return {
                        year: phase.year,
                        phase: phase.phase,
                        efficiency: {
                          savings: efficiencySavings,
                          carbonReduction: efficiencyCarbonReduction,
                          investment: efficiencyInvestment,
                          jobs: efficiencyJobs
                        },
                        energy: {
                          generation: energyGeneration,
                          carbonReduction: energyCarbonReduction,
                          investment: energyInvestment,
                          jobs: energyJobs
                        },
                        transportation: {
                          carbonReduction: transportationCarbonReduction,
                          investment: transportationInvestment,
                          jobs: transportationJobs
                        },
                        water: {
                          production: waterProduction,
                          carbonReduction: waterCarbonReduction,
                          investment: waterInvestment,
                          jobs: waterJobs
                        },
                        totals: {
                          investment: totalInvestment,
                          carbonReduction: totalCarbonReduction,
                          jobs: totalJobs,
                          netEnergyImpact,
                          percentOfUSEmissions: (totalCarbonReduction / usData.co2Emissions) * 100
                        }
                      };
                    });
                };
                
                // Calculate all results
                const efficiencyResults = calculateEfficiencySavings();
                const renewableResults = calculateEnergyGeneration();
                const transportationResults = calculateTransportationImpact();
                const waterResults = calculateWaterProduction(renewableResults);
                const phasedPlan = generatePhasedPlan(efficiencyResults, renewableResults, transportationResults, waterResults);
                
                // Prepare summary metrics
                const summaryMetrics = {
                    efficiency: {
                        energySaved: efficiencyResults.national.totalEnergySaved,
                        carbonReduction: efficiencyResults.national.totalCarbonReduction,
                        investment: efficiencyResults.national.totalInvestment,
                        jobs: efficiencyResults.national.jobsCreated,
                        payback: efficiencyResults.perHousehold.paybackPeriod
                    },
                    renewable: {
                        energyGenerated: renewableResults.energyGeneration.total,
                        carbonReduction: renewableResults.carbonImpact.total,
                        investment: renewableResults.economics.totalInvestment,
                        jobs: renewableResults.economics.jobsCreated,
                        payback: renewableResults.economics.paybackPeriod
                    },
                    transportation: {
                        carbonReduction: transportationResults.carbonReduction.total,
                        oilReduction: transportationResults.oilImpact.reduction,
                        investment: transportationResults.economics.cost,
                        jobs: transportationResults.jobs,
                        payback: transportationResults.economics.paybackPeriod
                    },
                    water: {
                        production: waterResults.production.total,
                        populationServed: waterResults.impact.populationServed,
                        carbonReduction: waterResults.carbon.reduction,
                        investment: waterResults.economics.totalInvestment,
                        jobs: waterResults.economics.jobsCreated,
                        payback: waterResults.economics.paybackPeriod
                    },
                    totals: {
                        netEnergyImpact: renewableResults.energyGeneration.total - efficiencyResults.national.totalEnergySaved,
                        carbonReduction: efficiencyResults.national.totalCarbonReduction + 
                                      renewableResults.carbonImpact.total + 
                                      transportationResults.carbonReduction.total + 
                                      waterResults.carbon.reduction,
                        investment: efficiencyResults.national.totalInvestment + 
                                  renewableResults.economics.totalInvestment + 
                                  transportationResults.economics.cost + 
                                  waterResults.economics.totalInvestment,
                        jobs: efficiencyResults.national.jobsCreated + 
                             renewableResults.economics.jobsCreated + 
                             transportationResults.jobs + 
                             waterResults.economics.jobsCreated,
                        payback: (efficiencyResults.national.totalInvestment + 
                                 renewableResults.economics.totalInvestment + 
                                 transportationResults.economics.cost + 
                                 waterResults.economics.totalInvestment) / 
                                 (efficiencyResults.national.annualSavings + 
                                 renewableResults.economics.netAnnualRevenue + 
                                 transportationResults.economics.netBenefit + 
                                 waterResults.economics.netAnnualValue)
                    }
                };
                
                // Percentage of US emissions reduced
                summaryMetrics.totals.percentEmissionsReduced = (summaryMetrics.totals.carbonReduction / usData.co2Emissions) * 100;
                
                // Prepare chart data
                const energySourceData = [
                    { name: 'Waste-to-Energy', value: renewableResults.energyGeneration.wasteToEnergyTotal },
                    { name: 'Biofuels', value: renewableResults.energyGeneration.biofuelsTotal },
                    { name: 'SkySails Wind', value: renewableResults.energyGeneration.fromSkySails }
                ];
                
                const carbonReductionData = [
                    { name: 'Efficiency', value: efficiencyResults.national.totalCarbonReduction },
                    { name: 'Renewable Energy', value: renewableResults.carbonImpact.total },
                    { name: 'Transportation', value: transportationResults.carbonReduction.total },
                    { name: 'Water Systems', value: waterResults.carbon.reduction }
                ];
                
                const investmentData = [
                    { name: 'Building Efficiency', value: efficiencyResults.national.totalInvestment },
                    { name: 'Renewable Energy', value: renewableResults.economics.totalInvestment },
                    { name: 'Transportation', value: transportationResults.economics.cost },
                    { name: 'Water Systems', value: waterResults.economics.totalInvestment }
                ];
                
                const jobsData = [
                    { name: 'Building Efficiency', value: efficiencyResults.national.jobsCreated },
                    { name: 'Renewable Energy', value: renewableResults.economics.jobsCreated },
                    { name: 'Transportation', value: transportationResults.jobs },
                    { name: 'Water Systems', value: waterResults.economics.jobsCreated }
                ];
                
                const waterProductionData = [
                    { name: 'Solar Desalination', value: waterResults.production.desalination },
                    { name: 'Atmospheric Water', value: waterResults.production.awg }
                ];
                
                const efficiencyVsGenerationData = [
                    { name: 'Efficiency First', investment: summaryMetrics.totals.investment, carbon: summaryMetrics.totals.carbonReduction, payback: summaryMetrics.totals.payback, jobs: summaryMetrics.totals.jobs / 1000000 },
                    // Compare to alternative scenario (generation first) with efficiency lagging
                    { name: 'Generation First', investment: summaryMetrics.totals.investment * 1.4, carbon: summaryMetrics.totals.carbonReduction * 0.7, payback: summaryMetrics.totals.payback * 1.8, jobs: summaryMetrics.totals.jobs * 0.45 / 1000000 }
                ];
                
                const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d'];

                // Format numbers for display
                const formatNumber = (num, decimals = 2) => {
                    if (num === undefined || num === null) return 'N/A';
                    if (num === 0) return '0';
                    
                    // For small numbers, just use fixed precision
                    if (Math.abs(num) < 1000) {
                        return num.toFixed(decimals);
                    }
                    
                    // For larger numbers, use locale string with commas
                    return num.toLocaleString(undefined, { 
                        minimumFractionDigits: decimals,
                        maximumFractionDigits: decimals
                    });
                };
                
                return (
                    <div className="p-4 max-w-7xl mx-auto">
                        <h1 className="text-3xl font-bold mb-2">US Integrated Energy & Water Transition Calculator</h1>
                        <p className="mb-6">Explore the combined impact of energy efficiency, renewable generation, transportation improvements, and water production systems.</p>
                        
                        <Tabs defaultValue="summary">
                            <TabsList>
                                <TabsTrigger value="summary">Summary</TabsTrigger>
                                <TabsTrigger value="parameters">Input Parameters</TabsTrigger>
                                <TabsTrigger value="efficiency">Energy Efficiency</TabsTrigger>
                                <TabsTrigger value="renewable">Renewable Energy</TabsTrigger>
                                <TabsTrigger value="transport">Transportation</TabsTrigger>
                                <TabsTrigger value="water">Water Systems</TabsTrigger>
                                <TabsTrigger value="phased">Phased Implementation</TabsTrigger>
                            </TabsList>
                            
                            {/* Summary Tab */}
                            <TabsContent value="summary">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Strategy Approach</CardTitle>
                                            <CardDescription>Compare efficiency-first vs. generation-first approaches</CardDescription>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="flex items-center mb-6">
                                                <span className="mr-2 text-sm font-medium">Generation First</span>
                                                <div className="flex-grow mx-2">
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="1" 
                                                        step="1"
                                                        value={efficiencyFirst ? 1 : 0} 
                                                        onChange={(e) => setEfficiencyFirst(parseInt(e.target.value) === 1)}
                                                        className="w-full"
                                                    />
                                                </div>
                                                <span className="ml-2 text-sm font-medium">Efficiency First</span>
                                            </div>
                                            
                                            <div className="mb-4">
                                                <span className="text-sm font-medium">Implementation Speed</span>
                                                <input 
                                                    type="range" 
                                                    min="1" 
                                                    max="20" 
                                                    value={implementationSpeed} 
                                                    onChange={(e) => setImplementationSpeed(parseInt(e.target.value))}
                                                    className="w-full"
                                                />
                                                <div className="flex justify-between">
                                                    <span className="text-xs">Slower</span>
                                                    <span className="text-sm font-medium">{implementationSpeed}</span>
                                                    <span className="text-xs">Faster</span>
                                                </div>
                                            </div>
                                            
                                            <SimpleBarChart 
                                                data={efficiencyVsGenerationData.map(item => ({
                                                    name: item.name,
                                                    value: `Investment: $${formatNumber(item.investment)}T, Carbon: ${formatNumber(item.carbon)}MT, Payback: ${formatNumber(item.payback, 1)}y, Jobs: ${formatNumber(item.jobs)}M`
                                                }))}
                                                title="Strategy Comparison"
                                            />
                                        </CardContent>
                                    </Card>
                                    
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Key Results</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="bg-blue-50 p-3 rounded-lg">
                                                    <div className="text-sm text-gray-600">Net Energy Impact</div>
                                                    <div className="text-xl font-bold">{formatNumber(summaryMetrics.totals.netEnergyImpact)} TWh</div>
                                                    <div className="text-xs text-gray-500">{formatNumber(summaryMetrics.totals.netEnergyImpact / usData.electricityConsumption * 100)}% of US consumption</div>
                                                </div>
                                                
                                                <div className="bg-green-50 p-3 rounded-lg">
                                                    <div className="text-sm text-gray-600">Carbon Reduction</div>
                                                    <div className="text-xl font-bold">{formatNumber(summaryMetrics.totals.carbonReduction)} MT</div>
                                                    <div className="text-xs text-gray-500">{formatNumber(summaryMetrics.totals.percentEmissionsReduced)}% of US emissions</div>
                                                </div>
                                                
                                                <div className="bg-yellow-50 p-3 rounded-lg">
                                                    <div className="text-sm text-gray-600">Total Investment</div>
                                                    <div className="text-xl font-bold">${formatNumber(summaryMetrics.totals.investment)}T</div>
                                                    <div className="text-xs text-gray-500">Payback: {formatNumber(summaryMetrics.totals.payback, 1)} years</div>
                                                </div>
                                                
                                                <div className="bg-purple-50 p-3 rounded-lg">
                                                    <div className="text-sm text-gray-600">Jobs Created</div>
                                                    <div className="text-xl font-bold">{formatNumber(summaryMetrics.totals.jobs / 1000000, 2)}M</div>
                                                    <div className="text-xs text-gray-500">{formatNumber(summaryMetrics.totals.jobs / summaryMetrics.totals.investment / 1000, 1)} jobs per $1M</div>
                                                </div>
                                            </div>
                                            
                                            <div className="mt-6">
                                                <h3 className="text-lg font-semibold mb-2">Carbon Reduction by Component</h3>
                                                <SimplePieChart 
                                                    data={carbonReductionData}
                                                    title="Carbon Reduction Sources"
                                                />
                                            </div>
                                        </CardContent>
                                    </Card>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Efficiency Impact</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="space-y-2">
                                                <div className="flex justify-between">
                                                    <span>Energy Saved:</span>
                                                    <span className="font-medium">{formatNumber(efficiencyResults.national.totalEnergySaved)} TWh</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Homes Retrofitted:</span>
                                                    <span className="font-medium">{formatNumber(efficiencyResults.national.homesAdopting / 1000000)}M</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Cost per Household:</span>
                                                    <span className="font-medium">${formatNumber(efficiencyResults.perHousehold.netSystemCost, 0)}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Annual Savings:</span>
                                                    <span className="font-medium">${formatNumber(efficiencyResults.perHousehold.annualCostSavings, 0)}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>EVs Supported:</span>
                                                    <span className="font-medium">{formatNumber(efficiencyResults.national.totalEvsSupported / 1000000)}M</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Grid Capacity Freed:</span>
                                                    <span className="font-medium">{formatNumber(efficiencyResults.national.gridCapacityFreed)}%</span>
                                                </div>
                                                <div className="flex justify-between font-semibold">
                                                    <span>Carbon Reduction:</span>
                                                    <span>{formatNumber(efficiencyResults.national.totalCarbonReduction)} MT</span>
                                                </div>
                                            </div>
                                        </CardContent>
                                    </Card>
                                    
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Renewable Energy</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="space-y-2">
                                                <div className="flex justify-between">
                                                    <span>Total Generation:</span>
                                                    <span className="font-medium">{formatNumber(renewableResults.energyGeneration.total)} TWh</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Waste Processed:</span>
                                                    <span className="font-medium">{formatNumber(renewableResults.wasteUtilization.total)}M tons</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Biochar Produced:</span>
                                                    <span className="font-medium">{formatNumber(renewableResults.production.biochar)}M tons</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Battery Storage:</span>
                                                    <span className="font-medium">{formatNumber(renewableResults.energyGeneration.total * batteryStorageHours)} GWh</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Annual Revenue:</span>
                                                    <span className="font-medium">${formatNumber(renewableResults.economics.annualRevenue)}B</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Payback Period:</span>
                                                    <span className="font-medium">{formatNumber(renewableResults.economics.paybackPeriod, 1)} years</span>
                                                </div>
                                                <div className="flex justify-between font-semibold">
                                                    <span>Carbon Reduction:</span>
                                                    <span>{formatNumber(renewableResults.carbonImpact.total)} MT</span>
                                                </div>
                                            </div>
                                        </CardContent>
                                    </Card>
                                    
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Water Production</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="space-y-2">
                                                <div className="flex justify-between">
                                                    <span>Energy Allocated:</span>
                                                    <span className="font-medium">{formatNumber(waterResults.energy.allocated)} TWh</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Water Produced:</span>
                                                    <span className="font-medium">{formatNumber(waterResults.production.total)}M m³</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Population Served:</span>
                                                    <span className="font-medium">{formatNumber(waterResults.impact.populationServed)}M</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Irrigated Land:</span>
                                                    <span className="font-medium">{formatNumber(waterResults.impact.irrigatedLand)}M ha</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Food Produced:</span>
                                                    <span className="font-medium">{formatNumber(waterResults.impact.foodProduction)}M tons</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Annual Value:</span>
                                                    <span className="font-medium">${formatNumber(waterResults.economics.waterValue)}B</span>
                                                </div>
                                                <div className="flex justify-between font-semibold">
                                                    <span>Water Stress Relief:</span>
                                                    <span>{formatNumber(waterResults.impact.percentOfPublicSupply)}%</span>
                                                </div>
                                            </div>
                                        </CardContent>
                                    </Card>
                                </div>
                            </TabsContent>
                            
                            {/* Parameters Tab */}
                            <TabsContent value="parameters">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Efficiency Parameters */}
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Energy Efficiency Parameters</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Passive Solar Design Efficiency (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="20" 
                                                        max="90" 
                                                        value={passiveSolarEfficiency} 
                                                        onChange={(e) => setPassiveSolarEfficiency(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">20%</span>
                                                        <span className="text-sm font-medium">{passiveSolarEfficiency}%</span>
                                                        <span className="text-xs">90%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Geothermal Heat Pump COP</label>
                                                    <input 
                                                        type="range" 
                                                        min="2.5" 
                                                        max="5.0" 
                                                        step="0.1"
                                                        value={gshpCOP} 
                                                        onChange={(e) => setGshpCOP(parseFloat(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">2.5</span>
                                                        <span className="text-sm font-medium">{gshpCOP.toFixed(1)}</span>
                                                        <span className="text-xs">5.0</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Heat Pump Water Heater Efficiency</label>
                                                    <input 
                                                        type="range" 
                                                        min="2.0" 
                                                        max="3.5" 
                                                        step="0.1"
                                                        value={hpwhEfficiency} 
                                                        onChange={(e) => setHpwhEfficiency(parseFloat(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">2.0x</span>
                                                        <span className="text-sm font-medium">{hpwhEfficiency.toFixed(1)}x</span>
                                                        <span className="text-xs">3.5x</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">National Adoption Rate (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="5" 
                                                        max="50" 
                                                        value={efficiencyAdoptionRate} 
                                                        onChange={(e) => setEfficiencyAdoptionRate(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">5%</span>
                                                        <span className="text-sm font-medium">{efficiencyAdoptionRate}%</span>
                                                        <span className="text-xs">50%</span>
                                                    </div>
                                                </div>
                                                
                                                <div className="flex items-center">
                                                    <label className="block text-sm font-medium mr-2">Implementation Type</label>
                                                    <div className="flex items-center space-x-2">
                                                        <button 
                                                            className={`px-3 py-1 rounded ${!isNewConstruction ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                                            onClick={() => setIsNewConstruction(false)}
                                                        >
                                                            Retrofit
                                                        </button>
                                                        <button 
                                                            className={`px-3 py-1 rounded ${isNewConstruction ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                                            onClick={() => setIsNewConstruction(true)}
                                                        >
                                                            New Construction
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </CardContent>
                                    </Card>
                                    
                                    {/* Renewable Energy Parameters */}
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Renewable Energy Parameters</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Food Waste Utilization (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="90" 
                                                        value={foodWasteUtilization} 
                                                        onChange={(e) => setFoodWasteUtilization(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0%</span>
                                                        <span className="text-sm font-medium">{foodWasteUtilization}%</span>
                                                        <span className="text-xs">90%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Agricultural Waste Utilization (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="80" 
                                                        value={agricultureUtilization} 
                                                        onChange={(e) => setAgricultureUtilization(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0%</span>
                                                        <span className="text-sm font-medium">{agricultureUtilization}%</span>
                                                        <span className="text-xs">80%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">SkySails Units Deployed</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="100000" 
                                                        step="5000"
                                                        value={skySailsUnits} 
                                                        onChange={(e) => setSkySailsUnits(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0</span>
                                                        <span className="text-sm font-medium">{skySailsUnits.toLocaleString()}</span>
                                                        <span className="text-xs">100,000</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Electricity Price (¢/kWh)</label>
                                                    <input 
                                                        type="range" 
                                                        min="5" 
                                                        max="25" 
                                                        value={electricityPrice} 
                                                        onChange={(e) => setElectricityPrice(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">5¢</span>
                                                        <span className="text-sm font-medium">{electricityPrice}¢</span>
                                                        <span className="text-xs">25¢</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </CardContent>
                                    </Card>
                                    
                                    {/* Transportation Parameters */}
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Transportation Parameters</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Vehicle Fleet Retrofit (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="100" 
                                                        value={retrofitPercentage} 
                                                        onChange={(e) => setRetrofitPercentage(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0%</span>
                                                        <span className="text-sm font-medium">{retrofitPercentage}%</span>
                                                        <span className="text-xs">100%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Carbon Capture Efficiency (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="100" 
                                                        value={ccuAdoption} 
                                                        onChange={(e) => setCcuAdoption(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0%</span>
                                                        <span className="text-sm font-medium">{ccuAdoption}%</span>
                                                        <span className="text-xs">100%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Hemp Utilization (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="100" 
                                                        value={hempUtilization} 
                                                        onChange={(e) => setHempUtilization(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0%</span>
                                                        <span className="text-sm font-medium">{hempUtilization}%</span>
                                                        <span className="text-xs">100%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Algae Feedstock Adoption (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="100" 
                                                        value={algaePercentage} 
                                                        onChange={(e) => setAlgaePercentage(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0%</span>
                                                        <span className="text-sm font-medium">{algaePercentage}%</span>
                                                        <span className="text-xs">100%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </CardContent>
                                    </Card>
                                    
                                    {/* Water Parameters */}
                                    <Card>
                                        <CardHeader>
                                            <CardTitle>Water Technology Parameters</CardTitle>
                                        </CardHeader>
                                        <CardContent>
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Energy Allocation to Water (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="1" 
                                                        max="20" 
                                                        value={energyAllocationToWater} 
                                                        onChange={(e) => setEnergyAllocationToWater(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">1%</span>
                                                        <span className="text-sm font-medium">{energyAllocationToWater}%</span>
                                                        <span className="text-xs">20%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Desalination Allocation (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="100" 
                                                        value={desalinationAllocation} 
                                                        onChange={(e) => setDesalinationAllocation(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">0% (All AWG)</span>
                                                        <span className="text-sm font-medium">{desalinationAllocation}%</span>
                                                        <span className="text-xs">100% (All Desalination)</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Water Technologies Efficiency (%)</label>
                                                    <input 
                                                        type="range" 
                                                        min="50" 
                                                        max="150" 
                                                        value={waterTechsEfficiency} 
                                                        onChange={(e) => setWaterTechsEfficiency(parseInt(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">50%</span>
                                                        <span className="text-sm font-medium">{waterTechsEfficiency}%</span>
                                                        <span className="text-xs">150%</span>
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Water Value ($/m³)</label>
                                                    <input 
                                                        type="range" 
                                                        min="0.5" 
                                                        max="5" 
                                                        step="0.1"
                                                        value={waterValueUSD} 
                                                        onChange={(e) => setWaterValueUSD(parseFloat(e.target.value))}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between">
                                                        <span className="text-xs">$0.50</span>
                                                        <span className="text-sm font-medium">${waterValueUSD.toFixed(1)}</span>
                                                        <span className="text-xs">$5.00</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </CardContent>
                                    </Card>
                                </div>
                            </TabsContent>
                            
                            {/* Other tabs content  */}
                            <TabsContent value="efficiency">
                                <div className="card">
                                    <div className="card-header">
                                        <h3 className="card-title">Efficiency Details</h3>
                                    </div>
                                    <div className="card-content">
                                        <p>Energy savings per household: {formatNumber(efficiencyResults.perHousehold.totalSavings)} kWh</p>
                                        <p>Total national energy saved: {formatNumber(efficiencyResults.national.totalEnergySaved)} TWh</p>
                                        <p>Carbon reduction: {formatNumber(efficiencyResults.national.totalCarbonReduction)} million tons CO₂</p>
                                    </div>
                                </div>
                            </TabsContent>
                            
                            <TabsContent value="renewable">
                                <div className="card">
                                    <div className="card-header">
                                        <h3 className="card-title">Renewable Energy Details</h3>
                                    </div>
                                    <div className="card-content">
                                        <p>Total energy generation: {formatNumber(renewableResults.energyGeneration.total)} TWh</p>
                                        <p>Waste utilized: {formatNumber(renewableResults.wasteUtilization.total)} million tons</p>
                                        <p>Carbon impact: {formatNumber(renewableResults.carbonImpact.total)} million tons CO₂</p>
                                    </div>
                                </div>
                            </TabsContent>
                            
                            <TabsContent value="transport">
                                <div className="card">
                                    <div className="card-header">
                                        <h3 className="card-title">Transportation Details</h3>
                                    </div>
                                    <div className="card-content">
                                        <p>Carbon reduction: {formatNumber(transportationResults.carbonReduction.total)} million tons CO₂</p>
                                        <p>Oil import reduction: {formatNumber(transportationResults.oilImpact.reduction)} million barrels/day</p>
                                        <p>Jobs created: {formatNumber(transportationResults.jobs)}</p>
                                    </div>
                                </div>
                            </TabsContent>
                            
                            <TabsContent value="water">
                                <div className="card">
                                    <div className="card-header">
                                        <h3 className="card-title">Water System Details</h3>
                                    </div>
                                    <div className="card-content">
                                        <p>Water produced: {formatNumber(waterResults.production.total)} million m³</p>
                                        <p>Population served: {formatNumber(waterResults.impact.populationServed)} million people</p>
                                        <p>Agricultural land irrigated: {formatNumber(waterResults.impact.irrigatedLand)} million hectares</p>
                                    </div>
                                </div>
                            </TabsContent>
                            
                            <TabsContent value="phased">
                                <div className="card">
                                    <div className="card-header">
                                        <h3 className="card-title">Phased Implementation</h3>
                                    </div>
                                    <div className="card-content">
                                        <table className="w-full">
                                            <thead>
                                                <tr>
                                                    <th>Phase</th>
                                                    <th>Year</th>
                                                    <th>Carbon Reduction (MT)</th>
                                                    <th>Investment ($B)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {phasedPlan.map(phase => (
                                                    <tr key={phase.phase}>
                                                        <td>{phase.phase}</td>
                                                        <td>{phase.year}</td>
                                                        <td>{formatNumber(phase.totals.carbonReduction)}</td>
                                                        <td>{formatNumber(phase.totals.investment)}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </TabsContent>
                        </Tabs>
                    </div>
                );
            };
            
            // Render the calculator
            ReactDOM.render(<IntegratedEnergyWaterCalculator />, document.getElementById('app'));
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Circular Waste-to-Energy Calculator</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            line-height: 1.6;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 0.5em;
        }

        h2 {
            font-size: 1.5em;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        input {
            padding: 5px;
            margin-right: 10px;
            font-size: 1em;
        }

        button {
            padding: 5px 10px;
            font-size: 1em;
        }

        .homes-powered {
            font-size: 1.2em;
            margin: 1em 0;
        }
    </style>
</head>
<body>
    <h1>Advanced Circular Waste-to-Energy Calculator</h1>
    <p>Calculate energy potential with enhanced feedback loops and two-stage AD</p>

    <div>
        <label>City Population: </label>
        <input type="number" id="population" placeholder="Enter population" value="10000">
        <button onclick="calculateMaximizedSystem()">Calculate Energy Potential</button>
    </div>

    <div id="result"></div>

    <script>
        function calculateMaximizedSystem() {
            let population = parseInt(document.getElementById("population").value);

            if (isNaN(population) || population <= 0) {
                document.getElementById("result").innerHTML = "<p style='color: red;'>Please enter a valid population number.</p>";
                return;
            }

            // Base waste calculations
            const humanWastePerDay = 0.0002; // tonnes/person/day
            const mswPerDay = 0.002; // tonnes/person/day
            const annualHumanWaste = population * humanWastePerDay * 365;
            const annualMSW = population * mswPerDay * 365;

            // Waste distribution
            const organicFraction = 0.50;
            const toAD = (annualMSW * organicFraction) + annualHumanWaste;
            const toWTE = annualMSW * 0.30;
            const toGasification = annualMSW * 0.20;

            // Algae system
            const algaeYield = 0.045; // tonnes/m¬≤/year
            const areaPerPerson = 2.5; // m¬≤
            const algaeArea = population * areaPerPerson;
            const annualAlgaeBiomass = algaeYield * algaeArea;
            const lipidContent = 0.45;
            const extractedLipids = annualAlgaeBiomass * lipidContent;
            const spentBiomass = annualAlgaeBiomass * (1 - lipidContent);

            // Biomass distribution
            const spentToAD = spentBiomass * 0.6;
            const spentToGasification = spentBiomass * 0.4;

            // Enhanced Two-Stage AD
            const adEfficiency = 0.48;
            const coDigestionBoost = 1.25;
            const biogasYield = 0.65; // m¬≥/kg VS
            const methaneContent = 0.78;
            const energyPerM3 = 6.5 * (methaneContent/0.60);

            // Calculate AD energy
            const adEnergy = (toAD + spentToAD) * 1000 * adEfficiency * 
                           coDigestionBoost * biogasYield * energyPerM3 / 1000;

            // WTE calculations
            const wteEfficiency = 0.32;
            const calorificValue = 2.8; // MWh/tonne
            const heatRecovery = 0.15;
            const wteEnergy = toWTE * calorificValue * wteEfficiency;
            const wteHeat = toWTE * calorificValue * heatRecovery;

            // Gasification
            const gasificationEff = 0.42;
            const gasificationEnergy = (toGasification + spentToGasification) * 
                                    gasificationEff * 6.2;

            // Algae biofuel
            const conversionEff = 0.40;
            const biofuelEnergy = extractedLipids * conversionEff * 11.6;

            // Integration benefits
            const heatRecoveryTotal = wteHeat + (gasificationEnergy * 0.15);
            const nutrientRecycling = (adEnergy + gasificationEnergy) * 0.08;
            const carbonCapture = (toGasification + spentToGasification) * 0.15 * 0.75 * 3.67 * 0.1;

            // Total system energy
            const totalEnergy = adEnergy + wteEnergy + gasificationEnergy + 
                              biofuelEnergy + heatRecoveryTotal + nutrientRecycling + 
                              carbonCapture;

            // Environmental benefits
            const co2Saved = (toAD * 3.5) + (toGasification * 2.8);
            const biocharProduced = (toGasification + spentToGasification) * 0.15;
            const treesEquivalent = Math.floor(co2Saved * 46);
            const carsRemoved = Math.floor(co2Saved / 4.6);

            // Calculate homes powered
            const avgHomeUsage = 10500; // kWh/year (US average)
            const homesPowered = Math.floor((totalEnergy * 1000) / avgHomeUsage);

            // Display results matching current style
            document.getElementById("result").innerHTML = `
                <h2>Total Impact</h2>
                <p>üè† ${homesPowered.toLocaleString()} Homes Powered</p>
                <p>Based on average US household consumption of 10,500 kWh/year</p>

                <h2>‚ö° Energy Generation</h2>
                <p>Enhanced AD: ${(adEnergy/1000).toFixed(2)} GWh/year</p>
                <p>WTE: ${(wteEnergy/1000).toFixed(2)} GWh/year</p>
                <p>Gasification: ${(gasificationEnergy/1000).toFixed(2)} GWh/year</p>
                <p>Algae Biofuel: ${(biofuelEnergy/1000).toFixed(2)} GWh/year</p>

                <h2>üîÑ Integration Benefits</h2>
                <p>Heat Recovery: ${(heatRecoveryTotal/1000).toFixed(2)} GWh/year</p>
                <p>Nutrient Recycling: ${(nutrientRecycling/1000).toFixed(2)} GWh/year</p>
                <p>Carbon Capture: ${(carbonCapture/1000).toFixed(2)} GWh/year</p>

                <h2>üìä System Totals</h2>
                <p>Total Energy: ${(totalEnergy/1000).toFixed(2)} GWh/year</p>
                <p>Biochar Production: ${biocharProduced.toFixed(2)} tonnes/year</p>
                <p>Algae Lipids: ${extractedLipids.toFixed(2)} tonnes/year</p>

                <h2>üåç Environmental Impact</h2>
                <p>Trees Equivalent: ${treesEquivalent.toLocaleString()}</p>
                <p>Cars Removed: ${carsRemoved.toLocaleString()}</p>
                <p>CO‚ÇÇ Saved: ${co2Saved.toFixed(2)} tonnes/year</p>`;
        }

        // Add event listener for Enter key
        document.getElementById("population").addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                calculateMaximizedSystem();
            }
        });
    </script>
</body>
</html>

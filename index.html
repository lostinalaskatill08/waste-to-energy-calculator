<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>US Integrated Energy & Water Transition Calculator</title>
  <style>
    :root {
      /* Light Mode Colors */
      --bg-color: #f0f4f8;
      --text-color: #2d3748;
      --card-bg: #ffffff;
      --primary-color: #3b82f6;
      --secondary-color: #10b981;
      --accent-color: #f59e0b;
      --border-color: rgba(0,0,0,0.1);
      /* Dark Mode Colors */
      --dark-bg-color: #1e293b;
      --dark-text-color: #e2e8f0;
      --dark-card-bg: #334155;
      --dark-primary: #60a5fa;
      --dark-border-color: #475569;
    }
    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, var(--bg-color) 0%, #dbeafe 100%);
      color: var(--text-color);
      transition: all 0.3s ease;
    }
    body.dark-mode {
      background: linear-gradient(135deg, var(--dark-bg-color) 0%, #475569 100%);
      color: var(--dark-text-color);
    }
    h1 {
      font-size: 2rem;
      color: var(--primary-color);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    body.dark-mode h1 { color: var(--dark-primary); }
    .container { max-width: 1400px; margin: 0 auto; }
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 6px var(--border-color);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px var(--border-color); }
    body.dark-mode .card { background: var(--dark-card-bg); box-shadow: 0 4px 6px var(--dark-border-color); }
    .card-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    body.dark-mode .card-title { color: var(--dark-primary); }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .stat-box {
      padding: 15px;
      border-radius: 8px;
      background: #fff;
      transition: transform 0.2s ease;
    }
    .stat-box:hover { transform: scale(1.05); }
    body.dark-mode .stat-box { background: #4b5563; }
    .stat-box.blue { background: linear-gradient(135deg, #dbeafe, #bfdbfe); }
    .stat-box.green { background: linear-gradient(135deg, #d1fae5, #a7f3d0); }
    .stat-box.yellow { background: linear-gradient(135deg, #fef3c7, #fde68a); }
    .stat-box.purple { background: linear-gradient(135deg, #e9d5ff, #d8b4fe); }
    .stat-label { font-size: 0.9rem; color: #6b7280; }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--text-color); }
    .stat-subtitle { font-size: 0.8rem; color: #9ca3af; }
    .grid { display: grid; gap: 20px; }
    .tabs { margin-bottom: 20px; }
    .tab-list {
      display: flex;
      flex-wrap: wrap;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 5px;
    }
    .tab-button {
      padding: 10px 20px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1rem;
      color: #6b7280;
      transition: all 0.3s ease;
    }
    .tab-button:hover { color: var(--primary-color); }
    .tab-button.active {
      color: var(--primary-color);
      font-weight: 600;
      border-bottom: 3px solid var(--primary-color);
    }
    body.dark-mode .tab-button.active { color: var(--dark-primary); border-color: var(--dark-primary); }
    .tab-content { display: none; animation: fadeIn 0.5s ease; }
    .tab-content.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .slider-container { margin-bottom: 20px; }
    .slider-label { font-size: 1rem; font-weight: 500; color: var(--text-color); }
    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      background: #e5e7eb;
      border-radius: 5px;
      height: 8px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--primary-color);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    .slider-values { display: flex; justify-content: space-between; font-size: 0.8rem; color: #6b7280; }
    .slider-current { font-weight: 600; color: var(--primary-color); }
    .toggle-container { display: flex; align-items: center; margin-bottom: 15px; }
    .toggle-button {
      padding: 8px 16px;
      border-radius: 20px;
      background: #e5e7eb;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .toggle-button.active { background: var(--primary-color); color: #fff; }
    .bar-chart { margin-top: 20px; }
    .bar {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      position: relative;
      height: 30px;
      background: #e5e7eb;
      border-radius: 5px;
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      transition: width 0.5s ease;
      position: absolute;
      left: 0;
      z-index: 0;
    }
    .bar-label { width: 150px; padding-left: 10px; font-size: 0.9rem; z-index: 1; }
    .bar-value { margin-left: auto; padding-right: 10px; font-size: 0.9rem; z-index: 1; }
    .pie-chart { position: relative; width: 200px; height: 200px; margin: 20px auto; }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      background: var(--primary-color);
      color: #fff;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    button:hover { background: #2563eb; transform: scale(1.05); }
    button.secondary { background: #6b7280; }
    button.secondary:hover { background: #4b5563; }
    .action-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background: #1f2937;
      color: #fff;
      text-align: center;
      border-radius: 5px;
      padding: 5px;
      position: absolute;
      z-index: 10;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
  </style>
</head>
<body>
<div class="container">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h1>US Integrated Energy & Water Transition Calculator</h1>
    <button class="secondary" id="dark-mode-toggle">Toggle Dark Mode</button>
  </div>
  <p style="color: #4b5563;">Visualize the impact of energy and water solutions across the US.</p>

  <div class="tabs">
    <div class="tab-list">
      <button class="tab-button active" data-tab="summary">Summary</button>
      <button class="tab-button" data-tab="parameters">Parameters</button>
      <button class="tab-button" data-tab="efficiency">Efficiency</button>
      <button class="tab-button" data-tab="renewable">Renewables</button>
      <button class="tab-button" data-tab="transport">Transportation</button>
      <button class="tab-button" data-tab="water">Water</button>
      <button class="tab-button" data-tab="phased">Timeline</button>
    </div>

    <!-- Summary Tab -->
    <div class="tab-content active" id="summary">
      <div class="grid" style="grid-template-columns: 1fr 1fr;">
        <div class="card">
          <h3 class="card-title">Strategy Approach</h3>
          <div class="toggle-container">
            <span>Generation First</span>
            <input type="range" min="0" max="1" step="1" value="1" id="efficiency-first-toggle" style="width: 60px; margin: 0 10px;">
            <span>Efficiency First</span>
          </div>
          <div class="slider-container">
            <label class="slider-label">Implementation Speed</label>
            <input type="range" min="1" max="20" value="10" id="implementation-speed">
            <div class="slider-values">
              <span>Slower</span>
              <span class="slider-current" id="implementation-speed-value">10</span>
              <span>Faster</span>
            </div>
          </div>
          <div id="strategy-comparison"></div>
        </div>
        <div class="card">
          <h3 class="card-title">Key Results</h3>
          <div class="stats-grid">
            <div class="stat-box blue tooltip">
              <div class="stat-label">Net Energy Impact</div>
              <div class="stat-value" id="net-energy-impact">-707 TWh</div>
              <div class="stat-subtitle" id="net-energy-percent">-18.6% of US</div>
              <span class="tooltiptext">Total energy generated minus saved</span>
            </div>
            <div class="stat-box green tooltip">
              <div class="stat-label">Carbon Reduction</div>
              <div class="stat-value" id="carbon-reduction">920 MT</div>
              <div class="stat-subtitle" id="carbon-percent">17.6% of US</div>
              <span class="tooltiptext">CO2 emissions avoided</span>
            </div>
            <div class="stat-box yellow tooltip">
              <div class="stat-label">Total Investment</div>
              <div class="stat-value" id="total-investment">$1.89T</div>
              <div class="stat-subtitle" id="payback-period">Payback: 10.3 yrs</div>
              <span class="tooltiptext">Cost of implementation</span>
            </div>
            <div class="stat-box purple tooltip">
              <div class="stat-label">Jobs Created</div>
              <div class="stat-value" id="jobs-created">3.3M</div>
              <div class="stat-subtitle" id="jobs-per-million">1.8 per $1M</div>
              <span class="tooltiptext">Employment opportunities</span>
            </div>
          </div>
          <h4>Carbon Reduction Breakdown</h4>
          <div id="carbon-breakdown" class="bar-chart"></div>
          <div id="carbon-pie" class="pie-chart"></div>
        </div>
      </div>
      <div class="grid" style="grid-template-columns: repeat(3, 1fr);">
        <div class="card">
          <h3 class="card-title">Efficiency Impact</h3>
          <div id="efficiency-metrics"></div>
        </div>
        <div class="card">
          <h3 class="card-title">Renewable Energy</h3>
          <div id="renewable-metrics"></div>
        </div>
        <div class="card">
          <h3 class="card-title">Water Production</h3>
          <div id="water-metrics"></div>
        </div>
      </div>
      <div class="action-buttons">
        <button id="download-button" class="secondary">Download Data</button>
        <button id="report-button">View Detailed Report</button>
      </div>
    </div>

    <!-- Parameters Tab -->
    <div class="tab-content" id="parameters">
      <div class="grid" style="grid-template-columns: repeat(2, 1fr);">
        <div class="card">
          <h3 class="card-title">Efficiency Parameters</h3>
          <div class="slider-container">
            <label class="slider-label">Passive Solar Efficiency (%)</label>
            <input type="range" min="20" max="90" value="50" id="passive-solar-efficiency">
            <div class="slider-values">
              <span>20%</span>
              <span class="slider-current" id="passive-solar-efficiency-value">50%</span>
              <span>90%</span>
            </div>
          </div>
          <!-- Add more sliders similarly -->
        </div>
        <!-- Add other parameter sections -->
      </div>
      <div class="action-buttons">
        <button id="apply-parameters-button">Apply Changes</button>
        <button id="reset-default-button" class="secondary">Reset to Default</button>
      </div>
    </div>

    <!-- Efficiency Tab -->
    <div class="tab-content" id="efficiency">
      <div class="card">
        <h3 class="card-title">Household Energy Savings</h3>
        <div class="grid" style="grid-template-columns: 1fr 1fr;">
          <div id="efficiency-savings-table"></div>
          <div class="bar-chart" id="efficiency-savings-chart"></div>
        </div>
      </div>
      <div class="card">
        <h3 class="card-title">National Impact at <span id="adoption-rate-display">25</span>% Adoption</h3>
        <div id="national-impact-metrics"></div>
        <div class="bar-chart" id="national-impact-chart"></div>
      </div>
    </div>

    <!-- Renewables Tab -->
    <div class="tab-content" id="renewable">
      <div class="card">
        <h3 class="card-title">Renewable Energy Generation</h3>
        <div id="renewable-metrics-full"></div>
        <div class="bar-chart" id="renewable-energy-chart"></div>
      </div>
    </div>

    <!-- Transportation Tab -->
    <div class="tab-content" id="transport">
      <div class="card">
        <h3 class="card-title">Transportation Impact</h3>
        <div id="transport-metrics"></div>
        <div class="bar-chart" id="transport-carbon-chart"></div>
      </div>
    </div>

    <!-- Water Tab -->
    <div class="tab-content" id="water">
      <div class="card">
        <h3 class="card-title">Water Production Impact</h3>
        <div id="water-metrics-full"></div>
        <div class="bar-chart" id="water-production-chart"></div>
      </div>
    </div>

    <!-- Phased Implementation Tab -->
    <div class="tab-content" id="phased">
      <div class="card">
        <h3 class="card-title">Implementation Timeline</h3>
        <div id="phased-plan-chart"></div>
      </div>
    </div>
  </div>
</div>

<script>
  // Core functionality remains the same as in the thinking trace, with enhancements below

  // Enhanced Bar Chart with Tooltips
  function updateBarChart(containerId, data, unit) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    const maxValue = Math.max(...data.map(d => d.value));
    data.forEach((item, i) => {
      const bar = document.createElement('div');
      bar.className = 'bar tooltip';
      const barFill = document.createElement('div');
      barFill.className = 'bar-fill';
      barFill.style.width = `${(item.value / maxValue) * 100}%`;
      barFill.style.background = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'][i % 5];
      const barLabel = document.createElement('div');
      barLabel.className = 'bar-label';
      barLabel.textContent = item.name;
      const barValue = document.createElement('div');
      barValue.className = 'bar-value';
      barValue.textContent = `${item.value.toLocaleString()} ${unit}`;
      const tooltip = document.createElement('span');
      tooltip.className = 'tooltiptext';
      tooltip.textContent = `${item.name}: ${item.value.toLocaleString()} ${unit}`;
      bar.appendChild(barFill);
      bar.appendChild(barLabel);
      bar.appendChild(barValue);
      bar.appendChild(tooltip);
      container.appendChild(bar);
    });
  }

  // Pie Chart for Carbon Breakdown
  function updatePieChart(data) {
    const container = document.getElementById('carbon-pie');
    // Implement pie chart logic using canvas or SVG if desired
  }

  // New Buttons Functionality
  document.getElementById('report-button').addEventListener('click', () => {
    alert('Detailed report generation coming soon!');
  });

  // Initial Load with Visuals
  window.onload = () => {
    updateCalculations();
    // Add initial chart updates here
  };
</script>
</body>
</html>

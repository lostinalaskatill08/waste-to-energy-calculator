<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>US Integrated Energy & Water Transition Calculator</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.5;
      margin: 0;
      padding: 20px;
      color: #333;
      background-color: #f5f5f5;
    }
    
    h1, h2, h3, h4 {
      margin-top: 0;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    
    @media (min-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .grid-cols-2 {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .stat-box {
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
    }
    
    .stat-box.blue { background-color: #eff6ff; }
    .stat-box.green { background-color: #ecfdf5; }
    .stat-box.yellow { background-color: #fffbeb; }
    .stat-box.purple { background-color: #f5f3ff; }
    .stat-box.orange { background-color: #fff7ed; }
    .stat-box.teal { background-color: #f0fdfa; }
    
    .stat-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .stat-subtitle {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 5px;
    }
    
    .grid {
      display: grid;
      gap: 20px;
    }
    
    .tabs {
      margin-bottom: 20px;
    }
    
    .tab-list {
      display: flex;
      border-bottom: 1px solid #e5e7eb;
      overflow-x: auto;
    }
    
    .tab-button {
      padding: 10px 15px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 0.875rem;
      color: #6b7280;
      border-bottom: 2px solid transparent;
    }
    
    .tab-button.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
      font-weight: 500;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .slider-container {
      margin-bottom: 15px;
    }
    
    .slider-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 5px;
    }
    
    .slider-values {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      margin-top: 5px;
    }
    
    .slider-current {
      font-weight: 500;
      font-size: 0.875rem;
    }
    
    input[type="range"] {
      width: 100%;
    }
    
    .flex {
      display: flex;
      align-items: center;
    }
    
    .toggle-container {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .toggle-label {
      font-size: 0.875rem;
      font-weight: 500;
      margin-right: 10px;
    }
    
    .toggle-button {
      border: 1px solid #d1d5db;
      background-color: #f9fafb;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 0.875rem;
      border-radius: 4px;
    }
    
    .toggle-button.active {
      background-color: #2563eb;
      color: white;
      border-color: #2563eb;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    th, td {
      text-align: left;
      padding: 8px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    th {
      font-weight: 500;
      color: #4b5563;
    }
    
    .text-right {
      text-align: right;
    }
    
    .bar-chart {
      margin-top: 15px;
    }
    
    .bar {
      height: 25px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .bar-label {
      width: 120px;
      font-size: 0.75rem;
      padding-left: 8px;
      z-index: 1;
    }
    
    .bar-value {
      font-size: 0.75rem;
      margin-left: auto;
      padding-right: 8px;
      z-index: 1;
    }
    
    .bar-fill {
      position: absolute;
      height: 25px;
      background-color: #3b82f6;
      transition: width 0.3s ease;
      border-radius: 4px;
    }
    
    .center-text {
      text-align: center;
    }
    
    .metric-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      border-bottom: 1px solid #f3f4f6;
      padding-bottom: 8px;
    }
    
    .metric-label {
      font-size: 0.875rem;
    }
    
    .metric-value {
      font-size: 0.875rem;
      font-weight: 500;
    }
    
    .action-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 10px;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
    }
    
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background-color: #2563eb;
      color: white;
      cursor: pointer;
      font-size: 0.875rem;
    }
    
    button:hover {
      background-color: #1d4ed8;
    }
    
    button.secondary {
      background-color: #e5e7eb;
      color: #374151;
    }
    
    button.secondary:hover {
      background-color: #d1d5db;
    }
    
    button.tertiary {
      background-color: #10b981;
      color: white;
    }
    
    button.tertiary:hover {
      background-color: #059669;
    }
    
    .tech-link {
      color: #2563eb;
      text-decoration: none;
      border-bottom: 1px dotted #2563eb;
    }
    
    .tech-link:hover {
      text-decoration: underline;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .close {
      float: right;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover {
      color: #2563eb;
    }
    
    .chart-container {
      height: 300px;
      width: 100%;
      margin-top: 15px;
    }
    
    .pie-charts-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .section-link {
      display: inline-block;
      margin-top: 10px;
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
    }
    
    .section-link:hover {
      text-decoration: underline;
    }
    
    #file-upload-container {
      margin-bottom: 10px;
    }
    
    #file-upload {
      display: none;
    }
    
    .file-upload-label {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 4px;
      background-color: #f9fafb;
      border: 1px solid #d1d5db;
      cursor: pointer;
      font-size: 0.875rem;
    }
    
    .file-upload-label:hover {
      background-color: #e5e7eb;
    }
    
    .alerts {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 15px;
      display: none;
    }
    
    .alert-success {
      background-color: #d1fae5;
      border-left: 4px solid #10b981;
      color: #065f46;
    }
    
    .alert-error {
      background-color: #fee2e2;
      border-left: 4px solid #ef4444;
      color: #b91c1c;
    }

    @media print {
      .tab-list, .action-buttons {
        display: none !important;
      }
      
      .tab-content {
        display: block !important;
      }
      
      body {
        font-size: 10pt;
        background-color: white;
      }
      
      .container {
        max-width: 100%;
      }
      
      .card {
        box-shadow: none;
        border: 1px solid #ddd;
        break-inside: avoid;
      }
    }
    
    /* Tech modal specific styles */
    .tech-modal-content h3 {
      color: #2563eb;
      margin-top: 0;
    }
    
    .tech-modal-content ul {
      padding-left: 20px;
    }
    
    .tech-modal-content p {
      margin-bottom: 10px;
    }
    
    .tech-info-footer {
      margin-top: 15px;
      font-size: 0.8rem;
      color: #6b7280;
      border-top: 1px solid #e5e7eb;
      padding-top: 10px;
    }
    
    .footnote {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 10px;
    }
    
    /* Custom styles for renewable tab */
    .renewable-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    @media (min-width: 768px) {
      .renewable-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .source-breakdown {
      margin-top: 15px;
    }
    
    /* Donut chart styling */
    .donut-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto;
    }
    
    .donut-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    
    .donut-label {
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .donut-value {
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    /* Transportation tab styles */
    .transport-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    @media (min-width: 768px) {
      .transport-row {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>US Integrated Energy & Water Transition Calculator</h1>
    <p>Explore the combined impact of energy efficiency, renewable generation, transportation improvements, and water production systems on the US energy landscape and climate goals.</p>
    
    <!-- Alert messages -->
    <div id="alert-success" class="alerts alert-success"></div>
    <div id="alert-error" class="alerts alert-error"></div>
    
    <div class="tabs">
      <div class="tab-list">
        <button class="tab-button active" data-tab="summary">Summary</button>
        <button class="tab-button" data-tab="parameters">Input Parameters</button>
        <button class="tab-button" data-tab="efficiency">Energy Efficiency</button>
        <button class="tab-button" data-tab="renewable">Renewable Energy</button>
        <button class="tab-button" data-tab="transport">Transportation</button>
        <button class="tab-button" data-tab="water">Water Systems</button>
        <button class="tab-button" data-tab="phased">Phased Implementation</button>
      </div>
      
      <!-- Summary Tab -->
      <div class="tab-content active" id="summary">
        <div class="grid grid-cols-2">
          <div class="card">
            <h3 class="card-title">Strategy Approach</h3>
            <div class="toggle-container">
              <span class="toggle-label">Generation First</span>
              <input type="range" min="0" max="1" step="1" value="1" id="efficiency-first-toggle" style="max-width: 60px; margin: 0 10px;">
              <span class="toggle-label">Efficiency First</span>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">Implementation Speed</label>
              <input type="range" min="1" max="20" value="10" id="implementation-speed">
              <div class="slider-values">
                <span>Slower</span>
                <span class="slider-current" id="implementation-speed-value">10</span>
                <span>Faster</span>
              </div>
            </div>
            
            <div id="strategy-comparison">
              <table>
                <thead>
                  <tr>
                    <th>Strategy</th>
                    <th>Investment</th>
                    <th>Carbon Reduction</th>
                    <th>Payback</th>
                    <th>Jobs</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Efficiency First</td>
                    <td id="eff-first-investment">$1.89T</td>
                    <td id="eff-first-carbon">920M tons</td>
                    <td id="eff-first-payback">10.3 years</td>
                    <td id="eff-first-jobs">3.3M</td>
                  </tr>
                  <tr>
                    <td>Generation First</td>
                    <td id="gen-first-investment">$2.65T</td>
                    <td id="gen-first-carbon">644M tons</td>
                    <td id="gen-first-payback">18.5 years</td>
                    <td id="gen-first-jobs">1.5M</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="card">
            <h3 class="card-title">Key Results</h3>
            <div class="stats-grid">
              <div class="stat-box blue">
                <div class="stat-label">Net Energy Impact</div>
                <div class="stat-value" id="net-energy-impact">-707 TWh</div>
                <div class="stat-subtitle" id="net-energy-percent">-18.6% of US consumption</div>
              </div>
              
              <div class="stat-box green">
                <div class="stat-label">Carbon Reduction</div>
                <div class="stat-value" id="carbon-reduction">920 MT</div>
                <div class="stat-subtitle" id="carbon-percent">17.6% of US emissions</div>
              </div>
              
              <div class="stat-box yellow">
                <div class="stat-label">Total Investment</div>
                <div class="stat-value" id="total-investment">$1.89T</div>
                <div class="stat-subtitle" id="payback-period">Payback: 10.3 years</div>
              </div>
              
              <div class="stat-box purple">
                <div class="stat-label">Jobs Created</div>
                <div class="stat-value" id="jobs-created">3.3M</div>
                <div class="stat-subtitle" id="jobs-per-million">1.8 jobs per $1M</div>
              </div>
            </div>
            
            <h4 style="margin-top: 20px;">Carbon Reduction by Component</h4>
            <div id="carbon-breakdown" class="bar-chart">
              <!-- Bars will be dynamically inserted here -->
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-2">
          <!-- Efficiency Impact (Summary) -->
          <div class="card">
            <h3 class="card-title">Efficiency Impact</h3>
            <div id="efficiency-metrics">
              <!-- Metrics will be dynamically inserted here -->
            </div>
            <a href="#" class="section-link" onclick="switchToTab('efficiency'); return false;">View detailed efficiency analysis &rarr;</a>
          </div>
          
          <div class="card">
            <h3 class="card-title">Renewable Energy</h3>
            <div id="renewable-metrics">
              <!-- Metrics will be dynamically inserted here -->
            </div>
            <a href="#" class="section-link" onclick="switchToTab('renewable'); return false;">View detailed renewable analysis &rarr;</a>
          </div>
          
          <div class="card">
            <h3 class="card-title">Water Production</h3>
            <div id="water-metrics">
              <!-- Metrics will be dynamically inserted here -->
            </div>
            <a href="#" class="section-link" onclick="switchToTab('water'); return false;">View detailed water systems analysis &rarr;</a>
          </div>
          
          <div class="card">
            <h3 class="card-title">Transportation Impact</h3>
            <div id="transportation-metrics">
              <!-- Metrics will be dynamically inserted here -->
            </div>
            <a href="#" class="section-link" onclick="switchToTab('transport'); return false;">View detailed transportation analysis &rarr;</a>
          </div>
        </div>
      </div>
      
      <!-- Parameters Tab -->
      <div class="tab-content" id="parameters">
        <div class="grid grid-cols-2">
          <!-- Efficiency Parameters -->
          <div class="card">
            <h3 class="card-title">Energy Efficiency Parameters</h3>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('passive-solar'); return false;">Passive Solar Design</a> Efficiency (%)
              </label>
              <input type="range" min="20" max="90" value="50" id="passive-solar-efficiency">
              <div class="slider-values">
                <span>20%</span>
                <span class="slider-current" id="passive-solar-efficiency-value">50%</span>
                <span>90%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('gshp'); return false;">Geothermal Heat Pump</a> COP
              </label>
              <input type="range" min="2.5" max="5.0" step="0.1" value="3.5" id="gshp-cop">
              <div class="slider-values">
                <span>2.5</span>
                <span class="slider-current" id="gshp-cop-value">3.5</span>
                <span>5.0</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('hpwh'); return false;">Heat Pump Water Heater</a> Efficiency
              </label>
              <input type="range" min="2.0" max="3.5" step="0.1" value="2.5" id="hpwh-efficiency">
              <div class="slider-values">
                <span>2.0x</span>
                <span class="slider-current" id="hpwh-efficiency-value">2.5x</span>
                <span>3.5x</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">National Adoption Rate (%)</label>
              <input type="range" min="5" max="50" value="25" id="efficiency-adoption-rate">
              <div class="slider-values">
                <span>5%</span>
                <span class="slider-current" id="efficiency-adoption-rate-value">25%</span>
                <span>50%</span>
              </div>
            </div>
            
            <div class="toggle-container">
              <span class="toggle-label">Implementation Type:</span>
              <button class="toggle-button active" id="retrofit-button">Retrofit</button>
              <button class="toggle-button" id="new-construction-button">New Construction</button>
            </div>
          </div>
          
          <!-- Renewable Energy Parameters -->
          <div class="card">
            <h3 class="card-title">Renewable Energy Parameters</h3>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('food-waste'); return false;">Food Waste</a> Utilization (%)
              </label>
              <input type="range" min="0" max="90" value="60" id="food-waste-utilization">
              <div class="slider-values">
                <span>0%</span>
                <span class="slider-current" id="food-waste-utilization-value">60%</span>
                <span>90%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('ag-waste'); return false;">Agricultural Waste</a> Utilization (%)
              </label>
              <input type="range" min="0" max="80" value="40" id="agriculture-utilization">
              <div class="slider-values">
                <span>0%</span>
                <span class="slider-current" id="agriculture-utilization-value">40%</span>
                <span>80%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('skysails'); return false;">SkySails</a> Units Deployed
              </label>
              <input type="range" min="0" max="100000" step="5000" value="50000" id="skysails-units">
              <div class="slider-values">
                <span>0</span>
                <span class="slider-current" id="skysails-units-value">50,000</span>
                <span>100,000</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">Electricity Price (¢/kWh)</label>
              <input type="range" min="5" max="25" value="10" id="electricity-price">
              <div class="slider-values">
                <span>5¢</span>
                <span class="slider-current" id="electricity-price-value">10¢</span>
                <span>25¢</span>
              </div>
            </div>
          </div>
          
          <!-- Transportation Parameters -->
          <div class="card">
            <h3 class="card-title">Transportation Parameters</h3>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('fleet-retrofit'); return false;">Vehicle Fleet Retrofit</a> (%)
              </label>
              <input type="range" min="0" max="100" value="50" id="retrofit-percentage">
              <div class="slider-values">
                <span>0%</span>
                <span class="slider-current" id="retrofit-percentage-value">50%</span>
                <span>100%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('carbon-capture'); return false;">Carbon Capture</a> Efficiency (%)
              </label>
              <input type="range" min="0" max="100" value="90" id="ccu-adoption">
              <div class="slider-values">
                <span>0%</span>
                <span class="slider-current" id="ccu-adoption-value">90%</span>
                <span>100%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('hemp'); return false;">Hemp</a> Utilization (%)
              </label>
              <input type="range" min="0" max="100" value="50" id="hemp-utilization">
              <div class="slider-values">
                <span>0%</span>
                <span class="slider-current" id="hemp-utilization-value">50%</span>
                <span>100%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('algae'); return false;">Algae Feedstock</a> Adoption (%)
              </label>
              <input type="range" min="0" max="100" value="25" id="algae-percentage">
              <div class="slider-values">
                <span>0%</span>
                <span class="slider-current" id="algae-percentage-value">25%</span>
                <span>100%</span>
              </div>
            </div>
          </div>
          
          <!-- Water Parameters -->
          <div class="card">
            <h3 class="card-title">Water Technology Parameters</h3>
            
            <div class="slider-container">
              <label class="slider-label">Energy Allocation to Water (%)</label>
              <input type="range" min="1" max="20" value="5" id="energy-allocation-to-water">
              <div class="slider-values">
                <span>1%</span>
                <span class="slider-current" id="energy-allocation-to-water-value">5%</span>
                <span>20%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('desalination'); return false;">Desalination</a> Allocation (%)
              </label>
              <input type="range" min="0" max="100" value="60" id="desalination-allocation">
              <div class="slider-values">
                <span>0% (All AWG)</span>
                <span class="slider-current" id="desalination-allocation-value">60%</span>
                <span>100% (All Desalination)</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('water-tech'); return false;">Water Technologies</a> Efficiency (%)
              </label>
              <input type="range" min="50" max="150" value="100" id="water-techs-efficiency">
              <div class="slider-values">
                <span>50%</span>
                <span class="slider-current" id="water-techs-efficiency-value">100%</span>
                <span>150%</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">Water Value ($/m³)</label>
              <input type="range" min="0.5" max="5" step="0.1" value="1.5" id="water-value-usd">
              <div class="slider-values">
                <span>$0.50</span>
                <span class="slider-current" id="water-value-usd-value">$1.50</span>
                <span>$5.00</span>
              </div>
            </div>
          </div>

          <!-- Solar & Nuclear Parameters -->
          <div class="card">
            <h3 class="card-title">Solar & Nuclear Energy Parameters</h3>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('solar'); return false;">Solar Capacity</a> (GW)
              </label>
              <input type="range" min="0" max="1000" step="10" value="200" id="solar-capacity">
              <div class="slider-values">
                <span>0 GW</span>
                <span class="slider-current" id="solar-capacity-value">200 GW</span>
                <span>1000 GW</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">Solar Average Cost ($/kW)</label>
              <input type="range" min="300" max="2000" step="50" value="1000" id="solar-cost">
              <div class="slider-values">
                <span>$300/kW</span>
                <span class="slider-current" id="solar-cost-value">$1000/kW</span>
                <span>$2000/kW</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">
                <a href="#" class="tech-link" onclick="showTechInfo('nuclear'); return false;">Nuclear Capacity</a> (GW)
              </label>
              <input type="range" min="0" max="300" step="5" value="50" id="nuclear-capacity">
              <div class="slider-values">
                <span>0 GW</span>
                <span class="slider-current" id="nuclear-capacity-value">50 GW</span>
                <span>300 GW</span>
              </div>
            </div>
            
            <div class="slider-container">
              <label class="slider-label">Nuclear Average Cost ($/kW)</label>
              <input type="range" min="2000" max="8000" step="100" value="5000" id="nuclear-cost">
              <div class="slider-values">
                <span>$2000/kW</span>
                <span class="slider-current" id="nuclear-cost-value">$5000/kW</span>
                <span>$8000/kW</span>
              </div>
            </div>
          </div>
        </div>
        
        <div style="text-align: center; margin-top:20px;">
          <button onclick="updateCalculations()">Recalculate with New Parameters</button>
        </div>
      </div>
      
      <!-- Energy Efficiency Tab -->
      <div class="tab-content" id="efficiency">
        <div class="card">
          <h3 class="card-title">Household Energy Savings</h3>
          <div class="grid grid-cols-2">
            <div>
              <table>
                <tr>
                  <th>Source</th>
                  <th>Energy Saved (kWh)</th>
                </tr>
                <tr>
                  <td><a href="#" class="tech-link" onclick="showTechInfo('passive-solar'); return false;">Passive Solar</a></td>
                  <td id="passive-solar-savings">2,250</td>
                </tr>
                <tr>
                  <td><a href="#" class="tech-link" onclick="showTechInfo('gshp'); return false;">GSHP Heating</a></td>
                  <td id="gshp-heating-savings">1,607</td>
                </tr>
                <tr>
                  <td>GSHP Cooling</td>
                  <td id="gshp-cooling-savings">459</td>
                </tr>
                <tr>
                  <td><a href="#" class="tech-link" onclick="showTechInfo('hpwh'); return false;">HP Water Heater</a></td>
                  <td id="hpwh-savings">1,157</td>
                </tr>
                <tr>
                  <td>HP Dryer</td>
                  <td id="dry-savings">150</td>
                </tr>
                <tr>
                  <td><strong>Total Savings</strong></td>
                  <td id="total-household-savings"><strong>5,623</strong></td>
                </tr>
              </table>
            </div>
            
            <div>
              <div class="bar-chart">
                <div id="efficiency-savings-chart">
                  <!-- Bars will be dynamically inserted here -->
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2" style="margin-top: 20px;">
            <div class="stat-box blue">
              <div class="stat-label">Annual Energy Savings</div>
              <div class="stat-value" id="annual-energy-savings">5,623 kWh</div>
              <div class="stat-subtitle">per household</div>
            </div>
            
            <div class="stat-box green">
              <div class="stat-label">Reduction in Consumption</div>
              <div class="stat-value" id="consumption-reduction-pct">52%</div>
              <div class="stat-subtitle">of household energy use</div>
            </div>
          </div>
        </div>
        
        <div class="card">
          <h3 class="card-title">Economic Analysis</h3>
          
          <div class="grid grid-cols-2">
            <div class="stat-box">
              <div class="stat-label">System Cost</div>
              <div class="stat-value" id="system-cost">$29,000</div>
              <div class="stat-subtitle">Before incentives</div>
            </div>
            
            <div class="stat-box">
              <div class="stat-label">After Incentives</div>
              <div class="stat-value" id="net-system-cost">$19,100</div>
              <div class="stat-subtitle">Net cost</div>
            </div>
            
            <div class="stat-box">
              <div class="stat-label">Annual Savings</div>
              <div class="stat-value" id="annual-cost-savings">$562</div>
              <div class="stat-subtitle">Utility bill reduction</div>
            </div>
            
            <div class="stat-box">
              <div class="stat-label">Payback Period</div>
              <div class="stat-value" id="household-payback">8.5 years</div>
              <div class="stat-subtitle">With incentives</div>
            </div>
          </div>
          
          <div class="chart-container" id="payback-chart">
            <!-- Payback period chart will be rendered here -->
          </div>
        </div>
        
        <div class="card">
          <h3 class="card-title">National Impact at <span id="adoption-rate-display">25</span>% Adoption</h3>
          
          <div class="grid grid-cols-2">
            <div>
              <div class="metric-row">
                <span class="metric-label">Homes Retrofitted:</span>
                <span class="metric-value" id="homes-adopting">32.5 million</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Total Energy Saved:</span>
                <span class="metric-value" id="national-energy-saved">182.7 TWh</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Carbon Reduction:</span>
                <span class="metric-value" id="efficiency-carbon-reduction">76.2 million tons</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">% of US Emissions:</span>
                <span class="metric-value" id="efficiency-emission-percent">1.46%</span>
              </div>
            </div>
            
            <div>
              <div class="metric-row">
                <span class="metric-label">Grid Capacity Freed:</span>
                <span class="metric-value" id="grid-capacity-freed">4.8%</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">EVs Supported:</span>
                <span class="metric-value" id="evs-supported">65.4 million</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Total Investment:</span>
                <span class="metric-value" id="efficiency-investment">$621.0 billion</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Jobs Created:</span>
                <span class="metric-value" id="efficiency-jobs">3.1 million</span>
              </div>
            </div>
          </div>
          
          <div class="chart-container" id="efficiency-impact-chart">
            <!-- National impact chart will be rendered here -->
          </div>
        </div>
      </div>
      
      <!-- Renewable Tab -->
      <div class="tab-content" id="renewable">
        <div class="card">
          <h3 class="card-title">Renewable Energy Generation</h3>
          
          <div class="renewable-grid">
            <div>
              <div class="stats-grid">
                <div class="stat-box green">
                  <div class="stat-label">Total Energy Generation</div>
                  <div class="stat-value" id="total-clean-energy">400 TWh</div>
                  <div class="stat-subtitle" id="total-energy-percent">10.5% of US consumption</div>
                </div>
                
                <div class="stat-box blue">
                  <div class="stat-label">Carbon Avoided</div>
                  <div class="stat-value" id="renewable-carbon-avoided">166.8 MT</div>
                  <div class="stat-subtitle" id="renewable-carbon-percent">3.2% of US emissions</div>
                </div>
                
                <div class="stat-box yellow">
                  <div class="stat-label">Total Investment</div>
                  <div class="stat-value" id="renewable-investment">$250B</div>
                  <div class="stat-subtitle" id="renewable-payback">Payback: 8.6 years</div>
                </div>
                
                <div class="stat-box purple">
                  <div class="stat-label">Jobs Created</div>
                  <div class="stat-value" id="renewable-jobs">450K</div>
                  <div class="stat-subtitle" id="renewable-jobs-per-million">1.8 jobs per $1M</div>
                </div>
              </div>
              
              <h4 style="margin-top: 20px;">Energy Generation by Source</h4>
              <div id="renewable-generation-chart" class="chart-container">
                <!-- Chart will be rendered here -->
              </div>
            </div>
            
            <div>
              <h4>Source Breakdown</h4>
              <div class="source-breakdown">
                <div class="metric-row">
                  <span class="metric-label">Food Waste Energy:</span>
                  <span class="metric-value" id="food-waste-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Agricultural Waste Energy:</span>
                  <span class="metric-value" id="ag-waste-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Forest Waste Energy:</span>
                  <span class="metric-value" id="forest-waste-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Municipal Solid Waste Energy:</span>
                  <span class="metric-value" id="msw-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Biogas Energy:</span>
                  <span class="metric-value" id="biogas-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Algae Energy:</span>
                  <span class="metric-value" id="algae-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Hemp Energy:</span>
                  <span class="metric-value" id="hemp-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">SkySails Energy:</span>
                  <span class="metric-value" id="skysails-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Solar Energy:</span>
                  <span class="metric-value" id="solar-energy">0 TWh</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Nuclear Energy:</span>
                  <span class="metric-value" id="nuclear-energy">0 TWh</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2" style="margin-top: 20px;">
            <div class="card">
              <h4 class="card-title">Waste Stream Utilization</h4>
              <div id="waste-utilization-chart" class="chart-container">
                <!-- Chart will be rendered here -->
              </div>
            </div>
            
            <div class="card">
              <h4 class="card-title">Economic Analysis</h4>
              <div class="metric-row">
                <span class="metric-label">Waste-to-Energy Cost:</span>
                <span class="metric-value" id="waste-energy-cost">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">SkySails Cost:</span>
                <span class="metric-value" id="skysails-cost">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Solar Investment:</span>
                <span class="metric-value" id="solar-investment">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Nuclear Investment:</span>
                <span class="metric-value" id="nuclear-investment">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Annual Revenue:</span>
                <span class="metric-value" id="renewable-annual-revenue">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Operating Cost:</span>
                <span class="metric-value" id="renewable-operating-cost">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Net Annual Revenue:</span>
                <span class="metric-value" id="renewable-net-revenue">$0B</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Transportation Tab -->
      <div class="tab-content" id="transport">
        <div class="card">
          <h3 class="card-title">Transportation Impact</h3>
          
          <div class="transport-row">
            <div class="stat-box green">
              <div class="stat-label">Total Carbon Reduction</div>
              <div class="stat-value" id="transport-carbon-reduction">150 MT</div>
              <div class="stat-subtitle" id="transport-carbon-percent">2.9% of US emissions</div>
            </div>
            
            <div class="stat-box blue">
              <div class="stat-label">Oil Import Reduction</div>
              <div class="stat-value" id="oil-import-reduction">3.6 million bbl/day</div>
              <div class="stat-subtitle" id="oil-import-percent">40% of US imports</div>
            </div>
          </div>
          
          <div class="chart-container" id="transport-carbon-chart">
            <!-- Chart will be rendered here -->
          </div>
          
          <div class="transport-row">
            <div class="card">
              <h4 class="card-title">Economic Analysis</h4>
              <div class="metric-row">
                <span class="metric-label">Fleet Retrofit Cost:</span>
                <span class="metric-value" id="fleet-retrofit-cost">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Carbon Capture Cost:</span>
                <span class="metric-value" id="ccu-cost">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Total Investment:</span>
                <span class="metric-value" id="transport-investment">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Annual Savings:</span>
                <span class="metric-value" id="transport-savings">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Payback Period:</span>
                <span class="metric-value" id="transport-payback">0 years</span>
              </div>
            </div>
            
            <div class="card">
              <h4 class="card-title">Jobs & Energy Impact</h4>
              <div class="metric-row">
                <span class="metric-label">Algae Jobs:</span>
                <span class="metric-value" id="algae-jobs">0</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Hemp Jobs:</span>
                <span class="metric-value" id="hemp-jobs">0</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Retrofit Jobs:</span>
                <span class="metric-value" id="retrofit-jobs">0</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Total Jobs:</span>
                <span class="metric-value" id="transport-jobs">0</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Biofuel Production:</span>
                <span class="metric-value" id="biofuel-production">0 TWh</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Water Tab -->
      <div class="tab-content" id="water">
        <div class="card">
          <h3 class="card-title">Water Production Impact</h3>
          
          <div class="grid grid-cols-2">
            <div class="stats-grid">
              <div class="stat-box blue">
                <div class="stat-label">Total Water Production</div>
                <div class="stat-value" id="total-water-production">120 million m³</div>
                <div class="stat-subtitle" id="water-percent">0.3% of US withdrawals</div>
              </div>
              
              <div class="stat-box teal">
                <div class="stat-label">Population Served</div>
                <div class="stat-value" id="population-served">3.3 million</div>
                <div class="stat-subtitle">people</div>
              </div>
              
              <div class="stat-box yellow">
                <div class="stat-label">Total Investment</div>
                <div class="stat-value" id="water-investment">$30B</div>
                <div class="stat-subtitle" id="water-payback">Payback: 6 years</div>
              </div>
              
              <div class="stat-box green">
                <div class="stat-label">Carbon Reduction</div>
                <div class="stat-value" id="water-carbon-reduction">15 MT</div>
                <div class="stat-subtitle" id="water-carbon-percent">0.3% of US emissions</div>
              </div>
            </div>
            
            <div class="pie-charts-container">
              <div>
                <h4>Water Production Method</h4>
                <div id="water-production-breakdown" class="chart-container" style="height: 200px;">
                  <!-- Chart will be rendered here -->
                </div>
              </div>
              
              <div>
                <h4>Energy Allocation</h4>
                <div id="water-energy-allocation" class="chart-container" style="height: 200px;">
                  <!-- Chart will be rendered here -->
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2" style="margin-top: 20px;">
            <div class="card">
              <h4 class="card-title">Economic Analysis</h4>
              <div class="metric-row">
                <span class="metric-label">Desalination Investment:</span>
                <span class="metric-value" id="desalination-investment">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">AWG Investment:</span>
                <span class="metric-value" id="awg-investment">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Annual Water Value:</span>
                <span class="metric-value" id="water-value">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Operating Cost:</span>
                <span class="metric-value" id="water-operating-cost">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Net Annual Value:</span>
                <span class="metric-value" id="water-net-value">$0B</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Jobs Created:</span>
                <span class="metric-value" id="water-jobs">0</span>
              </div>
            </div>
            
            <div class="card">
              <h4 class="card-title">Agricultural Impact</h4>
              <div class="metric-row">
                <span class="metric-label">Water for Agriculture:</span>
                <span class="metric-value" id="agriculture-water">0 million m³</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Irrigated Land:</span>
                <span class="metric-value" id="irrigated-land">0 hectares</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">Food Production:</span>
                <span class="metric-value" id="food-production">0 tons</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">People Fed:</span>
                <span class="metric-value" id="people-fed">0</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Phased Implementation Tab -->
      <div class="tab-content" id="phased">
        <div class="card">
          <h3 class="card-title">Phased Implementation Timeline</h3>
          
          <div class="chart-container" id="phased-timeline-chart">
            <!-- Chart will be rendered here -->
          </div>
          
          <table>
            <thead>
              <tr>
                <th>Phase</th>
                <th>Year</th>
                <th>Carbon Reduction (MT)</th>
                <th>Investment ($B)</th>
                <th>Energy Impact (TWh)</th>
                <th>Jobs (millions)</th>
              </tr>
            </thead>
            <tbody id="phased-plan-table">
              <!-- Implementation phases will be added here dynamically -->
            </tbody>
          </table>
          
          <div class="footnote">
            Note: The phased implementation plan dynamically adjusts based on selected priorities and implementation speed.
            <ul>
              <li>Efficiency First: Focus on reducing demand before deploying generation</li>
              <li>Generation First: Focus on expanding clean energy supply alongside demand reduction</li>
              <li>Implementation speed: Faster implementation means shorter time between phases but may increase costs</li>
            </ul>
          </div>
        </div>
        
        <div class="card">
          <h3 class="card-title">Cumulative Impact Analysis</h3>
          <div class="chart-container" id="cumulative-impact-chart">
            <!-- Chart will be rendered here -->
          </div>
        </div>
      </div>
    </div>
    
    <div class="action-buttons">
      <div class="button-group">
        <button id="export-button">Export Results</button>
        <button id="print-button" class="tertiary">Print Report</button>
      </div>
      
      <div id="file-upload-container">
        <label for="file-upload" class="file-upload-label">Load Saved Scenario</label>
        <input type="file" id="file-upload" accept=".json">
      </div>
      
      <button class="secondary" id="reset-button">Reset Parameters</button>
    </div>
  </div>
  
  <!-- Technology Info Modal -->
  <div id="tech-modal" class="modal">
    <div class="modal-content tech-modal-content">
      <span class="close" onclick="closeTechModal()">&times;</span>
      <div id="tech-info-content">
        <!-- Technology information will be inserted here -->
      </div>
      <div class="tech-info-footer">
        Source: Technologies are described based on current commercial applications and research data.
      </div>
    </div>
  </div>
  
  <!-- Load Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <script>
    // -------------- INITIALIZATION AND SETUP --------------
    
    // Tab switching
    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all tabs and contents
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Add active class to the clicked tab and corresponding content
        button.classList.add('active');
        document.getElementById(button.dataset.tab).classList.add('active');
      });
    });
    
    function switchToTab(tabId) {
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      document.querySelector(`.tab-button[data-tab="${tabId}"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }
    
    // Implementation type toggle
    document.getElementById('retrofit-button').addEventListener('click', function() {
      this.classList.add('active');
      document.getElementById('new-construction-button').classList.remove('active');
      updateCalculations();
    });
    
    document.getElementById('new-construction-button').addEventListener('click', function() {
      this.classList.add('active');
      document.getElementById('retrofit-button').classList.remove('active');
      updateCalculations();
    });
    
    // Track all relevant sliders here to update on input
    const sliders = [
      'passive-solar-efficiency',
      'gshp-cop',
      'hpwh-efficiency',
      'efficiency-adoption-rate',
      'food-waste-utilization',
      'agriculture-utilization',
      'skysails-units',
      'electricity-price',
      'retrofit-percentage',
      'ccu-adoption',
      'hemp-utilization',
      'algae-percentage',
      'energy-allocation-to-water',
      'desalination-allocation',
      'water-techs-efficiency',
      'water-value-usd',
      'implementation-speed',
      'solar-capacity',
      'solar-cost',
      'nuclear-capacity',
      'nuclear-cost'
    ];
    
    sliders.forEach(sliderId => {
      const slider = document.getElementById(sliderId);
      const valueDisplay = document.getElementById(`${sliderId}-value`);
      
      slider.addEventListener('input', () => {
        let displayValue = slider.value;
        
        if (sliderId === 'skysails-units') {
          displayValue = parseInt(slider.value).toLocaleString();
        } else if (sliderId === 'water-value-usd') {
          displayValue = `$${parseFloat(slider.value).toFixed(2)}`;
        } else if (
          sliderId.includes('efficiency') || 
          sliderId.includes('utilization') || 
          sliderId.includes('percentage') || 
          sliderId.includes('adoption') ||
          sliderId.includes('allocation')
        ) {
          displayValue = `${slider.value}%`;
        } else if (sliderId === 'gshp-cop') {
          displayValue = `${parseFloat(slider.value).toFixed(1)}`;
        } else if (sliderId === 'hpwh-efficiency') {
          displayValue = `${parseFloat(slider.value).toFixed(1)}x`;
        } else if (sliderId === 'electricity-price') {
          displayValue = `${slider.value}¢`;
        } else if (sliderId === 'solar-capacity') {
          displayValue = `${slider.value} GW`;
        } else if (sliderId === 'solar-cost') {
          displayValue = `$${slider.value}/kW`;
        } else if (sliderId === 'nuclear-capacity') {
          displayValue = `${slider.value} GW`;
        } else if (sliderId === 'nuclear-cost') {
          displayValue = `$${slider.value}/kW`;
        }
        
        if (valueDisplay) {
          valueDisplay.textContent = displayValue;
        }
        
        updateCalculations();
        
        if (sliderId === 'efficiency-adoption-rate') {
          document.getElementById('adoption-rate-display').textContent = slider.value;
        }
      });
    });
    
    // Efficiency first toggle
    document.getElementById('efficiency-first-toggle').addEventListener('input', updateCalculations);
    
    // Reset button
    document.getElementById('reset-button').addEventListener('click', resetParameters);
    
    // Export button
    document.getElementById('export-button').addEventListener('click', exportResults);
    
    // Print button
    document.getElementById('print-button').addEventListener('click', printReport);
    
    // File upload
    document.getElementById('file-upload').addEventListener('change', handleFileUpload);
    
    // -------------- DATA CONSTANTS --------------
    
    // US data - baseline information for calculations
    const usData = {
      population: 332.8, // million
      electricityConsumption: 3800, // TWh per year
      residentialConsumption: 1470, // TWh per year
      commercialConsumption: 1330, // TWh per year
      industrialConsumption: 1000, // TWh per year
      totalEnergyConsumption: 100, // quads (approximate)
      foodWaste: 63, // million tons per year
      agriculturalWaste: 800, // million tons per year
      municipalSolidWaste: 292, // million tons per year
      forestResidues: 93, // million tons per year
      constructionWaste: 600, // million tons per year
      co2Emissions: 5222, // million tons per year
      totalWaterWithdrawals: 450, // billion m³ per year
      publicWaterSupply: 42, // billion m³ per year
      households: 129.9, // million
      totalVehicles: 290, // million
      averageHouseholdConsumption: 10715, // kWh per year
      fuelImports: 9, // million barrels per day
    };
    
    // Technology information for modal displays
    const technologyInfo = {
      'passive-solar': {
        title: 'Passive Solar Design',
        description: 'Passive solar design leverages a building\'s site, climate, and materials to minimize energy use for heating, cooling, and lighting. It involves properly orienting the building, designing overhangs, utilizing thermal mass, and implementing high-performance windows and insulation.',
        benefits: [
          'Reduces heating and cooling loads by 20-90% depending on climate and design',
          'Zero operational energy requirements',
          'Long lifespan (50+ years) with minimal maintenance',
          'Improves thermal comfort and natural lighting'
        ],
        link: 'https://www.energy.gov/energysaver/passive-solar-home-design'
      },
      'gshp': {
        title: 'Geothermal Heat Pump (GSHP)',
        description: 'Geothermal heat pumps, also known as ground-source heat pumps, transfer heat between a building and the ground. They utilize the constant temperature of the earth to provide heating, cooling, and often hot water, with much higher efficiency than conventional systems.',
        benefits: [
          'Coefficient of Performance (COP) of 3.0-5.0 (300-500% efficiency)',
          'Reduces heating costs by 30-70% and cooling costs by 20-50%',
          'Long lifespan (20-25 years for heat pump, 50+ years for ground loop)',
          'Can provide both heating and cooling from a single system'
        ],
        link: 'https://www.energy.gov/energysaver/geothermal-heat-pumps'
      },
      'hpwh': {
        title: 'Heat Pump Water Heater',
        description: 'Heat pump water heaters extract heat from surrounding air and transfer it to water in a tank. They use electricity to move heat rather than generating it directly, making them 2-3 times more efficient than conventional electric water heaters.',
        benefits: [
          'Energy Factor (EF) of 2.0-3.5 compared to 0.9 for conventional electric water heaters',
          'Can reduce water heating costs by 50-70%',
          'Provides cooling and dehumidification as a side benefit',
          'Eligible for federal and utility rebates and incentives'
        ],
        link: 'https://www.energy.gov/energysaver/heat-pump-water-heaters'
      },
      'food-waste': {
        title: 'Food Waste-to-Energy',
        description: 'Food waste-to-energy involves converting food waste into biogas through anaerobic digestion. The biogas, primarily methane, can be used for electricity generation, heating, or as a transportation fuel after purification.',
        benefits: [
          'Diverts food waste from landfills, reducing methane emissions',
          'Produces renewable energy and nutrient-rich digestate for fertilizer',
          'Can process a wide variety of food waste types',
          'Integrates well with existing waste management infrastructure'
        ],
        link: 'https://www.epa.gov/anaerobic-digestion/basic-information-about-anaerobic-digestion-ad'
      },
      'ag-waste': {
        title: 'Agricultural Waste-to-Energy',
        description: 'Agricultural waste-to-energy converts crop residues, animal manure, and other farm byproducts into energy through various processes including combustion, gasification, pyrolysis, or anaerobic digestion.',
        benefits: [
          'Creates value from waste streams that would otherwise be burned or left to decompose',
          'Reduces methane emissions from livestock waste',
          'Produces biochar as a byproduct that can sequester carbon when applied to soils',
          'Can provide on-farm energy independence'
        ],
        link: 'https://www.energy.gov/eere/bioenergy/bioenergy-technologies-office'
      },
      'skysails': {
        title: 'SkySails Power System',
        description: 'SkySails Power systems harness high-altitude wind energy using automated kites or parafoils flying at altitudes of 200-800 meters. The technology uses the pulling power of the kite to drive a ground-based generator, providing renewable electricity with minimal land use.',
        benefits: [
          'Accesses stronger, more consistent winds at higher altitudes',
          'Uses 90% less material than conventional wind turbines',
          'Minimal visual impact and land use requirements',
          'Can be deployed in areas unsuitable for conventional wind turbines'
        ],
        link: 'https://skysails-power.com/'
      },
      'fleet-retrofit': {
        title: 'Vehicle Fleet Retrofit',
        description: 'Vehicle fleet retrofitting involves modifying existing vehicles with technologies to improve fuel efficiency and reduce emissions. This includes aerodynamic improvements, engine modifications, tire upgrades, and the installation of emission control devices.',
        benefits: [
          'Extends the useful life of existing vehicles',
          'Much lower cost than full fleet replacement',
          'Can be implemented quickly across large fleets',
          'Adaptable to different vehicle types and use cases'
        ],
        link: 'https://afdc.energy.gov/vehicles/conversions.html'
      },
      'carbon-capture': {
        title: 'Carbon Capture and Utilization',
        description: 'Carbon Capture and Utilization (CCU) captures CO₂ emissions from power plants or industrial facilities and converts the carbon into valuable products like building materials, chemicals, fuels, or plastics rather than storing it underground.',
        benefits: [
          'Creates economic value from captured carbon',
          'Offsets costs of carbon capture technology',
          'Can displace fossil-derived products with recycled carbon',
          'Applicable across many industrial sectors'
        ],
        link: 'https://www.energy.gov/fecm/carbon-utilization'
      },
      'hemp': {
        title: 'Industrial Hemp',
        description: 'Industrial hemp is a versatile crop that can be processed into biofuels (biodiesel and ethanol), building materials, textiles, and other products. As an energy crop, hemp produces high yields with low input requirements and has excellent carbon sequestration properties.',
        benefits: [
          'Grows quickly with minimal pesticides and fertilizers',
          'Sequesters more CO₂ per acre than many other crops',
          'Improves soil health through phytoremediation',
          'Multiple revenue streams from different plant components'
        ],
        link: 'https://www.agriculture.senate.gov/imo/media/doc/testimony_steenstra.pdf'
      },
      'algae': {
        title: 'Algae Biofuels',
        description: 'Algae biofuels are produced from algae biomass rich in lipids (oils) that can be extracted and converted to biodiesel, renewable diesel, or jet fuel. Algae can be grown in open ponds, photobioreactors, or heterotrophic tanks with high yields per acre.',
        benefits: [
          'Up to 10-100 times higher oil yield per acre than terrestrial crops',
          'Can be grown on non-arable land using saline or wastewater',
          'Can utilize CO₂ from industrial emissions as a feedstock',
          'Produces valuable co-products like protein, fertilizer, and chemicals'
        ],
        link: 'https://www.energy.gov/eere/bioenergy/algal-biofuels'
      },
      'desalination': {
        title: 'Solar-Powered Desalination',
        description: 'Solar-powered desalination uses renewable solar energy to drive the desalination process, removing salt and impurities from seawater or brackish water to produce freshwater. Technologies include solar thermal desalination, photovoltaic reverse osmosis, and membrane distillation.',
        benefits: [
          'Operates with zero carbon emissions when powered by renewable energy',
          'Can be scaled from small community systems to large facilities',
          'Viable in remote coastal locations without grid connection',
          'Declining costs due to improvements in both solar and desalination technologies'
        ],
        link: 'https://www.energy.gov/eere/solar/solar-desalination'
      },
      'water-tech': {
        title: 'Advanced Water Technologies',
        description: 'Advanced water technologies include systems for atmospheric water generation (AWG), water reuse, precision irrigation, and smart water management. These technologies maximize water efficiency, reduce energy requirements, and expand access to clean water resources.',
        benefits: [
          'Atmospheric water generators can produce water in areas without traditional water sources',
          'Water reuse systems can reduce freshwater demand by 30-90%',
          'Smart meters and leak detection can reduce water losses by 15-30%',
          'Integrates with renewable energy for sustainable water-energy systems'
        ],
        link: 'https://www.energy.gov/water-energy-tech-team'
      },
      'solar': {
        title: 'Solar Photovoltaic Systems',
        description: 'Solar photovoltaic (PV) systems convert sunlight directly into electricity using semiconductor materials. Modern solar PV includes traditional silicon panels, thin-film technologies, and emerging technologies like perovskite solar cells.',
        benefits: [
          'Zero emissions during operation',
          'Rapidly declining costs (90% reduction since 2009)',
          'Modular design allows scaling from small rooftop to utility-scale installations',
          'Minimal maintenance requirements and 25-30 year lifespan'
        ],
        link: 'https://www.energy.gov/eere/solar/solar-photovoltaic-technology-basics'
      },
      'nuclear': {
        title: 'Advanced Nuclear Energy',
        description: 'Advanced nuclear technologies include small modular reactors (SMRs), Generation IV designs, and fusion energy systems. These newer designs emphasize enhanced safety, reduced waste, lower costs, and greater flexibility compared to traditional nuclear plants.',
        benefits: [
          'Near-zero carbon emissions during operation',
          'High energy density and small physical footprint',
          'Constant baseload power production independent of weather conditions',
          'New designs incorporate passive safety features and can integrate with renewable energy'
        ],
        link: 'https://www.energy.gov/ne/advanced-reactor-demonstration-program'
      }
    };
    
    // Chart configurations and instances
    let charts = {};
    
    // -------------- UTILITY FUNCTIONS --------------
    
    function formatNumber(num, decimals = 2) {
      if (num === undefined || num === null) return 'N/A';
      if (num === 0) return '0';
      if (Math.abs(num) < 1000) {
        return parseFloat(num.toFixed(decimals));
      }
      return num.toLocaleString(undefined, { 
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }
    
    function showAlert(message, type) {
      const alertBox = document.getElementById(`alert-${type}`);
      alertBox.textContent = message;
      alertBox.style.display = 'block';
      
      setTimeout(() => {
        alertBox.style.display = 'none';
      }, 3000);
    }
    
    // Technology info modal functions
    function showTechInfo(techId) {
      const modal = document.getElementById('tech-modal');
      const content = document.getElementById('tech-info-content');
      
      if (technologyInfo[techId]) {
        const tech = technologyInfo[techId];
        
        let benefitsList = '';
        if (tech.benefits && tech.benefits.length > 0) {
          benefitsList = '<h4>Key Benefits</h4><ul>';
          tech.benefits.forEach(benefit => {
            benefitsList += `<li>${benefit}</li>`;
          });
          benefitsList += '</ul>';
        }
        
        let linkSection = '';
        if (tech.link) {
          linkSection = `<p><a href="${tech.link}" target="_blank">Learn more about ${tech.title}</a></p>`;
        }
        
        content.innerHTML = `
          <h3>${tech.title}</h3>
          <p>${tech.description}</p>
          ${benefitsList}
          ${linkSection}
        `;
      } else {
        content.innerHTML = '<h3>Technology Information</h3><p>Detailed information not available for this technology.</p>';
      }
      
      modal.style.display = 'flex';
    }
    
    function closeTechModal() {
      document.getElementById('tech-modal').style.display = 'none';
    }
    
    // Close the modal if user clicks outside of it
    window.onclick = function(event) {
      const modal = document.getElementById('tech-modal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    };
    
    // -------------- CALCULATION FUNCTIONS --------------
    
    function calculateSolarNuclearEnergy(solarGW, solarCost, nuclearGW, nuclearCost, electricityPrice) {
      const hoursPerYear = 8760;
      const solarCF = 0.25; // Capacity factor for solar
      const nuclearCF = 0.90; // Capacity factor for nuclear
      
      // Energy production in TWh/year
      const solarEnergyTWh = (solarGW * hoursPerYear * solarCF) / 1000;
      const nuclearEnergyTWh = (nuclearGW * hoursPerYear * nuclearCF) / 1000;
      const totalEnergy = solarEnergyTWh + nuclearEnergyTWh;
      
      // Investment costs in billions
      const solarInvestment = (solarGW * 1_000_000 * solarCost) / 1_000_000_000;
      const nuclearInvestment = (nuclearGW * 1_000_000 * nuclearCost) / 1_000_000_000;
      const totalInvestment = solarInvestment + nuclearInvestment;
      
      // Carbon avoided (assuming 0.4 tons CO2 per MWh for grid electricity)
      const carbonAvoided = (totalEnergy * 1_000_000 * 0.4) / 1_000_000;
      
      // Jobs created (rough estimate)
      const solarJobsPerMW = 3.3; // Operations + construction
      const nuclearJobsPerMW = 0.5; // Operations + construction
      const solarJobs = solarGW * 1000 * solarJobsPerMW;
      const nuclearJobs = nuclearGW * 1000 * nuclearJobsPerMW;
      const jobs = Math.round(solarJobs + nuclearJobs);
      
      // Revenue and operating costs
      const annualRevenue = (totalEnergy * 1_000_000_000 * (electricityPrice / 100)) / 1_000_000_000;
      const solarOpCost = solarEnergyTWh * 0.015; // $15/MWh
      const nuclearOpCost = nuclearEnergyTWh * 0.025; // $25/MWh
      const operatingCost = solarOpCost + nuclearOpCost;
      const netAnnualRevenue = annualRevenue - operatingCost;
      
      let payback = 0;
      if (netAnnualRevenue > 0) payback = totalInvestment / netAnnualRevenue;
      
      return {
        solarEnergyTWh,
        nuclearEnergyTWh,
        totalEnergy,
        solarInvestment,
        nuclearInvestment,
        totalInvestment,
        carbonAvoided,
        solarJobs,
        nuclearJobs,
        jobs,
        annualRevenue,
        operatingCost,
        netAnnualRevenue,
        payback
      };
    }
    
    function calculateEfficiencySavings(
      passiveSolarEfficiency, gshpCOP, hpwhEfficiency, efficiencyAdoptionRate, 
      isNewConstruction, electricityPrice
    ) {
      // Average U.S. residential consumption values in kWh per household per year
      const originalSpaceHeating = 4500;
      const originalCooling = 643;
      const originalWaterHeating = 1928;
      const originalDryer = 536;
      
      // Calculate savings from each efficiency measure
      const passiveSolarSavings = originalSpaceHeating * (passiveSolarEfficiency / 100);
      const remainingHeatingLoad = originalSpaceHeating - passiveSolarSavings;
      
      // Geothermal heat pump savings
      const gshpHeatingElectricity = remainingHeatingLoad / gshpCOP;
      const gshpHeatingSavings = remainingHeatingLoad - gshpHeatingElectricity;
      
      const gshpCoolingElectricity = originalCooling / gshpCOP;
      const gshpCoolingSavings = originalCooling - gshpCoolingElectricity;
      
      // Heat pump water heater savings
      const hpwhConsumption = originalWaterHeating / hpwhEfficiency;
      const hpwhSavings = originalWaterHeating - hpwhConsumption;
      
      // Heat pump dryer savings (estimated at 28% more efficient)
      const drySavings = originalDryer * 0.28;
      
      // Total savings and percent reduction
      const totalHeatingDSavings = passiveSolarSavings + gshpHeatingSavings;
      const totalSavings = passiveSolarSavings + gshpHeatingSavings + gshpCoolingSavings + hpwhSavings + drySavings;
      const percentageReduction = (totalSavings / usData.averageHouseholdConsumption) * 100;
      const remainingConsumption = usData.averageHouseholdConsumption - totalSavings;
      
      // System costs and incentives
      const passiveSolarCost = isNewConstruction ? 8000 : 18000;
      const geothermalInstallCost = 18000;
      const hpwhCost = 1800;
      const heatPumpDryerCost = 1200;
      const totalSystemCost = passiveSolarCost + geothermalInstallCost + hpwhCost + heatPumpDryerCost;
      
      const federalTaxCredit = (passiveSolarCost + geothermalInstallCost) * 0.30;
      const stateRebate = 3000;
      const utilityRebate = 2000;
      const totalIncentives = federalTaxCredit + stateRebate + utilityRebate;
      const netSystemCost = totalSystemCost - totalIncentives;
      
      // Economic analysis
      const annualCostSavings = totalSavings * (electricityPrice / 100);
      const simplePayback = totalSystemCost / annualCostSavings;
      const netPayback = netSystemCost / annualCostSavings;
      
      // National impact calculations
      const homesAdopting = usData.households * (efficiencyAdoptionRate / 100);
      const totalEnergySaved = (homesAdopting * totalSavings) / 1000000000; // Convert to TWh
      const totalEnergySavedQuads = totalEnergySaved * 0.003412; // Convert TWh to quads
      
      // Carbon reduction (0.417 kg CO2 per kWh is US average grid emissions)
      const carbonReductionPerHousehold = (totalSavings * 0.417) / 1000; // tons CO2
      const totalCarbonReduction = (homesAdopting * carbonReductionPerHousehold) / 1000000; // million tons
      const percentOfUSEmissions = (totalCarbonReduction / usData.co2Emissions) * 100;
      
      // EV support calculations
      const evAnnualUsage = 2800; // kWh per year for average EV
      const evsPerHousehold = totalSavings / evAnnualUsage;
      const totalEvsSupported = homesAdopting * evsPerHousehold;
      const percentOfVehicleFleet = (totalEvsSupported / usData.totalVehicles) * 100;
      
      // Grid impact and investment calculations
      const gridCapacityFreed = (totalEnergySaved / usData.electricityConsumption) * 100;
      const totalNationalInvestment = (homesAdopting * netSystemCost) / 1000000000; // billions of $
      
      // Job creation (roughly 5 jobs per $1M invested in efficiency)
      const jobsCreated = Math.round(((homesAdopting * netSystemCost) / 1000000) * 5);
      
      return {
        perHousehold: {
          passiveSolarSavings,
          gshpHeatingSavings,
          gshpCoolingSavings,
          hpwhSavings,
          drySavings,
          totalSavings,
          percentageReduction,
          remainingConsumption,
          systemCost: totalSystemCost,
          netSystemCost,
          annualCostSavings,
          paybackPeriod: netPayback,
          carbonReduction: carbonReductionPerHousehold,
          evsSupported: evsPerHousehold
        },
        national: {
          homesAdopting,
          totalEnergySaved,
          totalEnergySavedQuads,
          totalCarbonReduction,
          percentOfUSEmissions,
          totalEvsSupported,
          percentOfVehicleFleet,
          gridCapacityFreed,
          totalInvestment: totalNationalInvestment,
          jobsCreated,
          annualSavings: (homesAdopting * annualCostSavings) / 1000000000 // billions of $
        }
      };
    }
    
    function calculateEnergyGeneration(
      foodWasteUtilization, agricultureUtilization, forestUtilization, mswUtilization,
      skySailsUnits, electricityPrice, hempUtilization, algaePercentage
    ) {
      // Calculate available waste quantities based on utilization percentages
      const usableFoodWaste = usData.foodWaste * (foodWasteUtilization / 100);
      const usableAgWaste = usData.agriculturalWaste * (agricultureUtilization / 100);
      const usableForestWaste = usData.forestResidues * (forestUtilization / 100);
      const usableMSW = usData.municipalSolidWaste * (mswUtilization / 100);
      
      // Energy conversion factors (MWh per ton of waste)
      const foodWasteToEnergy = 1.5;
      const agriculturalWasteToEnergy = 1.2;
      const forestResiduesToEnergy = 2.0;
      const mswToEnergy = 0.6;
      
      // Calculate energy production from each waste stream (in TWh)
      const energyFromFoodWaste = (usableFoodWaste * foodWasteToEnergy) / 1000000;
      const energyFromAgWaste = (usableAgWaste * agriculturalWasteToEnergy) / 1000000;
      const energyFromForestWaste = (usableForestWaste * forestResiduesToEnergy) / 1000000;
      const energyFromMSW = (usableMSW * mswToEnergy) / 1000000;
      
      // Biogas production (TWh)
      const energyFromBiogas = (usableFoodWaste * 0.8 + usableAgWaste * 0.3) / 1000000;
      
      // Energy from algae and hemp (biofuels)
      const algaeBase = 28; // TWh at 100% utilization
      const energyFromAlgae = (algaePercentage / 100) * algaeBase;
      
      const hempBase = 12; // TWh at 100% utilization
      const energyFromHemp = (hempUtilization / 100) * hempBase;
      
      // Total waste-to-energy and biofuels
      const wasteToEnergyTotal = energyFromFoodWaste + energyFromAgWaste + energyFromForestWaste + 
                               energyFromMSW + energyFromBiogas;
      const biofuelsTotal = energyFromAlgae + energyFromHemp;
      
      // SkySails wind energy
      const skySailsPerUnit = 0.001; // TWh per unit per year
      const energyFromSkySails = skySailsUnits * skySailsPerUnit;
      
      // Total energy generation
      const totalEnergyGeneration = wasteToEnergyTotal + biofuelsTotal + energyFromSkySails;
      
      // Carbon impact calculations
      const carbonAvoidance = totalEnergyGeneration * 0.417; // million tons CO2 avoided
      
      // Carbon sequestration from biochar production and other processes
      const carbonSequestration = (usableAgWaste + usableForestWaste) * 0.2 / 1000000 + 
                                (hempUtilization / 100) * 5;
      
      const totalCarbonImpact = carbonSequestration + carbonAvoidance;
      
      // Economic calculations
      const wasteToEnergyCost = (usableFoodWaste + usableAgWaste + usableMSW + usableForestWaste) * 0.05; 
      const skySailsCost = skySailsUnits * 0.2; // $200,000 per unit
      const algaeFacilitiesCost = (algaePercentage / 100) * 50; // $50B at 100% utilization
      const hempProcessingCost = (hempUtilization / 100) * 10; // $10B at 100% utilization
      const batteryCost = totalEnergyGeneration * 6; // Energy storage capacity
      
      const totalInvestment = wasteToEnergyCost + skySailsCost + batteryCost + algaeFacilitiesCost + hempProcessingCost;
      
      // Revenue calculations
      const electricityRevenueRate = electricityPrice / 100; // $ per kWh
      const electricityRevenue = totalEnergyGeneration * 1000 * electricityRevenueRate;
      
      // Carbon credit value ($30 per ton)
      const carbonCreditValue = (totalCarbonImpact * 30);
      
      // Byproduct revenues

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Circular Waste-to-Energy Calculator</title>
    <style>
        /* ... [Previous CSS remains the same] ... */
    </style>
</head>
<body>
    <div class="header">
        <h1>Advanced Circular Waste-to-Energy Calculator</h1>
        <p>Calculate energy potential with enhanced feedback loops and two-stage AD</p>
    </div>

    <div class="input-section">
        <label for="population">City Population:</label>
        <input type="number" id="population" placeholder="Enter population" value="10000">
        <button id="calculateButton">Calculate Energy Potential</button>
    </div>

    <div id="result"></div>

    <script>
        function calculateMaximizedSystem() {
            // Get population input
            let population = parseInt(document.getElementById("population").value);

            if (isNaN(population) || population <= 0) {
                document.getElementById("result").innerHTML = "<p class='error'>Please enter a valid population number.</p>";
                return;
            }

            // Base waste calculations
            const humanWastePerDay = 0.0002; // tonnes/person/day
            const mswPerDay = 0.002; // tonnes/person/day
            const annualHumanWaste = population * humanWastePerDay * 365;
            const annualMSW = population * mswPerDay * 365;

            // Waste distribution
            const organicFraction = 0.50;
            const toAD = (annualMSW * organicFraction) + annualHumanWaste;
            const toWTE = annualMSW * 0.30;
            const toGasification = annualMSW * 0.20;

            // Algae system
            const algaeYield = 0.045; // tonnes/m¬≤/year
            const areaPerPerson = 2.5; // m¬≤
            const algaeArea = population * areaPerPerson;
            const annualAlgaeBiomass = algaeYield * algaeArea;
            const lipidContent = 0.45;
            const extractedLipids = annualAlgaeBiomass * lipidContent;
            const spentBiomass = annualAlgaeBiomass * (1 - lipidContent);

            // Biomass distribution
            const spentToAD = spentBiomass * 0.6;
            const spentToGasification = spentBiomass * 0.4;

            // Enhanced Two-Stage AD
            const adEfficiency = 0.48;
            const coDigestionBoost = 1.25;
            const biogasYield = 0.65; // m¬≥/kg VS
            const methaneContent = 0.78;
            const energyPerM3 = 6.5 * (methaneContent/0.60);

            // Calculate AD energy
            const adEnergy = (toAD + spentToAD) * 1000 * adEfficiency * 
                           coDigestionBoost * biogasYield * energyPerM3 / 1000;

            // WTE calculations
            const wteEfficiency = 0.32;
            const calorificValue = 2.8; // MWh/tonne
            const heatRecovery = 0.15;
            const wteEnergy = toWTE * calorificValue * wteEfficiency;
            const wteHeat = toWTE * calorificValue * heatRecovery;

            // Gasification
            const gasificationEff = 0.42;
            const gasificationEnergy = (toGasification + spentToGasification) * 
                                    gasificationEff * 6.2;

            // Algae biofuel
            const conversionEff = 0.40;
            const biofuelEnergy = extractedLipids * conversionEff * 11.6;

            // Integration benefits
            const heatRecoveryTotal = wteHeat + (gasificationEnergy * 0.15);
            const nutrientRecycling = (adEnergy + gasificationEnergy) * 0.08;
            const carbonCapture = (toGasification + spentToGasification) * 0.15 * 0.75 * 3.67 * 0.1;

            // Total system energy
            const totalEnergy = adEnergy + wteEnergy + gasificationEnergy + 
                              biofuelEnergy + heatRecoveryTotal + nutrientRecycling + 
                              carbonCapture;

            // Environmental benefits
            const co2Saved = (toAD * 3.5) + (toGasification * 2.8);
            const biocharProduced = (toGasification + spentToGasification) * 0.15;
            const treesEquivalent = Math.floor(co2Saved * 46);
            const carsRemoved = Math.floor(co2Saved / 4.6);

            // Calculate homes powered
            const avgHomeUsage = 10500; // kWh/year (US average)
            const homesPowered = Math.floor((totalEnergy * 1000) / avgHomeUsage);

            // Display results
            document.getElementById("result").innerHTML = `
                <div class="homes-powered">
                    <h2>Total Impact</h2>
                    <span>üè† ${homesPowered.toLocaleString()} Homes Powered</span>
                    <p>Based on average US household consumption of 10,500 kWh/year</p>
                </div>

                <div class="results">
                    <div class="result-card">
                        <h3>‚ö° Energy Generation</h3>
                        <div class="metric">
                            <div>Enhanced AD:</div>
                            <div class="metric-value">${(adEnergy/1000).toFixed(2)} GWh/year</div>
                        </div>
                        <div class="metric">
                            <div>WTE:</div>
                            <div class="metric-value">${(wteEnergy/1000).toFixed(2)} GWh/year</div>
                        </div>
                        <div class="metric">
                            <div>Gasification:</div>
                            <div class="metric-value">${(gasificationEnergy/1000).toFixed(2)} GWh/year</div>
                        </div>
                        <div class="metric">
                            <div>Algae Biofuel:</div>
                            <div class="metric-value">${(biofuelEnergy/1000).toFixed(2)} GWh/year</div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>üîÑ Integration Benefits</h3>
                        <div class="metric">
                            <div>Heat Recovery:</div>
                            <div class="metric-value">${(heatRecoveryTotal/1000).toFixed(2)} GWh/year</div>
                        </div>
                        <div class="metric">
                            <div>Nutrient Recycling:</div>
                            <div class="metric-value">${(nutrientRecycling/1000).toFixed(2)} GWh/year</div>
                        </div>
                        <div class="metric">
                            <div>Carbon Capture:</div>
                            <div class="metric-value">${(carbonCapture/1000).toFixed(2)} GWh/year</div>
                        </div>
                    </div>

                    <div class="result-card highlight">
                        <h3>üìä System Totals</h3>
                        <div class="metric">
                            <div>Total Energy:</div>
                            <div class="metric-value">${(totalEnergy/1000).toFixed(2)} GWh/year</div>
                        </div>
                        <div class="metric">
                            <div>Biochar Production:</div>
                            <div class="metric-value">${biocharProduced.toFixed(2)} tonnes/year</div>
                        </div>
                        <div class="metric">
                            <div>Algae Lipids:</div>
                            <div class="metric-value">${extractedLipids.toFixed(2)} tonnes/year</div>
                        </div>
                    </div>
                </div>

                <div class="environmental-impact">
                    <h2>üåç Environmental Impact</h2>
                    <div class="results">
                        <div class="metric">
                            <div>Trees Equivalent:</div>
                            <div class="metric-value">${treesEquivalent.toLocaleString()}</div>
                        </div>
                        <div class="metric">
                            <div>Cars Removed:</div>
                            <div class="metric-value">${carsRemoved.toLocaleString()}</div>
                        </div>
                        <div class="metric">
                            <div>CO‚ÇÇ Saved:</div>
                            <div class="metric-value">${co2Saved.toFixed(2)} tonnes/year</div>
                        </div>
                    </div>
                </div>`;
        }

        // Add event listeners
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("calculateButton").addEventListener("click", calculateMaximizedSystem);
            document.getElementById("population").addEventListener("keypress", function(e) {
                if (e.key === "Enter") {
                    calculateMaximizedSystem();
                }
            });
        });
    </script>
</body>
</html>
